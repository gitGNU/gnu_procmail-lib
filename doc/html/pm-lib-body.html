<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN"
  "http://www.w3.org/TR/REC-html40/frameset.dtd">
<HTML>
<!--
        See RCS ident(1) why these funny tags
        $Document:  $
        $Contact:   $
        Note: the LINK tags are used by advanced browsers.
-->
<HEAD>
<TITLE>
Procmail Module library documentation
</TITLE>



<!--    ......................................................................
    META TAGS (FOR SEARCH ENGINES)
    ......................................................................
-->

  <META HTTP-EQUIV="keywords"
	CONTENT="procmail, sendmail, programming language, library">

  <META HTTP-EQUIV="description"
	CONTENT="">


  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=utf-8">

  <META HTTP-EQUIV="Expires" CONTENT="Thu, 16 Dec 2004 10:29:46 GMT">



  <META NAME="Generator"
	CONTENT="2004-10-17 13:29 Perl program t2html.pl v2004.1016 http://perl-text2html.sourceforge.net/">



<!--    ......................................................................
    BUTTON DEFINITION START
    ......................................................................
-->

  <A HREF="http://pm-lib.sourceforge.net/"  target="_top" class="btn" >[home]</A>

    <STYLE TYPE="text/css">


        /*

            ///////////////////////////////////////////////////////////
               NOTE    NOTE    NOTE    NOTE    NOTE    NOTE    NOTE

            This is the default CSS 2.0 generated by the program,
            please see "t2html.pl --help" for option --script-file
            to import your own CSS and Java definitions into the page.

            XHTML note: at page http://www.w3.org/TR/xhtml1/#guidelines
            It is recommended that CSS2 with XHTML use lowercase
            element and attribute names

            This default CSS2 has been validated according to
            http://jigsaw.w3.org/css-validator/validator-uri.html.en

            To design colors, visit:
            http://www.btexact.com/people/rigdence/colours/

               NOTE    NOTE    NOTE    NOTE    NOTE    NOTE    NOTE
            ///////////////////////////////////////////////////////////

            Comments on the CSS tags:

            -   block-width: "thin" (Netscape ok, MSIE nok)

            NETSCAPE 4.05

            -  In general does not render CSS very well. Eg
               font size changes does not show up in screen.
            -  :hover property is not recognised

            NETSCAPE 4.75 as of 2000-10-01

            -  Shows garbage for stylesheet section that marked CITATION.
               (IE has no trouble to show it)

            MSIE 4.0+

            - Renders CSS very well.

            Media types

            - Netscape does not transfer the CSS element definitions to
              the "print" media as it should. They only affect Browser
              or media "screen"
            - That is why you really have to say EM STRONG ... /STRONG EM
              to get that kind of text seen in printer too. You cannot
              just define P.column7 { ... }

            The @media CSS definition is not supported by Netscape 4.05
            I do not know if MSIE 4.0 supports it.

            So doing this would cause CSS to be ignored completely
            (never mind that CSS says the default CSS applies to "visual",
            which means both print and scree types.)

                @media print, screen {  P.code {..}  }

            To work around that, we separate the definitions with

                P.code { .. }               // For screen

                @media print { P.code      // for printer
                {
                    ..
                }}

            And wish that some newer browser will render it right.

        */

        /*   ///////////////////////////////////////////////// HEADINGS */

        h1.default
        {
            font-family: bold x-large Arial,helvetica,Sans-serif;
            padding-top: 10pt;
        }


        h2.default
        {
            font-family: bold large Arial,Helvetica,Sans-serif;
        }

        h3.default
        {
            font-family: bold medium Arial,Helvetica,Sans-serif;
        }

        h4.default
        {
            font-family: medium Arial,Helvetica,Sans-serif;
        }


        /*   ////////////////////////// Make pointing AHREF more visual */

        body
        {
            font-family: "Times New Roman", serif;
            

            /*
                More readable font, Like Arial in MS Word
                The background color is grey

                font-family: "verdana", sans-serif;
                background-color: #dddddd;
                foreground-color: #000000;

                Traditional "Book" and newspaper font
                font-family: "Times New Roman", serif;
            */
        }

        a:link
        {
            font-style: italic;
        }

        /*   A name=... link references */

        a.name
        {
            font-style: normal;
        }

        a:hover
        {
            color:           purple;
            background:      #AFB;
            text-decoration: none;
        }

            /* cancel above italic in TOC and Navigation buttons */

        a.btn:link
        {
            font-style: normal;
        }

            /* each link in TOC */


        a.toc
        {
            font-family: verdana, sans-serif;
            font-style: normal;
        }

        a.toc:link
        {
            font-style: normal;
        }

            /* [toc] heading button which appears in non-frame html */

        a.btn-toc:link
        {
            font-style: normal;
            font-family: verdana, sans-serif;
            /* font-size:  0.7em; */
        }

        /*  //////////////////////////////////// Format the code sections  */

        /*  MSIE ok, Netscape nok: Indent text to same level to the right  */

        blockquote
        {
            margin-right: 0;
        }

        @media print   { BLOCKQUOTE
        {
            margin-right: 0;
        }}

        samp.code
        {
            color: Navy;
        }

        pre
        {
            font-family:   "Courier New", monospace;
            font-size:     0.8em;
        }

        pre.code
        {
            color: Navy;
        }

        p.code, p.code1, p.code2
        {
            /*
               margin-top:     0.4em;
               margin-bottom:  0.4em;
               line-height:    0.9em;
            */

            font-family:    "Courier New", monospace;
            font-size:      0.8em;

            color:          Navy;
        }

        /* //////////////////////// tables /////////////////////////// */

        table.basic
        {
                font-family:    "Courier New", monospace;
                color: Navy;
        }


        table.dashed
        {

                /* font-family: sans-serif; /*
                /* background:  #F7DE9C; */

                color: Navy;

                border-top:     1px #999999 solid;
                border-left:    1px #999999 solid;
                border-right:   1px #666666 solid;
                border-bottom:  1px #666666 solid;
                border-width:   94%;
                border-style: dashed; /* dotted */


                /* line-height: 105%; */
        }


        table.solid
        {
                font-family:    "Courier New", monospace;
                /* afont-size:      0.8em; */

                color:          Navy;

                /* font-family: sans-serif; /*
                /* background:  #F7DE9C; */

                border-top:     1px #CCCCCC solid;
                border-left:    1px #CCCCCC solid; /* 999999 */
                border-right:   1px #666666 solid;
                border-bottom:  1px #666666 solid; /* dark grey */
                /* line-height: 105%; */
        }


        /* Make 3D styled layout by thickening the boton + right. */

        table.shade-3d
        {
                font-family:    "Courier New", monospace;
                font-size:      0.8em;

                color:          #999999; /* Navy; */

                /* font-family: sans-serif; /*
                /* background:  #F7DE9C; */

                /* border-top:  1px #999999 solid; */
                /* border-left: 1px #999999 solid; */
                border-right:   4px #666666 solid;
                border-bottom:  3px #666666 solid;
                /* line-height: 105%; */
        }


        .shade-3d-attrib
        {
            /*
                F9EDCC          Light Orange
                FAEFD2          Even lighter Orange

                #FFFFCC         Light yellow, lime

            */

            background: #FFFFCC;
        }


        table.shade-normal
        {
                font-family:    "Courier New", monospace;
                /* font-size:      0.9em; */
                color:          Navy;
        }

        .shade-normal-attrib
        {
            /*  grey: EAEAEA, F0F0F0 FFFFCC
                lime: F7F7DE CCFFCC
                pinkish: E6F1FD D8E9FB C6DEFA FFEEFF (light ... darker)
            */
            background: #EFEFEF;
        }


        table.shade-normal2
        {
                font-family:    "Courier New", monospace;
        }

        .shade-normal2-attrib
        {
            background: #E0E0F0;
        }


        table.shade-note
        {
            /* nothing special */
        }


        .shade-note-attrib
        {
            /*  darker is #E0E0F0; */
            /* background: #E5ECF3; */
            background: #E5ECF3;
            font-family: Georgia, Palatino, Verdana, Arial, Helvetica;
            font-size: 0.8em;
        }

        /* ..................................... colors ................. */

        .color-white
        {
            color: Navy;
            background: #FFFFFF;
        }

        .color-fg-navy
        {
            color: navy;
        }

        .color-fg-blue
        {
            color: blue;
        }

        .color-fg-teal
        {
            color: teal;
        }

        /*   Nice combination: teal-dark, beige2 and  beige-dark */

        .color-teal-dark
        {
            color: #96EFF2;
        }

        .color-beige
        {
            color: Navy;
            background: #F7F7DE;
        }

        .color-beige2
        {
            color: Navy;
            background: #FAFACA;
        }

        .color-beige-dark
        {
            color: Navy;
            background: #CFEFBD;
        }


        .color-pink-dark
        {
            background: #E6F1FD;
        }

        .color-pink-medium
        {
            background: #D8E9FB;
        }

        .color-pink
        {
            /*  grey: EAEAEA, F0F0F0 FFFFCC
                lime: F7F7DE CCFFCC
                pinkish: E6F1FD D8E9FB C6DEFA FFEEFF (light ... darker)
            */
            background: #C6DEFA;
        }

        .color-pink-light
        {
            background: #FFEEFF;
        }


        /* ////////////////////////////////////////////// Format columns */

        p.column3
        {
            color: Green;
        }

        p.column5
        {
            color: #87C0FF;   /* shaded casual blue */
        }

        p.column6
        {
            /* #809F69 is Forest green
               But web safe colors are:
               Lighter  ForestGreen: 66CC00
               ForestGreen: #999966 669900 339900 669966

            color: #669900;
            font-family: "Goudy Old Style"
            */
            margin-left: 3em;
            font-family: Georgia, Palatino, Verdana, Arial, Helvetica;
            font-size:  0.9em;
        }

            /* This is so called 3rd heading */

        p.column7
        {
            font-style:  italic;
            font-weight: bold;
        }

        @media print { P.column7
        {
            font-style:  italic;
            font-weight: bold;
        }}

        p.column8
        {

        }

        p.column9
        {
            font-weight: bold;
        }

        p.column10
        {
            padding-top: 0;
        }

        em.quote10
        {
            /*
                #FF00FF Fuchsia;
                #0000FF Blue

                #87C0FF casual blue
                #87CAF0

                #A0FFFF Very light blue

                #809F69 = Forest Green , see /usr/lib/X11/rgb.txt

                background-color:

                color: #80871F ; Orange, short of

                # font-family: "Gill Sans", sans-serif;

                line-height: 0.9em;
                font-style:  italic;
                font-size:   0.8em;

                line-height: 0.9em;
                color: #008080;

                background-color: #F5F5F5;
                #809F69; forest green
                #F5F5F5; Pale grey
                #FFf098; pale green
                ##bfefff; #ffefff; LightBlue1

                background-color: #ffefff;

                .................
                #FFFCE7         Orange very light
                #FFE7BF         Orange dark
                #FFFFBF         Orange limon

             */

             /*
             #  See a nice page at
             #  http://www.cs.helsinki.fi/linux/
             #  http://www.cs.helsinki.fi/include/tktl.css
             #
             #  3-4 of these first fonts have almost identical look
             #  Browser will pick the one that is supported
             */

             font-family: lucida, lucida sans unicode, verdana, arial, "Trebuchet MS", helvetica, sans-serif;
             background-color: #eeeeff;
             font-size:   0.8em;
        }

        @media print { em.quote10
        {
            font-style:  italic;
            line-height: 0.9em;
            font-size:   0.8em;
        }}

        p.column11
        {
            font-family: arial, verdana, helvetica, sans-serif;
            font-size: 0.9em;
            font-style: italic;
            color: Fuchsia;
        }

        /* /////////////////////////////////////////////// Format words */

        em.word
        {
            /* #809F69 Forest green */
            color: #80B06A;  /*Darker Forest green */
        }

        strong.word
        {

        }

        samp.word
        {
            color: #4C9CD4;
            font-weight: bold;
            font-family:    "Courier New", monospace;
            font-size:      0.85em;
        }

        span.super
        {
            /* superscripts */
            color: teal;
            vertical-align: super;
            font-family: Verdana, Arial, sans-serif;
            font-size: 0.8em;
        }


        span.word-ref
        {
            color: teal;
        }

        span.word-big
        {
            color: teal;
            font-size: 1.2em;
        }

        span.word-small
        {
            color: #CC66FF;
            font-family: Verdana, Arial, sans-serif;
            font-size: 0.7em;
        }

        /* /////////////////////////////////////////////// Format other */

                /* 7th column starting with double quote */

        span.quote7
        {
            /* color: Green; */
            /* font-style: italic; */
            font-family: Verdana;
            font-weigh: bold;
            font-size: 1em;
        }

                /* This appears in FRAME version: xxx-toc.html */

        div.toc
        {
            font-size: 0.8em;
        }

                /* This appears in picture: the acption text beneath */

        div.picture
        {
            font-style: italic;
        }


                /* This is the document info footer */

        em.footer
        {
            font-size: 0.9em;
        }

        END: Hide from older browsers



    </STYLE>


    <!-- ...................................................... Java code -->

    <SCRIPT TYPE="text/javascript">

        function MakeVisual(obj)
        {
            obj.style.fontWeight = "italic";
        }

        function MakeNormal(obj)
        {
            obj.style.fontWeight = "normal";
        }

        function IgnoreErrors()
        {
            return true;
        }

        window.onerror = IgnoreErrors;

    </SCRIPT>

</HEAD>

<BODY >
</P>
</BLOCKQUOTE>
<HR>
    <A name="1"  id="1"></A>
    <H1>
    Document id
    
    </H1>
<BLOCKQUOTE>



<P class="column8">
        This page documents of part of the files included in Procmail
        Module Library project. Each modules is can be used as a plug-in.
        Some can be used as subroutines to your own programs and some are
        self containing recipes. There is no user or site specific settings
        in these modules.


<P class="column8">
        An attempt to minimize the use of external processes was the design
        goal. The modules try to use pure procmail way as much as possible
        e.g. to get date and directly from message without calling
        expensive shell <SAMP class="word">date</SAMP>. It is important to remember that procmail
        is run on every incoming message and every CPU tick spent counts.


<P class="column9"><STRONG>
         Document control</STRONG>



<P class="column8">
        This document has been automatically generated from the procmail files
        with 2 small perl programs in the following manner:

<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % perl -S ripdoc.pl `ls pm-ja*.rc|sort`   &gt; pm-lib.raw

      % perl -S t2html.pl                                           \
        --html-frame                                                \
        --base <A HREF="http://pm-lib.sourceforge.net/" target="_top">http://pm-lib.sourceforge.net/</A>                       \
        --button-previous &quot;<A HREF="http://pm-lib.sourceforge.net/&quot" target="_top">http://pm-lib.sourceforge.net/&amp;quot</A>;          \
        --title  &quot;Procmail module documentation&quot;                    \
        --author &quot;Jari Aalto&quot;                                       \
        --meta-keywords &quot;procmail, sendmail, programming, library&quot;  \
        --meta-description &quot;Procmail plug-in module documentation&quot;  \
        --name-uniq                                                 \
        --Out                                                       \
        pm-lib.txt
    </TD>
    </TR>
</TABLE>


<P class="column8">
        The perl program assume that the documentation sections have been
        written in Technical Text Format. The perl program <SAMP class="word">ripdoc.pl</SAMP> can
        be found at CPAN entry
        <A HREF="http://www.cpan.org/modules/by-authors/id/J/JA/JARIAALTO/" target="_top">http://www.cpan.org/modules/by-authors/id/J/JA/JARIAALTO/</A> and
        <SAMP class="word">t2html.pl</SAMP> is available at sourceforge project <SAMP class="word">perl-text2html</SAMP>.

</P>
</BLOCKQUOTE>
<HR>
    <A name="2"  id="2"></A>
    <H1>
    Pm-jaaddr.rc &ndash; extract 'foo@some.com' email address from variable INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="3" id="3"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, extract, email address, subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="4" id="4"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc extracts the various components of email address
        from variable <SAMP class="word">INPUT</SAMP>. You can do quite a lot interesting things with
        your email address. Refer to <A HREF="http://www.qz.to/~eli/faqs/addressing.html" target="_top">http://www.qz.to/~eli/faqs/addressing.html</A>
        for more information. One of the tricks that you could use if you
        don't have sendmail plus addressing capabilities, is that you put
        the additional infomation to the RFC comment. Eg. If you read and
        followup to posts in usenet games groups, you could use:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      From: &lt;EM&gt;<A HREF="mailto:login@site.com" >login@site.com</A>&lt;/EM&gt; (John Doe+usenet.games)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Or if your email address's localpart (that's characters before @)
        already signify your First and surname, you don't need to repeat it
        in comment. However, place special marker &quot;+&quot; to mark
        additional information part for your procmail recipes:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      From: &lt;EM&gt;<A HREF="mailto:first.surname@site.com" >first.surname@site.com</A>&lt;/EM&gt; (+usenet.games)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The use of RFC comment should work everywhere because RFC requires
        that comments are preserved along with the address information.
        If you would have sendmail plus addressing capabilities you would
        have used:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      From: &lt;EM&gt;<A HREF="mailto:login+usenet.games@site.com" >login+usenet.games@site.com</A>&lt;/EM&gt; (John Doe)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The idea is that the list infomation is readily available from
        the email. The following recipe will derive the plus information
        and use it directly as a mailbox where to drop the message. If
        The Editor: Emacs, means anything to you, you can program it
        to generate the appropriate From headers automatically when you
        send mail from Gnus Mail/Newsreader MUA. Drop me a message if
        you need an example how a piece of Emacs lisp code makes those
        magic RFC plus addresses in the background while you compose the
        body of the message.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      RC_EMAIL = $PMSRC/pm-jaaddr.rc
      TOME     = &quot;(login1|login2)&quot;
 
      :0
      *$ ^TO\/.*$TOME.*
      {
          INPUT       = $MATCH
          INCLUDERC   = $RC_EMAIL
          PLUS        = $COMMENT_PLUS
 
          #  If COMMENT_PLUS was defined, we found &quot;+&quot;
          #  address which contain &quot;usenet.games&quot;. Save it to
          #  folder.
 
          :0 :
          * PLUS ?? [a-z]
          $PLUS
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="5" id="5"></A>
  <H2>
      Notes
      
  </H2>



 
        1998-05 David Hunt <EM><A HREF="mailto:dh@west.net" >dh@west.net</A></EM> also mentioned that &quot;you need to
        remember that some MTAs, (qmail for one, and soon vmail) use a dash
        ( - ) as the subaddress delimiter. So you'll want to allow for that
        in your code&quot;. For this reason the email part accepts both
        &quot;-&quot; and  &quot;+&quot;. The RFC comment however accepts only &quot;+&quot; and &quot;--&quot;.
 

</P>
  <A name="6" id="6"></A>
  <H2>
      Example input
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;From: foo+procmail@this.site.com (Mr. foo)&quot;        traditional
      &quot;From: foo-procmail@this.site.com (Mr. foo)&quot;        new styled
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        NOTE: M$SOFT mailers tend to send idiotic smart quotes &quot;'Mr. foo'&quot;
        and this recipe ignores these two quotes [&quot;'] as if message had
        only the standard [&quot;]
 

</P>
  <A name="7" id="7"></A>
  <H2>
      Returned values
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      ADDRESS     &quot;foo+procmail@this.site.com&quot;
                  containing the email address without &lt;&gt;
 
      ACCOUNT     &quot;foo+procmail&quot;
                  all characters before @
 
      ACCOUNT1    &quot;foo&quot;
                  characters before plus: account1+account2@site
                  Note, if there is no &quot;+&quot;, this is same as ACCOUNT.
 
      ACCOUNT2    &quot;procmail&quot;
                  _only_ set if plus found: account1+account2@site
 
      SITE        &quot;this.site.com&quot;
                  all characters after @
 
      DOMAIN      &quot;site.com&quot;
                  the main domain, preceding words in site are
                  considered subdomain (local) addresses.
 
                      sub.sub.domain.net
 
      SUB         &quot;this.site&quot;
                  all the sub-domain names without the NET part.
 
      SUB1        &quot;site&quot;
                  The first subdomain counted from the _RIGHT_ after NET
 
      SUB2        &quot;this&quot;
                  Second subdomain.
 
      SUB3        &quot;&quot;
                  Third subdomain.
 
      SUB4        &quot;&quot;
                  Fourth subdomain.
 
      NET         &quot;com&quot;
                  last characters after last period ( net,com,edu ...)
 
      COMMENT     Anything unside parenthesis (Mr. Foo) or if no
                  parentheses found, then anything between quotes
                  &quot;Mr. Foo&quot;
 
      COMMENT_PLUS Anything after the &quot;+&quot; in the comment, like
                   &quot;Mr Foo+mail.usenet&quot; --&gt; &quot;mail.usenet&quot;
 
                   Note: some MTA's don't allow + character, so use
                   alternatively '--':
                   &quot;Mr Foo--mail.usenet&quot;  --&gt; &quot;mail.usenet&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Additionally there is variables DOT1 DOT2, which behave like
        ACCOUNT1 and ACCOUNT2, but in respect to dotted firstname.surname
        type address:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          john.doe@site.com
 
          ACCOUNT1    = john.doe
          ACCOUNT2    = &lt;empty&gt;
          DOT1        = john
          DOT2        = doe
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If there is plus, the ACCOUNT2 is defined
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          john.doe+foo@site.com
 
          ACCOUNT1    = john.doe
          ACCOUNT2    = foo
          DOT1        = john          (in respect to ACCOUNT1)
          DOT2        = doe           (in respect to ACCOUNT1)
    </TD>
    </TR>
</TABLE>
 
 

<P class="column8">
        Variable ERROR is set to &quot;yes&quot; if INPUT wasn't recognized or parsing
        the address failed.
 

</P>
  <A name="8" id="8"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there.
 

</P>
  <A name="9" id="9"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT = string-to-parse
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="10" id="10"></A>
  <H2>
      Usage example
      
  </H2>



 
        Read From field and address from it. This is lot faster than using
        external <SAMP class="word">formail</SAMP> call.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC   = $HOME/pm
      RC_ADDR = $PMSRC/pm-jaaddr.rc
 
      :0
      *  ^From:\/.*@.*
      {
          INPUT = $MATCH
 
          #  Turn off the logging while executing this part
          VERBOSE=&quot;off&quot;   INCLUDERC = $RC_ADDR  VERBOSE=&quot;on&quot;
 
          :0
          * ERROR ?? yes
          {
             # Hmm, no std email address found. Any other ideas?
          }
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="11"  id="11"></A>
    <H1>
    Pm-jabup.rc &ndash;  Keeep N arriving message backup in separate directory
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="12" id="12"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail backup recipe $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
 

</P>
  <A name="13" id="13"></A>
  <H2>
      Description
      
  </H2>



 
        Preserve last N arriving messages in a separate sub-directory.
        This should be your safety-belt recipe that you put to the beginning
        of your .procmailrc.
 

<P class="column8">
        Procmail saves the backup files with names like: msg.rcG  msg.scG
        msg.3YS1, msg.4YS1, msg.VYS1, msg.fYS1 to the backup directory.
 

<P class="column8">
        Note: this recipe will alawys call shell commands for each message
        you recive. That is needed because cleaning of the backup directory.
        If you receive only small number of messages per day, the performance
        drop of your .procmailrc is not crucial. But if you store many messages
        per day, then the shell calls may be a performance problem.
 

<P class="column8">
        In that case, consider moving the cleanup to the pm-jacron.rc
        module (The cleanup is run only once a day, not for every message)
 

<P class="column8">
        John Gianni send his simple bsckup script to Jari, who packaged
        and generalized the code. The code is reused with John's permission
        and maintaining responsibility was transferred to Jari
 

</P>
  <A name="14" id="14"></A>
  <H2>
      Required settings
      
  </H2>



 
        (none)
 

</P>
  <A name="15" id="15"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_BUP_MAX, How many messages to keep at maximum. 32 is default
	<LI>JA_BUP_DIR, Where to store the messages. $HOME/Mail/bup by default
	<LI>JA_BUP_FILES, regexp to match the saved files. Procmail default.
	<LI>JA_BUP_CHECK_DIR. Once you have verified that this recipe works,
            that directories are ok, please set this flag to &quot;no&quot; to prevent
	            running unnecessary <SAMP class="word">test</SAMP> command for each email.
</UL>


 

</P>
  <A name="16" id="16"></A>
  <H2>
      Usage example
      
  </H2>



 
        You only want to keep backup of messages that are not from mailing
        lists. You may want to use TO_ macro to detect addresses better,
        this example matches against all headers
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      LISTS          = &quot;(procmail|list-1|list-2)&quot;
      JA_BUP_DIR     = $HOME/Mail/backup/.        # Create the path too
      JA_BUP_MAX     = 42                         # this should be enough
 
      :0
      *$ ! $LISTS
      {
          INCLUDERC = $PMSRC/pm-jabup.rc
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you get many messages, please don't use this module. Instead
        see pm-jacron.rc where similar backup work is done better.
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="17"  id="17"></A>
    <H1>
    Pm-jacookie1.rc &ndash; Generate unique id from INPUT variable.
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="18" id="18"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail cookieMake subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="19" id="19"></A>
  <H2>
      Description
      
  </H2>



 
        When given a string, this subroutine returns a unique number
        representing a string, a cookie.
 

</P>
  <A name="20" id="20"></A>
  <H2>
      Required settings
      
  </H2>



 
        (none)
 

</P>
  <A name="21" id="21"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>INPUT, String from which the magic-cookie is calculated
	<LI>JA_COOKIE_CMD: shell command to read INPUT and return decimal
            or hex cookie string as one continuous block of characters.
            It decaults to HP-UX <SAMP class="word">cksum</SAMP>, but your system may have <SAMP class="word">md5</SAMP>
	            or <SAMP class="word">chksum</SAMP>
</UL>


 

</P>
  <A name="22" id="22"></A>
  <H2>
      Return values
      
  </H2>



 
	<UL>
	<LI>Variable OUTPUT will contain the cookie.
</UL>


 

</P>
  <A name="23" id="23"></A>
  <H2>
      Example usage
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT           = &quot;foo@site.com&quot;
      JA_COOKIE_CMD   = &quot;md5&quot;     # or chksum
      INCLUDERC       = $PMSRC/pm-jacookie1.rc
      cookie          = $OUTPUT
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="24"  id="24"></A>
    <H1>
    Pm-jacookie.rc &ndash; Handle cookie (unique id) confirmations
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="25" id="25"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-20041 Jari Aalto<BR>
        $Keywords:     procmail, cookie, confirm, subroutine<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="26" id="26"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Each user must register himself to cookie cache before he
            is considered &quot;known&quot;
	<LI>Unless user return the generated cookie string; which is
            typically a decimal or hex number, he is not considered as
            known and should not have access to services you provide.
	<LI>Can be used as a &quot;doorbell&quot; spam/UBE shield
</UL>


 

</P>
  <A name="27" id="27"></A>
  <H2>
      Description
      
  </H2>



 
        This recipe handles generating the cookie to new users, comparing
        the returned cookie against the original one and passing known
        users through if they already had returned their cookie.
 

<P class="column8">
        When you run automatised scripts, eg. to manage mailing lists
        where users can subscribe and unsubscribe, you have better to
        install safety measure so that someone can not subscribe his enemy
        to 30 mailing lists.
 

<P class="column8">
        The <EM class="word">cookie</EM> is any continuous block of random characters that
        is sent to person who wanted to use the service. He must send
        back the <EM class="word">cookie</EM> before the service starts an action, like
        subscribe. If someone forges the From address to pretend to be
        someone else and then subscribes as-beeing-someone-else to a
        mailing list, the cookie protects this from happening.
 

<P class="column8">
        The cookie is sent to someone-else, and he must return the cookie
        before the &quot;subscribe&quot; service is activated. Obviously this
        someone-else will not be interested in sending back the cookie and
        thus the forgery fails. Isn't that simple, but efective protection
        against misuse?
 

</P>
  <A name="28" id="28"></A>
  <H2>
      Should I use this as Challenge-Response Spam shield?
      
  </H2>



 
        Unsolicited Bulk Email aka Spam is crawling from every possible
        domain thinkable, so you might think that a challenge-response
        policy could be deployed to regular email communication as well.
        The idea would be that unknown people are requested to 
        &quot;join&quot; to a white list, before discussion is initiated with them. 
        Bulk email shotguns do not reply to challenges (here: cookies), 
        so confirmations are not returned. Individual people that want to 
        talk, <EM class="word">may</EM> want to return the cookies. 
 

<P class="column8">
        Sounds like a perfect Unsolicited Bulk Email shield? No more
        non-invited mail? Wrong. Don't use this module for that. The
        whole idea of challenge-response is flawed and causes trouble
        for every person who tries to contact. Imagine for 10 people
        using C-R systems; they would all need to authenticate 
        themselves. Who is going to believe that he is not replying to
        a spammer who is collecting email addresses? And what about
        automatic messages that might be received &ndash; there is no 
        artificial intelligence to deparate &quot;human&quot; messages from
        automatically generated messages, so challenges just
        increase the overall mail traffic. Every C-R system doubles
        the mail traffic and becomes spam problem by itself.
 

<P class="column8">
        In short, don't use this module for implementing a C-R system
        to block regular mail to you. The reasons why all C-R systems
        are the worst kind of spam is better described in Procmail
        Module Library's README.txt also available at
        <A HREF="http://pm-lib.sourceforge.net/README.html" target="_top">http://pm-lib.sourceforge.net/README.html</A> in section titled
        &quot;Challenge-Response policy make matters worse&quot;
 

</P>
  <A name="29" id="29"></A>
  <H2>
      How it works
      
  </H2>



 
        By default the cookie generated uses CRC 32 <SAMP class="word">cksum</SAMP>, but if you have
        md5, you should use it. The cookie is generated from the reply
        address and immediately stored to cookie database file with entry
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      DATE FROM-a COOKIE-a
      DATE FROM-b COOKIE-b
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If this was a new user or an old user, who has not registered his
        cookie yet, then original message is sent back to the sender with
        instructions: &quot;please place the magic string to Subject line and
        resent the message.&quot;
 

<P class="column8">
        When cookie is returned back, a new line to the database is added,
        simply by adding a duplicate entry. The file now looks like this:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      DATE FROM-a COOKIE-a
      DATE FROM-b COOKIE-b
      DATE FROM-a COOKIE-a
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        When there is two or more same entries, like FROM-a, the address
        is supposed to be known and person behind it &quot;cleared&quot;.
 

</P>
  <A name="30" id="30"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jadate.rc
	<LI>pm-jacookie1.rc
	<LI>pm-jastore.rc
</UL>


 

</P>
  <A name="31" id="31"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_COOKIE_SEND, flag. Default is &quot;yes&quot;. Set to &quot;no&quot; if you want
            to take full control of the message returned to user. You can check
            variable <SAMP class="word">ERROR</SAMP> and use <SAMP class="word">key</SAMP> which holds the unique <SAMP class="word">cookie</SAMP>
	<LI>JA_COOKIE_CACHE, cache to determine if this is new user or not.
	<LI>JA_COOKIE_AUTO_KEY, flag. If set to &quot;yes&quot;; the cookie is
            initially put to the Subject when the message is bounched back.
            Receiver only has to press &quot;r&quot; to reply to send the cookie
            and message back (convenient). You set this flag to &quot;no&quot; when
            you want to avoid accidnebts eg. when receiver is about to
            subscribe to a mailing lists: he has to manually insert the cookie
            into subject. But keep flag to &quot;yes&quot; if you use this module to
            get your friends registered easily.
	<LI>JA_COOKIE_KEYS, the cookie database. Email address and person's
            access cookie.
	<LI>JA_COOKIE_RC, dubroutine to generate the cookie id from INPUT.
            By default uses CRC 32.
	<LI>JA_COOKIE, the string from which the cookie will be generated.
            If you already have the return addres for the sender derived,
	            you should assing a value to this to save unnecessary formail call.
</UL>


 

</P>
  <A name="32" id="32"></A>
  <H2>
      Returned values
      
  </H2>



 
        ERROR will contain the efective action when this recipe file ends
 
<UL>
	<LI>&quot;new-user&quot;, This is first message from sender.
	<LI>&quot;known-user&quot;, message has email that has been &quot;cleared&quot; ie.
            cookie had been returned and user registered.
	<LI>&quot;key-mismatch&quot;, This is at least second message from sender.
	            But he dind't send the confirmation in this message.
</UL>


 

<P class="column8">
        <SAMP class="word">key</SAMP> is an internal variable in this recipe file and will hold the
        cookie id in case of &quot;new-user&quot; and &quot;key-mismatch&quot;. You may want to
        use it if you generate your own reply.
 

</P>
  <A name="33" id="33"></A>
  <H2>
      Example usage for UBE shield
      
  </H2>



 
        This is what I use to prevent unknown people from sending me UBE.
        It takes a bit extra, but they can easily return the message.
        Fill in the missing variables, this won't work out of the box for you.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      WORK        = &quot;(domain1|domain2|domain3)&quot;
      LISTS       = &quot;(procmail|list-2|list-3|list-4)&quot;
      VALID       = &quot;(postmaster|abuse|$LISTS|$WORK)&quot;
      RC_COOKIE   = $PMSRC/pm-jacookie.rc
      UBE_SPOOL   = $HOME/Mail/junk.ube.spool   # Save spam here
 
      :0
      *$ ! From:.*$VALID
      *$ ! ^FROM_DAEMON
      {
          JA_COOKIE_SEND  = &quot;yes&quot;         # Activate it
          INCLUDERC       = $RC_COOKIE
 
          :0 :
          * ! ERROR ?? known-user
          $UBE_SPOOL
 
          #  ... Past this point: it was user in whitelist, so the 
          #  recipes after this block will take care of it
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="34" id="34"></A>
  <H2>
      Example usage for subscriptions
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $RC_COOKIE   = $PMSRC/pm-jacookie.rc
 
      ...Mailing lists handled here...
      ...Your work messages filed here..
 
      TO            = `formail -rt -zxTo:`  # We need this elswhere
      JA_COOKIE_TO  = $TO                   
 
      #   For List-X all subscribe requests must
      #   be confirmaed
 
      * ^TO_()list-x
      * ^Subject: +subscribe\&gt;
      {
          JA_COOKIE_SEND  = &quot;no&quot;
          INCLUDERC       = $RC_COOKIE
 
          :0
          * ERROR ?? known-user
          {
              #   User sent the subsribe request again, allow joining
              #   immediately.
          }
          :0 E
          {
              # Because the Send was set to &quot;no&quot;; we're in charge
              # to send a reply to the user.
              # ...generate suitable message with formail -rt
          }
 
      }
 
      #  End of example
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="35"  id="35"></A>
    <H1>
    Pm-jacron.rc &ndash; Procmail: Run cron once a day
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="36" id="36"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail, cron, framework, subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="37" id="37"></A>
  <H2>
      Description
      
  </H2>



 
        Framework for all cron tasks that can be run once a day.
        This is a wrapper recipe to your cron task list: when the day changes,
        you cron includerc is called.
 

</P>
  <A name="38" id="38"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This recipe
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jadate.rc
</UL>


 

</P>
  <A name="39" id="39"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_CRON_RUN_FLAG, You <STRONG class="word">must</STRONG> define this flag file.
	<LI>JA_CRON_DATE_FILE, File where the date information, last cron run,
            is kept. Defaults to $HOME/.yymmdd
	<LI>JA_CRON_RC, your includerc which is run when cron triggers.
</UL>


 

<P class="column8">
        A file <SAMP class="word">JA_CRON_RUN_FLAG</SAMP> which defaults to ~/.yymmdd.run is created
        when your includerc, that contains list of cron tasks, is run. If new
        mail arrives while your cron recipes are still running, you should
        prevent invoking the cron again by checking if this file exists.
        When all the cron tasks have been run, this flag file is removed.
        Remember to use &quot;w&quot; flag in your cron recipes where necessary
        to serialize the work.
 

</P>
  <A name="40" id="40"></A>
  <H2>
      Return values
      
  </H2>



 
        (none)
 

</P>
  <A name="41" id="41"></A>
  <H2>
      Usage example
      
  </H2>



 
        Save backups to separate directory, but do cleaning only once a day
        We do not keep backups from mailing list messages
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      LISTS          = &quot;(procmail|list-1|list-2)&quot;
      BACKUP_DIR     = &quot;$HOME/Mail/backup/.&quot;
 
      #   Store backups: separate files to directory
 
      :0 c:
      *$ ! $LISTS
      $BACKUP_DIR
 
      #   Run JA_CRON_RC once a day. It contains all daily cron tasks
 
      CRON_RC             = $PMSRC/pm-jacron.rc   # the framework
      JA_CRON_RC          = $PMSRC/pm-mycron.rc   # the tasks to do
      JA_CRON_RUN_FLAG    = $HOME/.cron-running   # define this!
 
      #   Do not enter here if message arrived at the same day when
      #   the cron is already running. The CRON_RC takes care
      #   of deleting the file when cron has finished.
 
      :0
      *$ ! ? $IS_EXIST $JA_CRON_RUN_FLAG
      {
          INCLUDERC = $CRON_RC
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The <EM class="word">pm-jacron.rc</EM> file may contain anything. For example to clean
        the backup directory; you add these statements there
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #   rm dummy: if ls doesn't return files, make sure rm has
      #   at least one argument.
      #
      #   ls -t: list files; newest first
      #
      #   sed: chop $max newest files from the listing, leaving the
      #   old ones
 
      max = 32
 
      :0 hwic
      | cd $BACKUP_DIR &amp;&amp; $RM -f dummy `ls -t msg.* | $SED -e 1,${max}d`
 
      # End of file pm-mycron.rc
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="42"  id="42"></A>
    <H1>
    Pm-jadaemon.rc &ndash; Handle DAEMON messages by changing subject
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="43" id="43"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, daemon, subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="44" id="44"></A>
  <H2>
      Description
      
  </H2>



 
        When you send a message to a address that had delivery troubles,
        you get a DAEMON message back explaining the error problem. I
        usually want to save these daemon mesaages to a different folder
        and check the folder from time to time. A typical daemon message
        is like this (shortened)
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      From: Mail Delivery Subsystem &lt;EM&gt;<A HREF="mailto:MAILER-DAEMON@my.domain.com" >MAILER-DAEMON@my.domain.com</A>&lt;/EM&gt;
      Subject: Warning: could not send message for past 4 hours
 
      The original message was received at...
      ----- Transcript of session follows -----
      Deferred: Connection timed out
      ----- Original message follows -----
      [YOUR MESSAGE AS YOU SENT IT WITH HEADERS]
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Well, when I read the subjects, I do not like the standard error
        messages, but I also like to know to which address the delivery
        failed and what was the original subject. This small recipe changes
        the daemon message's Subject to
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject BRIEF-ERROR-REASON, SENT-TO-ADDRESS, ORIGINAL-SUBJECT
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        and from that you can immediately tell if you should be worried Eg.
        if SENT-TO-ADDRESS was your friend's, then you want to take actions
        immediately, but if it were your complaint to UBE message to
        postmaster, you don't want to bother reading that daemon message.
        Here are some real examples:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      fatal errors,postmaster,ABUSE (Was: Super Cool Site!)
      Host unknown,postmaster,ABUSE (Was: A-Credit Information)
      undeliverable,postmaster,Could you investigate this spam
      Warning-Returned,friend,Have you looked at this
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="45" id="45"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        needs scrips
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="46" id="46"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
	<UL>
	<LI>JA_DAEMON_REGEXP,   which messages to trigger
</UL>


 

</P>
  <A name="47" id="47"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI>Variable ERROR will be set to &quot;yes&quot; if daemon message was handled
	            otherwise; value is &quot;no&quot;
</UL>


 

</P>
  <A name="48" id="48"></A>
  <H2>
      Usage example
      
  </H2>



 
        Just add this recipe somewhere in your .procmailrc. The place where
        you would put this daemon message trapper subroutine is crucial:
        think carefylly how you order your recipes. One suggested order
        could be: backup important messages, cron-subroutine,
        handle duplicates, DAEMON MESSAGES, plus addressed message,
        server message (file server, ping responder...), MAILING LISTS,
        send possible vacation  replies only after all above, apply
        kill file, detect mime, save private messages and las FILTER UBE.
 
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC           = $HOME/pm
      RC_DAEMON       = $PMSRC/pm-jadaemon.rc
      DAEMON_MBOX     = $HOME/Mail/junk.daemon.mbox
 
      ...
 
      INCLUDERC       = $RC_DAEMON
 
      :0 :            # If that was a daemon message, save it
      * ERROR ?? yes
      $DAEMON_MBOX
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="49"  id="49"></A>
    <H1>
    Pm-jadate1.rc &ndash; 'Tue, 31 Dec 1997' date parser from variable INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="50" id="50"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, date parsing $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="51" id="51"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc parses date from variable <SAMP class="word">INPUT</SAMP> which has string
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;Week, Daynbr Month Year&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Example input
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;Tue, 31 Dec 1997&quot;      -- without comma
      &quot;Tue 31 Dec 1997&quot;       -- with comma
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      YYYY    = 4 digits
      YY      = 2 digits
      MON     = 3 characters
      MM      = 2 digits
      DAY     = 3 characters
      DD      = 2 digits
      hh      = 2 digits      If available
      mm      = 2 digits      If available
      ss      = 2 digits      If available
      TZ      = 5 characters  If available
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Variable ERROR is set to <SAMP class="word">yes</SAMP> if it couldn't recognize the INPUT
        and couldn't parse the basic YYYY, YY, MM, DD variables.
 

</P>
  <A name="52" id="52"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there.
 

</P>
  <A name="53" id="53"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT = string-to-parse
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The INPUT can have anything after &quot;Week, dayNbr Month Year&quot;, or
        before it: you can pass a string like
        &quot;Thu, 13 Nov 1997 11:43:23 +0200&quot;.
 

</P>
  <A name="54" id="54"></A>
  <H2>
      Usage example
      
  </H2>



 
        The first <EM class="word">Received</EM> header will tell when the message was received
        by your mailserver. We parse the date and avoid calling expensive
        <SAMP class="word">date</SAMP> command.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC           = $HOME/pm
      RC_DATE_WDMY    = $PMSRC/pm-jadate1.rc #Week-Day-Month-Year parser
 
      # Get time from first header, it ends like this:
      #
      #       Received: ... ; Thu, 13 Nov 1997 11:43:50 +0200
 
      :0
      *$ ^Received:.*;$s+\/...,$s+$d.*
      {
          INPUT = $MATCH
 
          #  Turn off the logging while executing this part
 
          VERBOSE=off   INCLUDERC = $RC_DATE_WDMY   VERBOSE=on
 
          :0
          * ERROR ?? yes
          {
             # Use some other way to get the time or shout loudly
          }
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="55"  id="55"></A>
    <H1>
    Pm-jadate2.rc &ndash; 'YYYY-MM-DD' ISO date parser from variable INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="56" id="56"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto <BR>
        $Keywords:     procmail, subroutine, date parsing $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="57" id="57"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc parses date in format &quot;YYYY-MM-DD hh:mm:ss&quot;
        like <SAMP class="word">1997-12-01</SAMP> and sets following variables whenever called
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          YYYY    = 4 digits
          YY      = 2 digits
          MON     = 3 characters
          MM      = 2 digits
          DD      = 2 digits
          hh      = 2 digits  If avaliable
          mm      = 2 digits  If avaliable
          ss      = 2 digits  If avaliable
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Variable ERROR is set to <SAMP class="word">yes</SAMP> if it couldn't recognize the INPUT
        and couldn't parse the basic YYYY, YY, MM, DD variables.
 

</P>
  <A name="58" id="58"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there.
 

</P>
  <A name="59" id="59"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT = string-to-parse
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Last string in INPUT that matches number sequence <SAMP class="word">NNNN-NN-NN</SAMP> is
        parsed.
 

</P>
  <A name="60" id="60"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC          = $HOME/pm
      RC_DATE_ISO    = $PMSRC/pm-jadate2.rc # ISO date parser
 
      INPUT = &quot;This is 1800-10-11, a very old date&quot;
 
      #  Turn off the logging while executing this part
 
      VERBOSE=&quot;off&quot;  INCLUDERC=$RC_DATE_ISO  VERBOSE=&quot;on&quot;
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="61"  id="61"></A>
    <H1>
    Pm-jadate3.rc &ndash; 'Tue Nov 25 19:32:57' date parser from variable INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="62" id="62"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, date parsing $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="63" id="63"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc parses date from variable INPUT which has string
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;Week, Month dayNbr hh:mm:ss yyyy&quot;,
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Example
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Tue Nov 25 19:32:57 1997
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          YYYY    = 4 digits
          YY      = 2 digits
          MON     = 3 characters
          MM      = 2 digits
          DAY     = 3 characters
          DD      = 2 digits
          hh      = 2 digits
          mm      = 2 digits
          ss      = 2 sigits
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Variable ERROR is set to &quot;yes&quot; if it couldn't recognize the INPUT.
 

</P>
  <A name="64" id="64"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there.
 

</P>
  <A name="65" id="65"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT = string-to-parse
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="66" id="66"></A>
  <H2>
      Usage example
      
  </H2>



 
        The first <EM class="word">Received</EM> header will tell when the message was received
        by the mailserver. Parse the date and avoid calling expensive <SAMP class="word">date</SAMP>
        command.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC           = $HOME/pm
      RC_DATE_WMDT    = $PMSRC/pm-jadate4.rc #Week-Month-Day-Time parser
 
      # Get time from X-From-Line: Which was added by my MDA
      #   X-From-Line: procmail-request@informatik.rwth-aachen.de \
      #    Tue Nov 25 19:32:57 1997
 
      :0 c
      *$ ^X-From-Line:\/.*
      {
          INPUT = $MATCH
 
          #  Turn off the logging while executing subroutine
 
          VERBOSE=off   INCLUDERC = $RC_DATE_WMDT   VERBOSE=on
 
          :0
          * ERROR ?? yes
          {
             # Use some other way to get the time or shout loudly
          }
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="67"  id="67"></A>
    <H1>
    Pm-jadate4.rc &ndash; make RFC 'Mon, 1 Dec 1997 17:41:09' and parse values
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="68" id="68"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $keywords:     procmail, subroutine, date, shell $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="69" id="69"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine calls shell command date once and prses the values.
        This should be your last resort if you haven't got the date values
        by any other means. This subroutine assumes that the DATE command
        knows the following % specifier formats (HP-UX)
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Y   NNNN    year
      h   MON     month
      d   NN      day
      a   WEEK    Like &quot;Mon&quot;
      H   NN      hour
      M   NN      min
      S   NN      sec
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      DATE    = RFC date in format &quot;Mon, 1 Dec 1997 17:41:09&quot;
                This is same as what you would see in From_
 
      YYYY    = 4 digits
      YY      = 2 digits
      MON     = 3 characters
      MM      = 2 digits
      DAY     = 3 characters
      DD      = 2 digits
      hh      = 2 digits
      mm      = 2 digits
      ss      = 2 sigits
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Variable ERROR is set to &quot;yes&quot; if values couldn't be set
 

</P>
  <A name="70" id="70"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jadate1.rc
</UL>


 

</P>
  <A name="71" id="71"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (none)
 

</P>
  <A name="72" id="72"></A>
  <H2>
      Usage example
      
  </H2>



 
        The First Received line will tell when the message was received by
        the MDA. If thata fails, then get date from the system. If you send
        test messages to # yourself, you don't usually put From_ header in
        it and thus there is # no date information in 'dry run' tests.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      # Get time from first eader, which is always same in my system
      # Received: ... ; Thu, 13 Nov 1997 11:43:50 +0200
 
      INCLUDERC   = $PMSRC/pm-javar.rc    # to get $s $d definitions
      TODAY       # Clear it
 
      :0
      *$ ^Received:.*;$s+\/...,$s+$d.*
      {
          INPUT     = $MATCH
          INCLUDERC = $PMSRC/pm-jadate1.rc
          TODAY     = &quot;$YYYY-$MM-$DD&quot;
      }
 
      #   Check that variable did get set, if not then we have to call
      #   another date subroutine: Call shell then to find out date
      #
      #   You could also do this with ':0 E', but this is more
      #   educational
 
      :0
      *$ ! $TODAY^0
      {
          INCLUDERC = $PMSRC/pm-jadate4.rc    # Get date from Shell then
          TODAY     = $YYYY-$MM-$DD
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="73"  id="73"></A>
    <H1>
    Pm-jadate5.rc &ndash; 'Fri Jun 19 18:51:56 1998' date parser from var INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="74" id="74"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, date parsing $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="75" id="75"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc parses date from variable INPUT which has string
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;WeekDay Month dayNbr Year&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Example input
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;Fri Jun 19 18:51:56 1998&quot;      -- without comma
      &quot;Fri, Jun 19 18:51:56 1998&quot;     -- with comma
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      YYYY    = 4 digits
      YY      = 2 digits
      MON     = 3 characters
      MM      = 2 digits
      DAY     = 3 characters
      DD      = 2 digits
      hh      = 2 digits      If available
      mm      = 2 digits      If available
      ss      = 2 digits      If available
      TZ      = 5 characters  If available
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Variable ERROR is set to &quot;yes&quot; if it couldn't recognize the INPUT
        and couldn't parse the basic YYYY,YY,MM,DD variables.
 

</P>
  <A name="76" id="76"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there.
 

</P>
  <A name="77" id="77"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT = string-to-parse
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The INPUT can have anything after &quot;Week, dayNbr Month Year&quot;, or
        before it: you can pass a string like
        &quot;Fri Jun 19 18:51:56 1998 11:43:23 +0200&quot;.
 

</P>
  <A name="78" id="78"></A>
  <H2>
      Usage example
      
  </H2>



 
        The first <EM class="word">Received</EM> header will tell when the message was received
        by your mailserver. We parse the date and avoid calling expensive
        <SAMP class="word">date</SAMP> command.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC           = $HOME/pm
      RC_DATE_WDMY    = $PMSRC/pm-jadate5.rc #Week-Day-Month-Year parser
 
      # Get time from first header, it ends like this:
 
      :0
      *$ ()\/From .*
      {
          INPUT = $MATCH
          #  Turn off the logging while executing this part
 
          VERBOSE=off   INCLUDERC = $RC_DATE_WDMY   VERBOSE=on
 
          :0
          * ERROR ?? yes
          {
             # Use some other way to get the time or shout loudly
          }
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="79"  id="79"></A>
    <H1>
    Pm-jadate.rc &ndash; Read date from the message hdrs: From_, Receved:
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="80" id="80"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy; 1997-2004 Jari Aalto<BR>
        $keywords:    procmail, date, subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="81" id="81"></A>
  <H2>
      Description
      
  </H2>



 
        This recipe will scan several headers to find the date string.
        When suitable header is found and the parsing has succeeded, the
        return variables are set. The Date values reflects the arrive time
        of the message; not the sending time. If nothing works, a shell call
        <SAMP class="word">date</SAMP> is used as a last resort.
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      YYYY    = 4 digits
      YY      = 2 digits
      MON     = 3 characters
      MM      = 2 digits
      DAY     = 3 characters
      DD      = 2 digits
      hh      = 2 digits      if available
      mm      = 2 digits      if available
      ss      = 2 digits      if available
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="82" id="82"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jadate1.rc
	<LI>pm-jadate3.rc
	<LI>pm-jadate4.rc
</UL>


 

</P>
  <A name="83" id="83"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (none)
 

</P>
  <A name="84" id="84"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-jadate.rc
      #   now we have all date variables that we need
      #
      $TODAY    = $YYYY-$MM-$DD
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="85"  id="85"></A>
    <H1>
    Pm-jadup.rc &ndash; Procmail: Handle duplicates; store to separate folder
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="86" id="86"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, subroutine, filter duplicates $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="87" id="87"></A>
  <H2>
      Description
      
  </H2>



 
        This recipe stores duplicate messages to separate folder
 

</P>
  <A name="88" id="88"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jastore.rc
</UL>


 

</P>
  <A name="89" id="89"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_ID_CACHE, Where to keep the Message-Id cache.
	<LI>JA_ID_CACHE_SIZE, how big cache, defualt is 8192
	<LI>JA_ID_MBOX, where to store duplicate messages
            when delivering message to duplicate mbox.
	<LI>JA_ID_IGNORE, if set to &quot;yes&quot;, then ignore duplicate check
</UL>


 

</P>
  <A name="90" id="90"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI>Variable ERROR is set to &quot;yes&quot; if duplicate message was trapped,
	            otherwise value is &quot;no&quot;
</UL>


 

</P>
  <A name="91" id="91"></A>
  <H2>
      Usage Example
      
  </H2>



 
        For simple usage, just put this somewhere after backup recipes
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          RC_DUP      = $PMSRC/pm-jadup.rc
          ...
          INCLUDERC   = $RC_DUP
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        When you are testing messages, you send them over and over to
        procmailrc; which means that same message should not be trapped by<BR>
        duplicate check. You can call <SAMP class="word">procmail</SAMP> with option &quot;-a test&quot; which will
        set pseudo variable <SAMP class="word">$1</SAMP>. The recipe below sets flag <SAMP class="word">JA_ID_IGNORE</SAMP>
        to &quot;yes&quot; if test is on going and the duplicate filter should be
        bypassed.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      RC_DUP  = $PMSRC/pm-jadup.rc
      ARG     = $1        # Copy pseudo variable to $ARG
 
      :0
      * ARG ?? test
      {
          JA_ID_IGNORE = &quot;yes&quot;
      }
 
      #   Some microsoft product is known to send same message ids
      #   over and over. If we detect one, tunr off the duplicate test,
      #   because it would trash every message.
      #   &lt;MAPI.Id.0016.00666479202020203030303430303034@MAPI.to.RFC822&gt;
 
      :0
      * ! ^X-msmail
      * ! ^Message-ID: *&lt;EM&gt;<A HREF="mailto:MAPI.*@MAPI.to.RFC822" >MAPI.*@MAPI.to.RFC822</A>&lt;/EM&gt;
      {
          JA_ID_IGNORE = &quot;yes&quot;
      }
 
      #   Run this command every time a duplicate message is found.
      #   It writes a small log entry to MY_LOG
 
      INCLUDERC    = $RC_DUP
 
      :0 hwic:
      * ERROR ?? yes
      | echo &quot;    [duplicate]&quot; &gt;&gt; $BIFF
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="92"  id="92"></A>
    <H1>
    Pm-jaempty.rc &ndash; check if message body is empty
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="93" id="93"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $keywords:     procmail, subroutine, check empty message $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="94" id="94"></A>
  <H2>
      Description
      
  </H2>



 
        This simple includerc will define variable BODY_EMPTY to &quot;yes&quot; or
        &quot;no&quot; when called like this You can file empty messages to separate
        folder based on this value
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-jaempty.rc
 
      :0
      * BODY_EMPTY ?? yes
      the-empty-mail-folder
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        This is more designed to be part of other modules. If you just want
        to check for empty message, a simpler recipe like this might be
        better:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-javar.rc
 
      :0 B:         # if body has only whitespace characters
      *$ ! $NSPC
      the-empty-mail-folder
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="95" id="95"></A>
  <H2>
      Required settings
      
  </H2>



 
        (none)
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="96"  id="96"></A>
    <H1>
    Pm-jafrom.rc &ndash; get message's best FROM field without calling `formail'
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="97" id="97"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto
        $keywords:      procmail,  subroutine, extract FROM $
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="98" id="98"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc extracts the most likely FROM address from the
        message. The order of the search is Reply-to, From_, Sender, From
        and if none found, then as a last resort, call <SAMP class="word">formail</SAMP>. You would
        usually use the returned value for logging purposes.
 

<P class="column8">
        Avoiding extra formail call could be usefull if you receive lot
        of messages per day.
 

<P class="column8">
        Example input
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      (none)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      OUTPUT, containing the derived FROM field
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="99" id="99"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there. You nee procmail 3.11pre7 in
        order to use this subroutine. (due to formail -z switch)
 

</P>
  <A name="100" id="100"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (none)
 

</P>
  <A name="101" id="101"></A>
  <H2>
      Usage example
      
  </H2>



 
        INCLUDERC = $PMSRC/pm-jafrom.rc
        FROM      = $OUTPUT   # now we have the 'best' FROM field
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="102"  id="102"></A>
    <H1>
    Pm-jafwd.rc &ndash; Controlling forwarding remotedly
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="103" id="103"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $keywords:      procmail, subroutine,  forward mail $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="104" id="104"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Requires latest procmail (formail -z switch)
	<LI>You can send forward-on and forward-off control
	            messages via email to control the forwarding in remote site.
</UL>


 

</P>
  <A name="105" id="105"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc makes it possible to control your message forwarding
        via simple remote email message. Thanks to Era Eriksson and Timothy
        J Luoma who gave the initial idea to this forwarding module in the
        procmail mailing list 1997-10-07.
 

</P>
  <A name="106" id="106"></A>
  <H2>
      Activating the forwarding by hand
      
  </H2>



 
        If you want to activate the forwarding from the local site where
        this module is, then you could simply write the forward address
        to the file pointed by <EM class="word">JA_FWD_FILE</EM> which is <SAMP class="word">~/.forward-address</SAMP>
        by default.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % echo Me@somewhere.com &gt; ~/.forward-address
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        and when you no longer need forwarding, then remove that file.
        But really, this module is not used for that purpose, because it is
        lot easier to write
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0
      ! Me@somewhere.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        as a first statement in your .procmailrc when you want to forward
        your mail to another account.
 

</P>
  <A name="107" id="107"></A>
  <H2>
      Activating the forwarding by remote email
      
  </H2>



 
        Suppose you're on the road and suddenly realize that you want your
        mail forwarded to the current account, then you send following
        control message
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: forward-on password new-address@bar.com
      To: my-account@bar.com
      From: onTheRoad@some.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        That message is is enough to get the mail forwarded to the address
        new-address@bar.com This script will respond to address From that
        the current forwarding is now pointing to address
        &quot;new-address@bar.com&quot;.
 

</P>
  <A name="108" id="108"></A>
  <H2>
      Deactivating forwarding by remote email
      
  </H2>



 
        The message is very similar, but the Subject header says
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: forward-off password
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        And no other fields are checked. Not even Reply-To. In this case
        the confirmation message is sent directly back to From address.
 

</P>
  <A name="109" id="109"></A>
  <H2>
      Activating forwarding via body message
      
  </H2>



 
        If for some reason you have no control over the headers of email,
        eg when you send GSM-Mail message from your phone to your account:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      EMAIL foo@bar.com FORWARD-ON PASSWORD new-address@bar.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The email message looks like this:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      From: GenEmail &lt;EM&gt;<A HREF="mailto:sms@FooBar.net" >sms@FooBar.net</A>&lt;/EM&gt;
      Date: Thu Sep 17, 11:42am +0200
      To:   &quot;'Foo.Bar'&quot; foo@bar.com
      Subject: Message 03384874987
 
      FORWARD-ON PASSWORD new-address@bar.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Instead of looking at the <SAMP class="word">Subject</SAMP> field, you can get this module
        to look at the first words in the body field. See variable
        <SAMP class="word">JA_FWD_CONTROL_FIELD</SAMP> which you want to set to &quot;body&quot;.
 

</P>
  <A name="110" id="110"></A>
  <H2>
      Restricting the control message aceptance
      
  </H2>



 
        If you only have persistent accounts, then you should set the
        <EM class="word">JA_FWD_FROM_MUST_MATCH</EM> to match those addresses that you have.
        The following setting says that only control messages sent from
        these addresses are accepted. Nobody else can't change your
        forwarding settings.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_FWD_FROM_MUST_MATCH = &quot;.*(acc1@a.com|acc2@b.com)&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Hm, that's not a bullet proof, because someone may in theory forge
        the From address. You probably should also set this variable to
        point to accounts where the mail can be legally forwarded to. Then,
        even if the imposter forges the From address; he can't get the
        email forwarded anywhere else than to the valid locations.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_FWD_TO_MUST_MATCH = $JA_FWD_FROM_MUST_MATCH
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Consider also setting <EM class="word">JA_FWD_PASSWORD_CASE</EM> to Procmail flag
        <SAMP class="word">D</SAMP> which causes your control word &quot;forward-on&quot; and password
        to be case sensitive.
 

</P>
  <A name="111" id="111"></A>
  <H2>
      Diagnostics
      
  </H2>



 
        If you don't receive confirmation message, then your control
        message was ill formed or you're not in the <EM class="word">JA_FWD_FROM_MUST_MATCH</EM>
        list. There is no notification sent on failure, so that no attacker
        can draw conclusions.
 

</P>
  <A name="112" id="112"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="113" id="113"></A>
  <H2>
      Installation
      
  </H2>



 
        You should preset all necessary variables prior adding the
        includerc command to your .procmailrc. Here is one simple setup
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #JA_FWD_SENDMAIL    = &quot;tee $HOME/test.mail&quot; # Uncomment if testing
      JA_FWD_COPY         = no    # no copies stored while forwarding
      JA_FWD_PASSWORD_CASE= &quot;D&quot;   # case sensitive
      JA_FWD_PASSWORD     = &quot;MyMagicString&quot;
      JA_FWD_FROM         = $FROM # This is already known.
      INCLUDERC           = $PMSRC/pm-jafwd.rc
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="114" id="114"></A>
  <H2>
      Comments from the author
      
  </H2>



 
        Please realise that when you set the forwarding from a remote site,
        be very carefull when you type in the forward address or your mail
        ends up to somebody else's mailbox. Also I recommend that you keep
        <EM class="word">JA_FWD_COPY</EM> to <EM class="word">yes</EM> so that your local account always keep the
        copy of forwarded message.
 

<P class="column8">
        A step further would conventionally encrypt(1)'ing your forwarded
        messages. This way even your top secret messages would be mostly safe
        even if they end up to someone else's mailbox.
 

</P>
  <A name="115" id="115"></A>
  <H2>
      File layout
      
  </H2>



 
        tinybm.el/&amp;tags and tinytab.el for the 4 tab text placement. See
        also unix what(1) and GNUS RCS ident(1).
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="116"  id="116"></A>
    <H1>
    Pm-jalist.rc &ndash; Subroutine to detect mailing LIST from message.
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="117" id="117"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1998-2004 Jari aalto<BR>
        $Keywords:     procmail, subroutine, mailing list detect $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="118" id="118"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine tries to detect and derive the mailing list name as
        it appears in some of the known methods that ezlm, smarlist,
        listserv, majordomo etc. normally use. After this subroutine has
        been applied to message the variable <SAMP class="word">LIST</SAMP> contains the mailing
        list name. Subroutine adaptively finds new new mailing lists
        from the messages. The alternative to subscribing to many
        mailing lists is to read them from web archives. Even better
        way is to use NNTP server at <A HREF="http://www.gmane.org" target="_top">http://www.gmane.org</A> which
        allows you to post as you would to a regular newsgroup. Consider
        using the NNTP interface and you may save you from receiving
        lot of messages that can already be found from Gmane's server.
 

</P>
  <A name="119" id="119"></A>
  <H2>
      Quick start
      
  </H2>



 
        If you just want to jump in and use this module and you
        see that some list isn't trapped, please set
 

<P class="column8">
	<UL>
	<LI>JA_LIST_HEADER_REGEXP to match the From: field
</UL>


 

<P class="column8">
        If you want to make some list more unique, like if name &quot;Alert&quot;
        was detected as list name, please set
 
<UL>
	<LI>JA_LIST_MAKE_UNIQUE to match the list name, like &quot;Alert&quot;.
	            After that the list name will be converted to HOST-LIST format.
</UL>


 

</P>
  <A name="120" id="120"></A>
  <H2>
      Sendmail plus method for list subscription
      
  </H2>



 
        If you can use sendmail PLUS addressing capabilities, you may not
        be interested in this module, because you have an alternative way
        to handle mailing list messages. Let's suppose you want to
        subscribe to procmail mailing list and want to save all messages
        to folder list.procmail, then you'd subscribe with address:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      login+list.procmail@site.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The extra information after &quot;+&quot; is available to your procmail
        scripts via $ARG pseudo variable when procmail is the LDA. If you
        fortunate to have new sendmail, you usually subscribe to mailing
        lists with regular email address:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      login@site.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        How do you detect the arriving mailing list messages?
        Traditionally, you would add a piece of recipe to <SAMP class="word">~/.procmailrc</SAMP> to
        catch each list, but that's manual work every time. When you use
        this subroutine, you no longer need to write separate mailing list
        recipes to your <SAMP class="word">~/.procmailrc</SAMP> every time you subscribe to a new
        mailing list. The detection of a new list happens in this
        subroutine for you.
 

</P>
  <A name="121" id="121"></A>
  <H2>
      What you need to know before using this module
      
  </H2>



 
        There is lot of heuristics going on in this module and one thing
        that you must note:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      If 'To:' domain is same as `From/Sender:/Reply-to:' domain
      then it is considered a mailing list message.
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        This causes certain messages to be treated to category LIST.
        This module can't possibly know that the following is not from
        mailing list, because it doesn't know &quot;what is mailing list&quot;, only
        &quot;how it probably looks like it&quot;. This is definitedly categorized as
        mailing list message, because <SAMP class="word">From</SAMP> and even <SAMP class="word">Reply-to</SAMP> has the same
        domain <SAMP class="word">foo.bar.net</SAMP> as in <SAMP class="word">To</SAMP>.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      To: support@foo.bar.net
      From: message@foo.bar.net
      Reply-to: support@foo.bar.net
      Subject: Vmail See message to Eric
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        You must prevent checking messages like this by surrounding call
        to this subroutine with a check statement:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #   Do not check these messages
 
      noList = &quot;From.*(foo.bar.net|support.my.com)&quot;
 
      :0
      *$ ! $noList
      {
          INCLLUDERC = $RC_LIST
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="122" id="122"></A>
  <H2>
      Ask for help
      
  </H2>



 
        If you find mailing lists that this subroutine does not detect, but
        which could have been detected by looking the headers in standard
        way, please send a email to maintainer. There may be cases where it
        is impossible to detect the mailing list and in those cases you
        just has to carve a new entry to your <SAMP class="word">~/.procmailrc</SAMP>.
        When you keep your procmail log running, you may see message
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>       *** potential list ***
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Which is an indication that some new recipe could be added to
        to this subroutine to detect that mailing list. If the message
        you received <STRONG class="word">was</STRONG> from a mailing list, please send all the headers
        to the maintainer so that support can be added.
        You can search for mailing list that interests you at:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      <A HREF="http://www.lsoft.com/lists/listref.html" target="_top">http://www.lsoft.com/lists/listref.html</A>
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Python based mailing list manager; the mailman:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      <A HREF="http://www.list.org/" target="_top">http://www.list.org/</A>
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="123" id="123"></A>
  <H2>
      Code note: Errors-To
      
  </H2>



 
        Bill Houle sent interesting headers which caused to add
        more heuristic than was feasible to solve the list detection.
        From the below headers it is practically impossible to derive the
        original list name. So, the list name is artificially constructed
        by combining Reply-To's LOGIN with Errors-To field's first host
        name
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Reply-To: news@doodle.foo.net
      Errors-To: bounced@doodle.foo.net
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The list name formed is &quot;news-doodle&quot;. So, If you happen to see
        an odd name like this which doesn't remind the original list
        name, it may be due to poor headers that have no clue about
        the real name. No problem, check below how you would convert
        this name to better mailbox name.
 

</P>
  <A name="124" id="124"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will followign extra module, which must have been installed.
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="125" id="125"></A>
  <H2>
      Variable JA_LIST_FROM_TO_IGNORE
      
  </H2>



 
        This is regexp of sender addresses to ignore so that the if To and
        From are identical, it is not considered a list messages. This is
        typical for system generated messages that take form:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      From: root@host (Cron Daemon)
      To: root@host
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="126" id="126"></A>
  <H2>
      Variable JA_LIST_SAVE
      
  </H2>



 
        If set to &quot;yes&quot; then the list name information detected is saved to
        separate header. The <SAMP class="word">LIST_DETECTED</SAMP> is the original grabbed word from
        the headers and the 'LIST' is the final name after possible
        list name conversions. According to RFC the X- can be user for
        user headers.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      X-List-Detected: $LIST_DETECTED mapped to $LIST
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="127" id="127"></A>
  <H2>
      Variable JA_LIST_KILL_POSTFIX
      
  </H2>



 
        If grabbed <SAMP class="word">LIST</SAMP> match this regexp at the end of list name, then
        the postfix match will be removed. It is traditional that many
        lists names are like list1-info, list2-beta, list3-l and you
        would prefer more names (for mbox) list1, list2 and list3. The
        default value will ditch &quot;-(info|beta|l)&quot;.
 

</P>
  <A name="128" id="128"></A>
  <H2>
      Variable JA_LIST_KILL_PREFIX
      
  </H2>



 
        Just like the postfix variable. If this string is matched at the
        beginning of the LIST, it is removed.
 

</P>
  <A name="129" id="129"></A>
  <H2>
      Variable JA_LIST_DISREGARD_EMAIL
      
  </H2>



 
        I some cases this list detection recipe &quot;thinks&quot; that the address
        picked is the list sender. You may have a dedicated address where
        all you mailing list mails arrive and you have named it like
        mailing-list@me.here.at, which will effectively trigger: Ah,
        you have -list in email address, so this message must be from
        mailing list name 'mailing'. Of course it is not and you have to
        disallow the heuristics to make such assumption by defining a
        regexp that rejects a possible choice. For the above example, you
        would define:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_LIST_DISREGARD_EMAIL = &quot;posting-list@me.here.at&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you have several such addresses, just add them to the
        variable separating with normal regular expression &quot;|&quot; OR
        statement.
 

</P>
  <A name="130" id="130"></A>
  <H2>
      Variable JA_LIST_HEADER_REGEXP
      
  </H2>



 
        This is <EM class="word">optional</EM> variable, which you can set to match regexp of
        the mailing list domain address if it slipped through the tests
        in this module. There are some lists that send messages that don't
        carry enough information in headers to determine their list status.
        If you narrow the group by setting JA_LIST_HEADER_REGEXP, then for
        example lists like these, that identify themselves only through
        two headers, can be found:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Reply-To: dispatch-faq@cnet.com
      From: CNET Digital Dispatch &lt;EM&gt;<A HREF="mailto:dispatch@cnet.com" >dispatch@cnet.com</A>&lt;/EM&gt;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        For that list you would set
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_LIST_HEADER_REGEXP = &quot;(@cnet\.com)&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Don't worry. all the other list detection recipes has already
        been tried, so this is last test that are carried out and variable
        JA_LIST_HEADER_REGEXP helps eliminating possible mishist
 

<P class="column9"><STRONG>
         You don't need set this variable to include all mailing list
         domains. Only to those ones that were not trapped. The default
         value for this is:</STRONG>

 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;(amazon\.com|bookpool\.com)&quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="131" id="131"></A>
  <H2>
      Variable JA_LIST_MAKE_UNIQUE
      
  </H2>



 
        If you're subscribed to many mailing lists, that simply tell that
        they are <EM class="word">news</EM> or <EM class="word">newsletter</EM>, it will be impossible to
        differiantiate A <EM class="word">news</EM> from B <EM class="word">news</EM>. This variable holds regular
        expression that, if matched, prepend the first host name to the
        beginning of list name, thus making the list unique:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      news@some.com       --&gt; some-news
      news@here.com       --&gt; here-news
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The default value matches lists that contain word <EM class="word">news</EM>, but you
        may need to set this to more matches.
 

</P>
  <A name="132" id="132"></A>
  <H2>
      Variable JA_LIST_CONVERSION
      
  </H2>



 
<P>
<TABLE  class="shade-note"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-note-attrib" valign="top">
    <B>      Note:</B> before using this feature, make sure your <SAMP class="word">LINEBUF</SAMP>
      is big enough, say 4096 or otherwise the variable's content
      is truncated.
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Many times the grabbed <SAMP class="word">LIST</SAMP> name is not what you would like to
        use for your mailbox name. You want to make the name perhaps
        more shorter, more descriptive or categorize the messages according
        to hierarchy. Let's say that you have subscribed to following mailing
        lists:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      LIST            LIST name    Description of mailing list
      (as grabbed)    you want
      -------------------------------------------------------------
      jde             java.jde    Java Development Env
      java            java.lang   Java programming
      FLAMENCO        flamenco    Flamenco music
      tango-l         tango       Argentine Tango dancing
      tm-en-help      tm-en       Emacs TM mime package mailing list
      w3-beta         w3          Emacs WWW mailing list
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        First, remember that the variable <SAMP class="word">JA_LIST_KILL_POSTFIX</SAMP> is first
        applied, so the actual <SAMP class="word">LIST</SAMP> appears as follows:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      jde, java, FLAMENCO, tango, tm-en, w3
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Ok, now we apply the conversion table by defining it as follows,
        where the grabbed LIST is first, then comes space(s), new name
        <STRONG class="word">and</STRONG> terminating colon. Repeat this for each list you want to
        convert.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      LIST CONVERSION,LIST CONVERSION,
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        This gives us table below: notice that entries tango-l, w3-beta
        were not included, because the <SAMP class="word">JA_LIST_KILL_POSTFIX</SAMP> already got
        rid of the postfixes. Also note how the uppercase match FLAMENCO is
        converted to more suitable lowercase mailbox name. After you have
        set up this variable you can start saving messages to folders.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_LIST_CONVERSION = &quot;\
      jde       java.jde,\
      java      java.lang,\
      FLAMENCO  flamenco,\
      &quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The list conversion is done with pure procmail means, so it is very
        fast. It also means that the conversion is limited to FROM-STRING
        TO-STRING syntax. No wild cards or regular expressions are allowed.
 

<P class="column10"><EM class="quote10">
          If you consider using an external process, like <SAMP class="word">sed</SAMP> or <SAMP class="word">perl</SAMP>
          to convert the grabbed list name to something else (when
          <SAMP class="word">JA_LIST_CONVERSION</SAMP> method was not enough); think again. For
          each incoming mailing list message you launch external process.
          It is not unusual to receive 700 messages from various mailing
          lists a day, it can be imagined how much load any external
          process would add to the server. Use the grabbed mailing list
          name and <SAMP class="word">JA_LIST_CONVERSION</SAMP> table if you care about system
          load.</EM>

 

<P class="column8">
        If you have many mailing lists that use uppercase names, it may be
        tedious to add each mailing list name to <SAMP class="word">JA_LIST_CONVERSION</SAMP>.
        Possible alternative is to us  very efficient <SAMP class="word">tr</SAMP> program
        to convert  characters to lowercase. Again; think twice,
        because any extra process could be avoided if <SAMP class="word">JA_LIST_CONVERSION</SAMP>
        was used.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0
      * ! LIST ?? ^^^^
      {
          :0 D            # still uppercase list name?
          * LIST ?? [A-Z]
          {
              LIST = `echo $LIST | tr A-Z a-z`
          }
 
          :0 :
          list.$LIST
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="133" id="133"></A>
  <H2>
      List name is not always the same
      
  </H2>



 
        One important thing to keep in mind is that when mailing list
        manager sends out list messages, the headers may some times change.
        This means that the list name grabbed by previous calls changes,
        although the list in practice has not changed at all.
        This is unfortunate, but it sometimes happens. Let's see an example.
        I was previously receiving messages from Cygwin mailing list named
        <SAMP class="word">gnu-win32</SAMP>
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      To: &lt;EM&gt;<A HREF="mailto:gnu-win32@cygnus.com" >gnu-win32@cygnus.com</A>&lt;/EM&gt;, &quot;Foo Bar&quot; foo@example.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        However, one day that same list was grabbed under name &quot;cygwin&quot;, due
        to new header
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Mailing-List: contact cygwin-help@sourceware.cygnus.com; run by ezmlm
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Now I had two list names that both should be going to the same mailbox.
        No worries, just add new entry to the translate table to convert
        the new list name to mailbox name:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_LIST_CONVERSION = &quot;\
      gnu-win32           cygwin32,\
      cygwin              cygwin32,\
      &quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="134" id="134"></A>
  <H2>
      Example: basic installation
      
  </H2>



 
        Here is recipe to save all your mailing list to separate folders.
        If you subscribe to new lists or unsubscribe to lists, you don't
        need to change anything. The grabbed list name will appear
        in variable <SAMP class="word">LIST</SAMP>
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      RC_LIST = $PMSRC/pm-jalist.rc   # name the subroutine
 
      ...
 
      #   Handle all mailing lists with one subroutine and recipe
      #   following it
 
      INCLUDERC = $RC_LIST
 
      :0                          # if list name was grabbed
      * LIST ?? [a-z]
      {
          dummy = &quot;Saving mailing list: $LIST&quot;
 
          :0 :
          list.$LIST
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="135"  id="135"></A>
    <H1>
    Pm-jamime-decode.rc &ndash; decode MIME body contents; quoted-printable, base64
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="136" id="136"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1998-2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, mime $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="137" id="137"></A>
  <H2>
      Documentation
      
  </H2>



 
        The original father of the decoding scheme used here was
        presented by Peter Galbraith <EM><A HREF="mailto:galbraith@mixing.qc.dfo.ca" >galbraith@mixing.qc.dfo.ca</A></EM> in
        procmail mailing list somewhere at the end of 1997.
 

<P class="column8">
        This includerc supposes that the header has MIME header
        Content-Type: text/plain and performs qp or base64 decoding
        on the whole message. Note, that if you receive messages that
        have many mime attachments, then this recipe is not suitable
        for it.
 

<P class="column8">
        Procmail is <EM class="word">not</EM> designed to handle mime attachments and this
        recipe only applies to whole <STRONG class="word">body</STRONG>.
 

<P class="column8">
        The pm-jamime-kill.rc is really stretching the limits and any
        serious works hould be delegated to appropriate Perl MIME modules.
        There is a Perl MIME module which will allow you to manipulate MIME
        body parts rather elegantly. See
        <A HREF="http://www.perl.com/CPAN-local/authors/Eryq/" target="_top">http://www.perl.com/CPAN-local/authors/Eryq/</A> for MIME-tools.
 

<P class="column8">
        Se also mimedecode at <A HREF="ftp://ftp.dde.dk/pub/mimedecode.c" target="_top">ftp://ftp.dde.dk/pub/mimedecode.c</A> which
        in included in Debian Linux.
 

</P>
  <A name="138" id="138"></A>
  <H2>
      Notes
      
  </H2>



 
        Perl and it's modules are not used, because Perl is so CPU intensive.
        If we can do it with Procmail, let's do it. When we can't, we must give
        the task to outside processes and pay the penalty. Consider this
        seriously if you get hundreds of mails per day from mailing
        lists.
 

</P>
  <A name="139" id="139"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="140" id="140"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (none)
 

</P>
  <A name="141" id="141"></A>
  <H2>
      Return values
      
  </H2>



 
        (none)
 

</P>
  <A name="142" id="142"></A>
  <H2>
      Examples
      
  </H2>



 
        Instead of testing the existence of text/plain in the body,
        you can force decoding by settings JA_MIME_DECODE_REGEXP to
        &quot;.*&quot;.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      RC_MIME_DECODE = $PMSRC/pm-jamime-decode.rc
 
      :0
      * condition
      {
          JA_MIME_DECODE_REGEXP = &quot;.*&quot;
      }
 
      INCLUDERC = $RC_MIME_DECODE     # call subroutine.
    </TD>
    </TR>
</TABLE>
 
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="143"  id="143"></A>
    <H1>
    Pm-jamime-kill.rc &ndash; General MIME attachment killer (vcards, html)
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="144" id="144"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, subroutine, MIME killer $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="145" id="145"></A>
  <H2>
      Description
      
  </H2>



 
<P>
<TABLE  class="shade-note"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-note-attrib" valign="top">
    <B>      Note:</B> If you think this module can do miracles, it cannot.
      MIME messages are very complex in structure and all this module
      can do is to detect <EM class="word">simple</EM> attachements. It cannot be used
      as - all purpose - all detecting - MIME attachement killer.
      But the part it can do is done efficiently, because most of the
      things are accomplished using procmail and resource friendly
      <SAMP class="word">awk</SAMP>.
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Microsoft Explorer has a bad habit of including 7k
        application/ms-tnef attachment to the end of message. The sample
        message is described in next section. If you don't want to see that
        additional ms-tnef attachment, then plug in this module and you no
        longer see MS Explorer cruft.
 

<P class="column8">
        This recipe works like this: If email's structure is
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      --boundary
      message-text (maybe quoted-printable)
      --boundary
      some-unwanted-mime-attachment
      --boundary
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        then the attachment is killed from the body. The message-text part
        is also decoded if it was quoted printable. This leaves clean text;
        with no MIME anywhere. MIME headers have been modified as needed
        (due to conversion from multi part and possibly quoted printable to
        plain text):
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      message
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        But if email's structure was anything else, like if there were 3
        mime sections:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      --boundary
      message-text (maybe quoted-printable)
      --boundary
      some-attachment
      --boundary
      some-unwanted-mime-attachment
      --boundary
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        then the &quot;unwanted&quot; part is emptyed by replacing area with one
        empty line. The message structure stays the same, but the killed
        &quot;unwanted&quot; part is labelled as text/plain so that your MUA will
        decode the MIME message correctly.
 

</P>
  <A name="146" id="146"></A>
  <H2>
      Applications for other mime attachments
      
  </H2>



 
        All these are covered in this module:
 
<UL>
	<LI>Lotus Notes sends similar extra attachment and you can use this
            same recipe to kill it. See example section.
	<LI>Microsoft Express sends a copy of message in HTML format in the
            attachment, you can kill that too, see example section.
	<LI>Netscape's Mozilla sends a copy of message in HTML. See example.
            Also it sends <SAMP class="word">vcards</SAMP>
	<LI>Openmail sends 10-20 base64 attachments WINMAIL.DAT.
</UL>


 

</P>
  <A name="147" id="147"></A>
  <H2>
      Example of lotus notes attachment
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: message
      From: foo@bar.com
      X-Lotus-FromDomain: XXX COMPANIES
      Mime-Version: 1.0
        Boundary=&quot;0__=cieg4oHxUNf2h3evyOXIsHTGDpFfaZilTDCFhpZSgsw&quot;
      Content-Type: multipart/mixed;
        Boundary=&quot;0__=cieg4oHxUNf2h3evyOXIsHTGDpFfaZilTDCFhpZSgsw&quot;
 
      --0__=cieg4oHxUNf2h3evyOXIsHTGDpFfaZilTDCFhpZSgsw
      Content-type: application/octet-stream;
          name=&quot;PIC10898.PCX&quot;
      Content-transfer-encoding: base64
 
      eJ8+IjsQAQaQCAAEAAAAAAABAAEAAQeQBgAIAAAA5AQAAAAAAADoAAEIgAcA
      b3NvZnQgTWFpbC5Ob3RlADEIAQ2ABAACAAAAAgACAAEEkAYAyAEAAAEAAAAQ
 
      &lt;AND-THE-REST-OF-BASE64&gt;
 
      --0__=cieg4oHxUNf2h3evyOXIsHTGDpFfaZilTDCFhpZSgsw--
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="148" id="148"></A>
  <H2>
      Example of MS Explorer's ms-tnef message
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: message
      From: foo@bar.com
      MIME-Version: 1.0
      Content-Type: multipart/mixed;
          boundary=&quot;---- =_NextPart_000_01BD04D4.A5AC6B00&quot;
      Lines: 158
 
      ------ =_NextPart_000_01BD04D4.A5AC6B00
      Content-Type: text/plain; charset=&quot;iso-8859-1&quot;
      Content-Transfer-Encoding: quoted-printable
 
      &lt;MESSAGE ITSELF IS HERE&gt;
 
      ------ =_NextPart_000_01BD04D4.A5AC6B00
      Content-Type: application/ms-tnef
      Content-Transfer-Encoding: base64
 
      eJ8+IjsQAQaQCAAEAAAAAAABAAEAAQeQBgAIAAAA5AQAAAAAAADoAAEIgAcA
      b3NvZnQgTWFpbC5Ob3RlADEIAQ2ABAACAAAAAgACAAEEkAYAyAEAAAEAAAAQ
 
      &lt;AND-THE-REST-OF-BASE64&gt;
 
      ------ =_NextPart_000_01BD04D4.A5AC6B00--
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="149" id="149"></A>
  <H2>
      Example of MS Express's HTML message
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      MIME-Version: 1.0
      Content-Type: multipart/alternative;
          boundary=&quot;----=_NextPart_000_003A_01BD16E2.C97E27B0&quot;
      X-Mailer: Microsoft Outlook Express 4.72.2106.4
      X-MimeOLE: Produced By Microsoft MimeOLE V4.72.2106.4
 
      This is a multi-part message in MIME format.
 
      ------=_NextPart_000_003A_01BD16E2.C97E27B0
      Content-Type: text/plain;
          charset=&quot;iso-8859-1&quot;
      Content-Transfer-Encoding: quoted-printable
 
      &lt;ACTUAL TEXT&gt;
 
      ------=_NextPart_000_003A_01BD16E2.C97E27B0
      Content-Type: text/html;
          charset=&quot;iso-8859-1&quot;
      Content-Transfer-Encoding: quoted-printable
 
      &lt;SAME IN HTML&gt;
      ------=_NextPart_000_003A_01BD16E2.C97E27B0--
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="150" id="150"></A>
  <H2>
      Example of Netscape's HTML attachment
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      X-Mailer: Mozilla 4.04 [en] (X11; U; Linux 2.0.33 i686)
      MIME-Version: 1.0
      Content-Type: multipart/alternative;
          boundary=&quot;------------69D9D579CF587DC8BB26C49C&quot;
    </TD>
    </TR>
</TABLE>
 
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      --------------69D9D579CF587DC8BB26C49C
      Content-Type: text/plain; charset=us-ascii
      Content-Transfer-Encoding: 7bit
 
      &lt;ACTUAL TEXT&gt;
 
      --------------69D9D579CF587DC8BB26C49C
      Content-Type: text/html; charset=us-ascii
      Content-Transfer-Encoding: 7bit
 
      &lt;SAME IN HTML&gt;
      --------------69D9D579CF587DC8BB26C49C--
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="151" id="151"></A>
  <H2>
      Example of Netscape's vcard attachment.
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Content-Type: text/x-vcard; charset=us-ascii; name=&quot;vcard.vcf&quot;
      Content-Transfer-Encoding: 7bit
      Content-Description: Card for Laird Nelson
      Content-Disposition: attachment; filename=&quot;vcard.vcf&quot;
 
      begin:          vcard
      fn:             Laird Nelson
      n:              Nelson;Laird
      org:            Perot Systems Corporation
      email;internet: ljnelson@unix.amherst.edu
      title:          Software Engineer
      tel;work:       (617) 303-5059
      tel;fax:        (617) 303-5293
      tel;home:       (978) 741-3126
      note;quoted-printable:Information is for reference only;=0D=0A=
              please do not abuse it.
      x-mozilla-cpt:  ;0
      x-mozilla-html: TRUE
      version:        2.1
      end:            vcard
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="152" id="152"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jamime.rc
</UL>


 

</P>
  <A name="153" id="153"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        First of all, this is primarily a framework recipe to kill any kind
        of attachment. If you do not set JA_MIME_TYPE before calling
        this recipe, recipe will try to determine the right value by itself.
        See if the automatic detection works for you or preset the
        JA_MIME_TYPE beforehand if it fails (I'd like to hear about the
        failure and add the conditions as default)
 
<UL>
	<LI><SAMP class="word">JA_MIME_TYPE</SAMP> is an case sensitive AWK <EM class="word">REGEXP</EM>. Always use
            <EM class="word">lowercase</EM> letters in this regexp because the line is lowercased
            before match is made. This regexp determines if the kill
            recipe is applied to the message or not. Value is set for
            MS explorer, MS express, Netscape and Lotus Notes etc.
            messages by default.
	<LI><SAMP class="word">JA_MIME_KILL_RE</SAMP>, additional <EM class="word">REGEXP</EM> to kill lines from the
            message. Value is case sensitive awk regexp and by default matches
	            Lotus notes tag: name=&quot;XXX.PCX&quot;.
</UL>


 

<P class="column8">
        It may be possible that some messages are malformed and that they
        do not contain proper &quot;boundary&quot; definition string in the header. I
        have seen messages that have text/html attachments, but no proper
        Mime headers. For those cases there is additional variable that
        will kill all text up till matching line regardless of message
        content.
 
<UL>
	<LI><SAMP class="word">JA_MIME_KILL2_RE</SAMP> is set to &quot;text/html|application/ms-tnef&quot;.
            Update this to match attchements you receive. Set variable to
            &quot;&quot; if you don't want to change the body of non-compliant MIME
	            message.
</UL>


 

<P class="column8">
        That is your last resort if the standard MIME detection failed.
        (there must have been some problem in the sender's MUA that composed
        message)
 

</P>
  <A name="154" id="154"></A>
  <H2>
      Possible conflict with your awk
      
  </H2>



 
        If you see an error message in the log file saying that awk failed:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      procmail: Executing awk,
      ...
      procmail: Error while writing to &quot;awk&quot;
      procmail: Rescue of unfiltered data succeeded
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        it means that the system's standard <SAMP class="word">awk</SAMP> doesn't support the
        variable passing syntax: do following test
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % awk '{print VAR; exit}' VAR=&quot;value&quot; /etc/passwd
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        And it should print &quot;value&quot;. If not, then see if you have <SAMP class="word">nawk</SAMP> or
        <SAMP class="word">gawk</SAMP> is your system, which should understand the variable passing
        syntax. The only change you need is to define variable AWK
        somewhere at the top of your <SAMP class="word">.procmailrc</SAMP>.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      AWK = &quot;nawk&quot;        # if that works better than standard &quot;awk&quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="155" id="155"></A>
  <H2>
      Warnings
      
  </H2>



 
        You should know that the variable <SAMP class="word">JA_MIME_KILL_RE</SAMP> is used to wipe
        any lines that match that regexp. This is due to MIME structure
        where continuing header lines exist in the body:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      ------=_NextPart_000_003A_01BD16E2.C97E27B0
      Content-Type: text/plain;
          charset=&quot;iso-8859-1&quot;                &lt;&lt; kill this line too
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you want to be absolutely sure that anything valuable won't be
        accidentally killed (like a code line in programming language scripts),
        you should set this variable to nonsense value that newer matches:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_MIME_KILL_RE = &quot;match_it_never_I_hope&quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="156" id="156"></A>
  <H2>
      Usage example: Customizing the attachment killing
      
  </H2>



 
        Suppose you receive new <SAMP class="word">application/ms</SAMP> type attachment that the
        default settings doesn't cover. This is a new mime type and you
        have to instruct this module to kill it. Add this and similar
        tests for other mime types:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      myCustomMimeType = &quot;application/ms&quot;     # must be all lowercase
 
      :0
      *$ $myCustomMimeType
      {
          PM_JA_MIME_TYPE = $myCustomMimeType
      }
 
      INCLUDERC = $PMSRC/pm-jamime-kill.rc
    </TD>
    </TR>
</TABLE>
 
 

</P>
  <A name="157" id="157"></A>
  <H2>
      Usage example
      
  </H2>



 
        For default mime types mentioned earlier, you just plug-in this module:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-jamime-kill.rc
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you want to do all by yourself, add this to your
        <SAMP class="word">~/.procmailrc</SAMP>. This demonstrates how the correct MIME types are
        detected:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      # .....................................................
      # 1) Uncomment following line if your standard &quot;awk&quot; is broken
 
      # AWK = &quot;gawk&quot;
 
      # .....................................................
      #  2) Next set correct value for attachment killing
 
      #  Kill Lotus notes .pcx attachments [already included]
 
      :0
      * ^X-Lotus-FromDomain:
      {
          JA_MIME_TYPE = &quot;application/octet-stream&quot;
      }
 
      #   Kill all html attachments
 
      :0
      * B ?? ^Content-Type:.*text/html
      {
          JA_MIME_TYPE = &quot;text/html&quot;
      }
 
      # .....................................................
      #  3) And now handle the message
      #    by default kill MS Explorer's ms-tnef attachment.
 
      INCLUDERC = $PMSRC/pm-jamime-kill.rc
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="158"  id="158"></A>
    <H1>
    Pm-jamime.rc &ndash; subroutine to read mime boundary etc. variables
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="159" id="159"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, subroutine, mime $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="160" id="160"></A>
  <H2>
      Documentation
      
  </H2>



 
        This includerc reads MIME boundary string from the message
        if it exists. The boundary string is typically found from
        Content-Type header.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Mime-Version: 1.0
      Content-Type: multipart/mixed; boundary=9i9nmIyA2yEADZbW
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        In addition it will define few other mime variables. See the
        returned values. You use these variables later in your MIME
        message processing.
 

</P>
  <A name="161" id="161"></A>
  <H2>
      Mime Notes
      
  </H2>



 
        1998-07-28 Brett Glass <EM><A HREF="mailto:brett@lariat.org" >brett@lariat.org</A></EM> reported in PM-L that
        there was security exploit in long attachment filenames:
        <A HREF="http://www.xray.mpe.mpg.de/mailing-lists/procmail/1998-07/msg00248.html" target="_top">http://www.xray.mpe.mpg.de/mailing-lists/procmail/1998-07/msg00248.html</A>
 

<P class="column8">
        And here is the url to the matter:
 

<P class="column8">
        <A HREF="http://www.sjmercury.com/business/microsoft/docs/security0728.htm" target="_top">http://www.sjmercury.com/business/microsoft/docs/security0728.htm</A>
 
 

<P class="column8">
        When you use this module to detect mime messages, you can check the
        filename length with recipe:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #  Recipe after calling $RC_MIME, this module,
 
      re       = &quot;..........&quot;     # regexp with 10 matches
      too_long = &quot;$re$re$re$re&quot;   # allow 40 characters maximum
 
      :0
      *$ $SUPREME^0  MIME_H_ATTACHMENT ?? $re
      *$ $SUPREME^0  MIME_B_ATTACHMENT ?? $re
      {
          dummy = &quot;** Dangerously long mime attachment filename&quot;
          dummy = &quot;** $MIME_H_ATTACHMENT $MIME_B_ATTACHMENT&quot;
 
          :0 :
          /var/spool/mail/MimeDanger
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="162" id="162"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="163" id="163"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (none)
 

</P>
  <A name="164" id="164"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI>Variable MIME is set to &quot;yes&quot; or &quot;no&quot; if messages has mime version
            string
	<LI>MIME_VER contains the mime version string from the header.
	<LI>MIME_TYPE contains the Content-Type from the header.
	<LI>MIME_CTE contains Content-Transfer-Encoding from the header.
	<LI>MIME_H_QP is &quot;yes&quot; if Content-Transfer-Encoding: quoted-printable
            is in the header.
	<LI>MIME_B_QP is &quot;yes&quot; if Content-Transfer-Encoding: quoted-printable
            is found from the body.
	<LI>MIME_BOUNDARY contains the boundary string, which is used to
            differentiate mime sections in the body.
	<LI>MIME_BOUNDARY_COUNT is the number of boundary strings found
            from the body. The value is 3 if there is two mime sections,
            and 4 if 3 etc. MIME_BOUNDARY_COUNT -1 = count of sections.
	<LI>MIME_H_ATTACHMENT, contains the filename if there was attachement
            filename in the header. Content-Disposition: attachment;
            filename=&quot;...&quot;
	<LI>MIME_B_ATTACHMENT. <SAMP class="word">body</SAMP> file attachment. Note however that
            this is the match of first string in the body. There may be
            several attachments. MIME_B_ATTACHMENT_FILE_COUNT tells you
	            how many filenames are in the body.
</UL>


 

</P>
  <A name="165" id="165"></A>
  <H2>
      Usage example
      
  </H2>



 
        INCLUDERC = $PMSRC/pm-jamime.rc
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="166"  id="166"></A>
    <H1>
    Pm-jamime-save.rc &ndash; save message's MIME attachement (one file) to a file
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="167" id="167"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail, subroutine, mime $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="168" id="168"></A>
  <H2>
      Documentation
      
  </H2>



 
        This module saves <STRONG class="word">one</STRONG> simple file attachment (MIME) from he
        message. The message must define following MIME headers. If
        &quot;filename=&quot; does not exists, then the message will not be
        handled.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Mime-Version: &lt;version&gt;
      Content-Type: &lt;type&gt;
      Content-Disposition: attachment; filename=&quot;file.txt&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The last line can also be in separate line, provided that it
        is intended according to standard rules:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Mime-Version: &lt;version&gt;
      Content-Type: &lt;type&gt;
      Content-Disposition: attachment;
          filename=&quot;file.txt&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Procmail is not very suitable for saving MIME attachments and
        you should not think that this the right tool for you.
        If you receive anything more than 1 attachment, this recipe
        does nothing, because that's out of our league and you need some
        more heavy weight mime tools. E.g. Perl CPAN has MIME libraries.
 

<P class="column8">
        <STRONG class="word">Note</STRONG>: When the attachment is in the body, it is simply written
        to a disk and the location in message is replaced with test:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Extracted to file:/users/foo/junk/file.txt.1998-03-30
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The existing mime headers that surrounded the attachment are
        untouched, so don't try to press your Mail Agents MIME buttons
        at that point any more. There is no such file in that spot
        if you set <SAMP class="word">JA_MIME_SAVE_DEL</SAMP> to <SAMP class="word">yes</SAMP>).
 

</P>
  <A name="169" id="169"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This
        subroutine includes library:
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jamime.rc
	<LI>pm-jamime-decode.rc
	<LI>pm-jadate.rc (which will call other pm-jadate*.rc files)
</UL>


 

</P>
  <A name="170" id="170"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI><SAMP class="word">JA_MIME_SAVE_DIR</SAMP>, point this to directory where you
            want to store attachments.
	<LI><SAMP class="word">JA_MIME_SAVE_DECODE</SAMP>, set this to &quot;yes&quot;, if you want that
            attachment is decoded before written to disk. This usually
            opens quoted printable or base64 encoding.
	<LI><SAMP class="word">JA_MIME_SAVE_DEL</SAMP>, set this to &quot;yes&quot;, if you want to remove
            the attachment from the body of the message after it has
            been filed. Be vary careful if you use this option. If you
            keep backup cache of incoming mail, then you might try &quot;yes&quot;.
	<LI><SAMP class="word">JA_MIME_SAVE_OVERWRITE</SAMP>, set this to &quot;yes&quot; if it's okay to
            overwrite to an existing filename found from attachment.
            If you get periodic attachments always with same name, then
	            you would want to set this to yes.
</UL>


 

</P>
  <A name="171" id="171"></A>
  <H2>
      Core dump note
      
  </H2>



 
        Because procmail uses LINEBUF when filtering messages, a core
        dump may happen if the attachment being filtered is bigger than
        the LINEBUF. The current setting accepts 524K attachments, but if
        you expect to get bigger than that, you want to increase
        <SAMP class="word">JA_MIME_SAVE_LINEBUF</SAMP>.
 

</P>
  <A name="172" id="172"></A>
  <H2>
      Possible conflict with your awk
      
  </H2>



 
        Awk is used because it is much more system load friendly than perl.
        If you see an error message in the log file saying that awk failed:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      procmail: Executing awk,
      ...
      procmail: Error while writing to &quot;awk&quot;
      procmail: Rescue of unfiltered data succeeded
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        it means that the system's standard awk doesn't support the
        variable passing syntax. To verify that this is the case, run
        following test:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % awk '{print VAR; exit}' VAR=&quot;value&quot; /etc/passwd
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The proper awk should print &quot;value&quot;. If not, then see if you have
        <SAMP class="word">nawk</SAMP> or <SAMP class="word">gawk</SAMP> in your system, which should understand the
        variable passing syntax. To change the AWK, you need to set
        following variable somewhere at the top of your <EM class="word">.procmailrc</EM>
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      AWK = &quot;gawk&quot;        # if that works better than standard &quot;awk&quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="173" id="173"></A>
  <H2>
      Return values (none)
      
  </H2>



 
</P>
</BLOCKQUOTE>
<HR>
    <A name="174"  id="174"></A>
    <H1>
    Pm-janetmind.rc &ndash; handle <A HREF="http://minder.netmind.com/" target="_top">http://minder.netmind.com/</A> messages
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="175" id="175"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;    1998-2004 Jari Aalto<BR>
        $Keywords:       procmail netmind recipe $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="176" id="176"></A>
  <H2>
      Description
      
  </H2>



 
        <A HREF="http://minder.netmind.com/" target="_top">http://minder.netmind.com/</A>
 

<P class="column8">
        ...Netmind, or The URL-minder is a free, automatic Web-surfing robot
        that keeps track of changes to Web pages that are important to you.
        When the URL-minder detects changes in any of the Web pages you
        have registered, it sends you e-mail. an effective way to test if
        the address is known to Internet. You could use this information to
        see if some automated reply to a address can be sent.
 
 

<P class="column8">
        In another words, if you're interested in some URL; say an FAQ page
        and any updates to them, you can tell Netmind to monitor the page
        changes for you and it send a message back every time page changes.
 

<P class="column8">
        This recipe &quot;pretty formats&quot; the announcement sent by Netmind
        by stripping the message to bare minimum. You usually aren't interested
        in 4k message which includes &quot;Note from our sponsors&quot;, &quot;Try the free
        online demo&quot; etc. The things saved from the announcement message are:
 
<UL>
	<LI>The changed url, which is moved to subject
	<LI>Cancellation url pointer
	<LI>url to the lists of your monitored urls
	<LI>your id number
</UL>


 

<P class="column8">
        <SPAN class="word-ref">[Note]</SPAN>
 

<P class="column8">
        Please let Netmind send you one &quot;pure&quot; message first so that you
        have a huch what it originally looks like. Then plug int his module
        and see how the original message is reduced.
 

<P class="column8">
        <SPAN class="word-ref">[Thank you]</SPAN>
 

<P class="column8">
        The Doctor What <EM><A HREF="mailto:docwhat@holtje-christian-isdn.mis.tandem.com" >docwhat@holtje-christian-isdn.mis.tandem.com</A></EM>
        1998-03-12 send me a patch, where a)body message is more informative
        b) URL is now included in the body for auto-click browsers c)
        mime headers were removed.
 

</P>
  <A name="177" id="177"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>If you se variable JA_NETMIND_SUBJECT to &quot;yes&quot;, then the changed
	            url http pointer is put to subject line.
</UL>


 

</P>
  <A name="178" id="178"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-janetmind.rc          # reformat the message
 
      :0:                                         # drop to folder
      * netmind
      url.mbox
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="179"  id="179"></A>
    <H1>
    Pm-janslookup.rc &ndash; run nslookup on variable INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="180" id="180"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        Keywords:       procmail, nslookup, subroutine<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="181" id="181"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine runs <SAMP class="word">nslookup</SAMP> on given INPUT address. This may be
        an effective way to test if the address is known to Internet. You
        could use this information to determine if some automated reply to
        a address can be sent. The know truth is that you can't validate
        whole email address
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          to_someone@foo.com
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        but you can validate &quot;foo.com&quot;; that's the closest you get.
 

<P class="column8">
        <SPAN class="word-ref">[Warning: If you don't use cache feature...]</SPAN>
 

<P class="column8">
        Do not however use this module to regularly check <STRONG class="word">all</STRONG> incoming
        from addresses with this subroutine for possible bogus UBE
        addresses, because calling nslookup
 
<UL>
	<LI>may be slow, building to connection and querying the results
            may take several seconds. (some times, usually it's quote fast)
	<LI>consumes quite a lot resources.
</UL>


 

<P class="column8">
        You can however check <STRONG class="word">some</STRONG> messages that are likely UBE to verify
        your doubts.
 

</P>
  <A name="182" id="182"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jaaddr.rc
</UL>


 

</P>
  <A name="183" id="183"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>INPUT, the address (only strict domain part) which is checked.
            Eg. &quot;this.domain.com&quot;. See examples for more.
            If this string contains &quot;@&quot; character, then additional
            subroutine pm-jaaddr.rc is called to extraxt the domain name
            INPUT = &quot;John Doe foo@site.com&quot; --&gt; INPUT = &quot;site.com&quot;
	<LI>JA_NSLOOKUP_CACHE, filename. If exists, cache is used and updated.
	<LI>JA_NSLOOKUP_FORCE, if &quot;yes&quot;, then cache is not used but a forced
            nslookup is performed.
	<LI>JA_NSLOOKUP_OPT, is currently empty, but you could see if you
            you want to use &quot;-querytype=MX&quot;. However this option may give
            you response: &quot;No mail exchanger (MX) records available&quot;,
            which is flagged as nslookup failure.
	<LI>JA_NSLOOKUP_SERVER, optional, the server to user for nslookup
</UL>


 

<P class="column8">
        If the cache file can be read:
 
<UL>
	<LI>Each entry has format &quot;address.com ns-error&quot;. The error
            indication is added to the line if the nslookup failed when
            address was checked. Otherwise line contains &quot;address.com&quot;.
	<LI>The cache is always checked first. If there is no entry matching
            the current address, only then is nslookup called and new entry
	            added to cache.
</UL>


 

</P>
  <A name="184" id="184"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI>Variable ERROR will be set to &quot;yes&quot; if nslookup failed or
            to &quot;no&quot; if nslookup succeeded. It can also contain &quot;maybe&quot; if
            nslookup returned &quot;No address (A) records available&quot;
	<LI>ERROR_MATCH contains one line lookup failure reason.
</UL>


 

<P class="column8">
        Following conditions trigger &quot;maybe&quot; and no &quot;ns-error&quot; is written
        into the cache.
 

<P class="column8">
	<UL>
	<LI>&quot;No address (A) records available for xxx&quot;
</UL>


 

</P>
  <A name="185" id="185"></A>
  <H2>
      Usage example
      
  </H2>



 
        If you are going to check some header field, like From:, please
        explode the content with pm-jaaddr.rc first. Suppose you have
        string:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;From: foo@ingrid.sps.mot.com (Yoshiaki foo)&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        You have to derive the address from string and pass the site name:
        Read From: field and address from it.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC       = $HOME/pm
      RC_NSLOOKUP = $PMSRC/pm-janslookup.rc   # name the subroutine
 
      :0
      * MAYBE_UBE ?? yes
      * ^From:\/.*
      {
          INPUT       = $MATCH
          INCLUDERC   = $RC_NSLOOKUP  #   to nslookup
 
          :0
          * ERROR ?? yes
          {
              #   Hm, nslookup failed, can't send anything back to this
              #   address
          }
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Second example, check if the address is reachable before sending reply
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT       = `$FORMAIL -rt -x To:`
      INCLUDERC   = $RC_NSLOOKUP
 
      :0
      *    ERROR ?? no
      {
          # okay, at least site address seems to be reachable
      }
    </TD>
    </TR>
</TABLE>
 
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="186"  id="186"></A>
    <H1>
    Pm-jaorig.rc &ndash; Extract embedded original message (simple recipe)
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="187" id="187"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail recipe extract original message $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="188" id="188"></A>
  <H2>
      Documentation
      
  </H2>



 
        This subroutine digs embedded message from the body and replaces
        current message with it. Copy the message to folder before calling
        this subroutine if you need original.
 

<P class="column8">
        NOTE: This is <STRONG class="word">simple</STRONG> tool and the sole purpose is to derive
        simple embedded messages. Write full fledged perl script if you
        want better extracting features. The used AWK inside this procmail
        recipe will fail to find 30% of the cases, mostly due to non-standard
        way of including the message. The recognized formats are as follows.
        Anything that differs from these are ignored or incorrectly parsed.
 
<UL>
	<LI>Message is embedded left flushed &quot;as is&quot;. With full headers or
            Minimum of <SAMP class="word">From:</SAMP> <SAMP class="word">Subject</SAMP> <SAMP class="word">Received</SAMP>
	<LI>The embedded message is quoted with <SAMP class="word">&gt;</SAMP> with optional <STRONG class="word">one</STRONG>
	            space.
</UL>


 

</P>
  <A name="189" id="189"></A>
  <H2>
      Where you would use this module
      
  </H2>



 
        If you're subscribed to mailing lists that regularly sent copies of
        original message to the list, like forwarding spam to SPAM-L
        mailing list at <A HREF="http://bounce.to/dmuth" target="_top">http://bounce.to/dmuth</A>, then you'd like to
        extract the original embedded message which you can then feed to
        your UBE filter to test if the shield holds.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &lt;EM&gt;<A HREF="mailto:spam-l-request@peach.ease.lsoft.com" >spam-l-request@peach.ease.lsoft.com</A>&lt;/EM&gt;
      subscribe SPAM-L &lt;First name&gt; &lt;Last name&gt;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        This recipe takes simplistic approach and tries it's best to
        extract embedded message. Idea for this recipe comes from Era
        Eriksson's posting &quot;recipe to turn list postings back into original
        spam&quot; 1998-06-25 in Procmail mailing list.
 
<UL>
	<LI>Body must contain headers
	<LI>Remove all <SAMP class="word">&gt;</SAMP> quotations.
	<LI>extract everything to the end of message. (There are no means
            to get rid of the attached signatures that ot forwarding poster
	            or list server may have attached.
</UL>


 

</P>
  <A name="190" id="190"></A>
  <H2>
      How the message is extracted
      
  </H2>



 
        When this recipe ends, the current message has been modified so that
        it <STRONG class="word">is</STRONG> <STRONG class="word">the</STRONG> <STRONG class="word">original</STRONG> <STRONG class="word">message</STRONG>. Like if you would receive:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      HEADER-1        # The poster
      body-1          # his comments
      HEADER-2        # The original embedded message
      body-2
      body-1          # And poster's signature or mailing list footer
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The message now looks like
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      HEADER-2
      body-2
      body-1
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        And you can save this as original message or feed it to your
        UBE filter and test if it detects it.
 

</P>
  <A name="191" id="191"></A>
  <H2>
      Code note: procmail or awk core dump
      
  </H2>



 
        For some reason procmail kept dumping core I write the code in
        more nicer format like below, but if I made it compact, then it
        didn't dump core. Go figure. I'm not pleased that I had to sacrafice
        clarity, but there was no other way.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      [The good style]            [The forced compact style]
      if ()                       if () { statement }
      {
          statement
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        I have no explanation why this
        happens, the same AWK code would work just fine most of the cases and
        then came this message <SAMP class="word">x</SAMP> and caused dumping the code, if I feed
        some other message, I didn't get core dump. Total mystery to me.
        Don't let the log message fool you, this had nothing to do
        regexp  &quot;^[&gt; ]*From:.*[a-zA-Z]&quot;. If I deletd one line from AWK
        script, it worked ok, if I added it back the core dump happened with
        that message <SAMP class="word">x</SAMP>
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      procmail: Assigning &quot;pfx=[&gt; ]*&quot;
      procmail: No match on &quot;^[&gt; ]*From:.*[a-zA-Z]&quot;
      Segmentation fault (core dumped)
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="192" id="192"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail includerc code.
        This subroutine needs module(s):
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="193" id="193"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (none)
 

</P>
  <A name="194" id="194"></A>
  <H2>
      Usage Example
      
  </H2>



 
        Let's assume that you want to feed all forwarded UBE that is
        posted to spam-l mailing list to your filter and see if it needs
        improving by checking the logs later. The forwarded UBE to the list
        is labelled &quot;SPAM:&quot; in the subject line.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $RC_LIST = $PMSRC/pm-jalist.rc   # mailing list detector
      $RC_ORIG = $PMSRC/pm-jaorig.rc   # extract original
      $RC_UBE  = $PMSRC/pm-jaube.rc    # UBE filter
 
      ...
 
      INCLUDERC = $RC_LIST            # defines variable `LIST'
 
      :0
      * ! LIST ^^^^
      {
          :0                          # spam-l mailing list
          * LIST ?? spam
          * Subject: +SPAM:
          {
              INCLUDERC = $RC_ORIG    # Change it to UBE message
 
              #   Ok, next feed it to filter, set some variables first
              #   Log = Short log; What filters were applied to message
              #   mbx = If message was trapped, save it here
 
              JA_UBE_LOG      = &quot;$PMSRC/pm-ube.log&quot;
              JA_UBE_MBOX     = &quot;junk.ube.ok.mbox&quot;
 
              INCLUDERC = $RC_UBE
 
              :0 :            # If comes here, filter failed
              junk.ube.nok.mbx
          }
 
          :0 :                    # save normal list messages
          list.$LIST
      }
    </TD>
    </TR>
</TABLE>
 
 
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="195"  id="195"></A>
    <H1>
    Pm-japing.rc &ndash; reply shortly to message &quot;Subject: ping&quot;; account ok
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="196" id="196"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, subroutine, ping auto-ack $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="197" id="197"></A>
  <H2>
      Description
      
  </H2>



 
        When I'm on remote site and I don't seem to get throught
        with telnet or even with Unix ping(1), I want to know if the
        at least the mail server is up. I can send a ping message and the
        auto responder will reply immediately.
 

<P class="column8">
        Sometimes, when you send a message to a person, it would be nice,
        if you could test that the destination address is valid, before
        sending a message to a black hole. If the receiver had ping
        service running; like this, then you would know that you spelled the
        the right address. (after wondering two weeks; why you don't get
        response). Nowadays <SAMP class="word">finger(1)</SAMP> command seems to be blocked many times.
 

<P class="column8">
        This recipe answers to simple ping message like this:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      To: you@site.com
      Subject: ping
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Recipe sends a short message back to the sender.
 

</P>
  <A name="198" id="198"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jastore.rc
</UL>


 

</P>
  <A name="199" id="199"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        (see Usage)
 

</P>
  <A name="200" id="200"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_PING_MBOX    = $HOME/Mail/spool/ping.spool
      INCLUDERC       = $PMSRC/pm-japing.rc
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="201"  id="201"></A>
    <H1>
    Pm-japop3.rc &ndash; Remotedly download messages by mail command request
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="202" id="202"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail pop3 emulation recipe $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="203" id="203"></A>
  <H2>
      Description
      
  </H2>



 
        Ahem, that <SAMP class="word">pop3</SAMP> is just to draw your attention. This module has
        nothing to do with pop3. The idea may resemble it though. This
        module listens pop3 requests, and when it gets one, it sends
        the whole mailbox content as separate forwarded messages to the
        account from where you sent the request.
 

<P class="column8">
        This is kinda &quot;empty my mailbox in account X and send the messages
        to account Y&quot;
 

<P class="column8">
        You might have permanent forwarding on in account X, but if that
        is your secondary account, you can ask what messages has been arrived
        there with this recipe.
 

<P class="column8">
        After you have configured your magic pop3 command, which is your
        password, simply send a message to account X, and this module
        initiates emptying the mailbox. Here is an example:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: pOp3-send [mailbox] [kill]
    </TD>
    </TR>
</TABLE>
 
<UL>
	<LI><SAMP class="word">mailbox</SAMP>, is optional folder name which you want to process.
            it is $DEFAULT if not given in subject. Use <EM class="word">absolute</EM> path if
            you specify one.
	<LI>if word <SAMP class="word">kill</SAMP> is found, the mailbox will be emptied after
	            forwarding. If the word is not found, messages are preserved.
</UL>


 

</P>
  <A name="204" id="204"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-japop3.rc            # Phew! We include ourself, we are recursive.
</UL>


 

</P>
  <A name="205" id="205"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI><SAMP class="word">JA_POP3_SUBJECT_CMD</SAMP> is your personal access command string.
            If this is the first word in the subject line, forwarding starts.
            This string is case sensitive.
	<LI><SAMP class="word">JA_POP3_TMP</SAMP> is the file where mailbox is moved before starting
            to forward the messages. Do not put to point to your $HOME,
            becaus that may exceed the quota.
	<LI><SAMP class="word">JA_POP3_TO_MUST_MATCH</SAMP> must contain regexp that match the email
            addresses where the pop3 messages are allowed to send. BE SURE
            TO DEFINE this. If you have account X,Y,Z where you want to receive
            pop3 messages, set this regexp to match those site's email addresses.
	<LI><SAMP class="word">JA_POP3_LOGFILE</SAMP> is the log where you can see how the forked
            procmail processes send each pop3 mail. You may want to set this
	            to different location than your default <SAMP class="word">$LOGFILE</SAMP>.
</UL>


 

</P>
  <A name="206" id="206"></A>
  <H2>
      Return value
      
  </H2>



 
        <SAMP class="word">STATUS</SAMP> will contain mailbox name if valid pop3 request was received.
        You may wish to save the pop3 requests to separate folder. See example
        below.
 

</P>
  <A name="207" id="207"></A>
  <H2>
      Example usage
      
  </H2>



 
        You install this same setup for each site where you have account. This
        is the account X, from where you want to empty the mailboxes.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      RC_POP3             = $PMSRC/pm-japop3.rc
 
      .. somewhere in your .procmailrc ..
 
      JA_POP3_SUBJECT_CMD = myPoPcmd
      INCLUDERC           = $RC_POP3
 
      #   Save all pop3 requests to folder
 
      :0 :
      * STATUS ?? [a-z]
      mail.pop3-req.mbox
    </TD>
    </TR>
</TABLE>
 
 

</P>
  <A name="208" id="208"></A>
  <H2>
      In account Y, from where you send the pop3 requests. Following code stores
      
  </H2>




</P>
  <A name="209" id="209"></A>
  <H2>
      The received messages to separate folder
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #   The MATCH will contain the host name from where the messages
      #   were moved
 
      :0 :
      *$ X-Loop-Fwd:.*\.rc +\/$NSPC+
      mail.fwd.$MATCH.mbox
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="210"  id="210"></A>
    <H1>
    Pm-jarandf.rc &ndash; pick (rand)om line from (f)ile
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="211" id="211"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $keywords:     procmail. subroutine, random file line $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="212" id="212"></A>
  <H2>
      Description
      
  </H2>



 
        Return random line or a line from a file. This subroutine uses
        shell command <SAMP class="word">awk</SAMP> and possibly <SAMP class="word">wc</SAMP> to be as small burden to the
        system as possible.
 

</P>
  <A name="213" id="213"></A>
  <H2>
      Required settings
      
  </H2>



 
        You must have awk that supports VAR=value assignment syntax outside
        the code block: that is, in the input line. I know no awk that
        would not have this feature, but at least you know now what it takes.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % awk '{print VAR; exit;}' VAR=1 /etc/passwd
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Try using GNU awk, if your standard awk didn't print 1 in above
        test. (Put this line to the top of your .procmailrc)
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      AWK = &quot;gawk&quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="214" id="214"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        If intend to call this subroutine many times, then please calculate
        the number of lines beforehand and pass it to this subroutine. If
        the MAX is not set, then <SAMP class="word">wc</SAMP> is called every time to find your the
        line count.
 
<UL>
	<LI>FILE, from what file to select. Make sure this exists; existence
            is not checked here.
	<LI><SPAN class="word-ref">[MAX]</SPAN> optional, number of lines in the FILE.
</UL>


 

</P>
  <A name="215" id="215"></A>
  <H2>
      Returned value
      
  </H2>



 
        variable LINE
 

</P>
  <A name="216" id="216"></A>
  <H2>
      Example usage
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      # Select random line from a file
 
      $RC_RANDF = $PMSRC/pm-jarand.rc
      $COOKIE   = $HOME/txt/cookie.lst
 
      ...somewhere..
      MAX=20 FILE=$COOKIE    INCLUDERC=$RC_RANDF
 
      #  LINE contains randomly read line
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="217"  id="217"></A>
    <H1>
    Pm-jasrv-check.rc &ndash; check FILE validity, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="218" id="218"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail, file server $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="219" id="219"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of the TPFS or MPFS file server.
        Check FILE for nonvalid filenames or other access problems.
 

</P>
  <A name="220" id="220"></A>
  <H2>
      Input
      
  </H2>



 
<UL>
	<LI>JA_SRV_F_FILE_CASE_SENSITIVE, flag
	<LI>FILE, filename to check. possibly converted to lowercase.
</UL>


 

</P>
  <A name="221" id="221"></A>
  <H2>
      Output
      
  </H2>



 
<UL>
	<LI>stat, set to &quot;ok&quot; if filename is acceptable. Otherwise contains
	            brief error reason;
</UL>


 
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="222"  id="222"></A>
    <H1>
    Pm-jasrv-daemon.rc &ndash; server request check, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="223" id="223"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail, file server $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="224" id="224"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of the MPFS file server.
        Handle BOUNCES to mail server messages, eg if delivery failed
        due to maximum byte limit.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      552 foo@site.com... Message is too large; 100000 bytes max
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="225" id="225"></A>
  <H2>
      Input
      
  </H2>



 
        (none) This recipe examines headers and body to see if it's daemon
        bounce.
 

</P>
  <A name="226" id="226"></A>
  <H2>
      Output
      
  </H2>



 
	<UL>
	<LI>stat, set to &quot;daemon&quot; if message was handled.
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="227"  id="227"></A>
    <H1>
    Pm-jasrv-err.rc &ndash; send message, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="228" id="228"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998 Jari Aalto $<BR>
        $Keywords:      procmail FileServer subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="229" id="229"></A>
  <H2>
      Description
      
  </H2>



 
        This module is part of the MPFS file server.
        Ssnd error notice: file didn't exist.
 

</P>
  <A name="230" id="230"></A>
  <H2>
      Input
      
  </H2>



 
	<UL>
	<LI>FILE, file or command that did ot exist.
</UL>


 

</P>
  <A name="231" id="231"></A>
  <H2>
      Output
      
  </H2>



 
	<UL>
	<LI>fld, additional field to be added to the saved mbox log message
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="232"  id="232"></A>
    <H1>
    Pm-jasrv-from.rc &ndash; compose reply, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="233" id="233"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, file server $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="234" id="234"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of the MPFS file server.
        Compose headers for reply message using <SAMP class="word">formail</SAMP> -rt.
 

<P class="column8">
        Here is dry run example to test this module
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % procmail DEFAULT=/dev/null VERBOSE=on LOGABSTRACT=all         \
          FORMAIL=/opt/local/bin/formail                              \
          JA_SRV_FORMAIL_FROM=me@here                                 \
          JA_SRV_CONTENT_TYPE=content-type                            \
          JA_SRV_XLOOP=xloop                                          \
          $HOME/pm/pm-jasrv-from.rc                                   \
          &lt; $HOME/any-sample.email
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="235" id="235"></A>
  <H2>
      Input
      
  </H2>



 
<UL>
	<LI>JA_SRV_FORMAIL_FROM, JA_SRV_XLOOP
	<LI>JA_SRV_CONTENT_TYPE
</UL>


 

</P>
  <A name="236" id="236"></A>
  <H2>
      Output
      
  </H2>



 
        (none)
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="237"  id="237"></A>
    <H1>
    Pm-jasrv-msg.rc &ndash; send message, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="238" id="238"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail, file server $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="239" id="239"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of the TPFS or MPFS file server. Run $CODE
        and return resutls to to user. Subroutine is meant to be used for
        informational messages.
 

</P>
  <A name="240" id="240"></A>
  <H2>
      Input
      
  </H2>



 
<UL>
	<LI>code, code to run in shell
	<LI>stat, status message for user
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="241"  id="241"></A>
    <H1>
    Pm-jasrv-multi.rc &ndash; send multipart MIME message, subroutine for FileSrv
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="242" id="242"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail FileServer subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="243" id="243"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of MPFS file server. Send out FILE as
        multipart MIME message. The message will always be base64
        encoded before sending.
 

</P>
  <A name="244" id="244"></A>
  <H2>
      Input
      
  </H2>



 
<UL>
	<LI>JA_SRV_MIME_MULTI_SEND, command to feed the composed and message
            which will handle sending it as multipart MIME.
	<LI>JA_SRV_MULTIPART_THRESHOLD is the hunk size for slitting mail.
	<LI>FILE, only filename part. Included in MIME headers.
	<LI>file, absolute path to send
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="245"  id="245"></A>
    <H1>
    Pm-jasrv.rc &ndash; MIME capable Procmail File server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="246" id="246"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, File Server $<BR>
 

<P class="column8">
        This program is free software; you can redistribute it and/or
        modify it under the terms of the GNU General Public License as
        published by the Free Software Foundation; either version 2 of
        the License, or (at your option) any later version.
 

<P class="column8">
        This program is distributed in the hope that it will be useful, but
        WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
        General Public License for more details.
 

<P class="column8">
        You should have received a copy of the GNU General Public License along
        with this program; if not, write to the Free Software Foundation,
        Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 

<P class="column8">
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="247" id="247"></A>
  <H2>
      Description
      
  </H2>



 
        This is the MPFS (Mime Procmail File Server) and it can send MIME
        compliant messages with command
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;send &lt;ITEM&gt; [WORD1] [WORD2]&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Usually only the ITEM arg is used, and the rest of the words are for
        special uses like password and preventing file encoding. A typical
        request looks like:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: send help              # ask for file named 'help'
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="248" id="248"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>MIME types gzip and text/plain are supported.
	<LI>.gz .zip etc. files are sent out as base64 attachments
	<LI>.gz .tar.gz files that exceed 100K are sent out as MIME multiparts
	<LI>requires procmail 3.11+ and MATCH operator \/
	<LI>requires <SAMP class="word">mmencode</SAMP> and <SAMP class="word">gzip</SAMP> executables to be present in PATH.
</UL>


 

</P>
  <A name="249" id="249"></A>
  <H2>
      Install: server file directory
      
  </H2>



 
        You have to create a directory for the server where the files are kept.
        Usually I don't put the files there, but whenever I want to make a
        file available, I draw a hard or softlink to the real file.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % mkdir $HOME/pm-server
 
      # Repeat this as needed for files you want to put available
 
      % cd $HOME/pm-server
      % ln -s $HOME/txt/interesting-file.txt interesting-file.txt
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        You define the server directory by setting
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_FILE_DIR = $HOME/pm-server
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The short server log is written to file pointed by this variable:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_LOG = $HOME/pm-server.log
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The incoming &quot;send&quot; requests are stored to mailbox pointed by
        following variable. The default value is /dev/null, but
        you may want to set it to ~/Mail/spool/log.srv.spool which can be
        used read as a newsgroup by Emacs Gnus [In Gnus create newsgroup with
        `G` <SAMP class="word">m</SAMP> <SAMP class="word">nnml</SAMP> <SAMP class="word">log.srv</SAMP>]
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_MSG_MBOX
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="250" id="250"></A>
  <H2>
      Install: special files
      
  </H2>



 
        Tweak this variable to commands you want to allow shell to execute
        in server's directory. This tells when &lt;ITEM&gt; &quot;ls&quot; means command
        instead of file
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_SH_COMMAND = &quot;^(ls|what)$&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        That means that request like this:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: send ls            # run &quot;ls&quot; command and return results
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Be sure that the commands exist in your system. See man pages for
        more if you want to know what these commands do. Commands cannot
        take switches currently for security reasons. E.g. if you want to
        give access to &quot;ls -la&quot; listing, put a file &quot;ls-la.txt&quot; available
        in the directory, user can get it with &quot;send ls-la.txt&quot;
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      ls      -- list directory
      file    -- print file type information.
      what    -- prints all @(#) tags from files
      ident   -- print all $ $ tags from files
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="251" id="251"></A>
  <H2>
      Install: file `help'
      
  </H2>



 
        Users want to get a help file with message &quot;send help&quot; and the
        <SAMP class="word">help</SAMP> is just a file in your server directory. Be sure to supply it
        prior to any other files. You can always draw a link to a file if you
        don't want to name it that way (e.g. if you keep several server help
        files in a RCS tree)
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #   draw symlink to `help'
 
      % ln -s $HOME/txt/srv-public-hlp.txt $HOME/server/help
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="252" id="252"></A>
  <H2>
      Basic usage in details
      
  </H2>



 
        The server accepts command in format
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;send &lt;ITEM&gt; [CMD|PASSWORD]&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Where ITEM can be any name as long as it starts with <SPAN class="word-ref">[^ .]</SPAN>. The
        regexp says: Anything goes as long as FILE does <STRONG class="word">not</STRONG> start with
        space or period. This gives you quite a much freedom to construct
        filenames. if you want to hand out file:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      .procmailrc
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        You can't. Instead make a link to point to plain &quot;procmailrc&quot;
        without the leading period. There is also additional checks
        against possible security threat &quot;../&quot; like below; user can't
        request such file.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      ../../../gotcha  or  dir/../../gotcha
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The filename cannot contain special characters like [*?&lt;&gt;{}()].
 

</P>
  <A name="253" id="253"></A>
  <H2>
      Advanced usage
      
  </H2>



 
        <SPAN class="word-ref">[conversions]</SPAN>
 

<P class="column8">
        If some of your files are big, it makes sense to send them in
        compressed base64 format; which in MIME world is called content-type
        gzip. You can set a regexp to enforce encoding for your big
        files before they are sent to user. The following setting will send
        all text files in compressed format to user.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_XGZIP_REGEXP = &quot;\.txt&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        When the message is composed a header is inserted into the message
        telling how the message is to be decoded, in case user doesn't have
        decent MUA that can handle the MIME type:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      X-comment: To decode, cat msg| mmencode -u| gzip -d &gt; test.txt
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        <SPAN class="word-ref">[noconv and gz]</SPAN>
 

<P class="column8">
        The <SAMP class="word">WORD1</SAMP> parameter after the <SAMP class="word">FILE</SAMP> is optional and user can
        override base64 encoding and request plain file if he uses word
        &quot;noconv&quot;.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: send &lt;FILE&gt; [noconv|gzip]
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        However, there are files where <SAMP class="word">noconv</SAMP> must not be obeyed, like
        the compressed packages that you have put available in .zip, .gz,
        tar.gz or .tgz (GNU tar) format. Following variable controls<BR>
        when file is always sent as base64:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_BASE64_ALWAYS
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If the <SAMP class="word">WORD1</SAMP> is &quot;gz&quot; or &quot;gzip&quot;, then the gzip is explicitly
        requested, This may be desirable, because some of the text files in
        the server directory may be big and some accounts don't accept big
        messages. A typical bounce looks like:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      552 foo@site.com... Message is too large; 100000 bytes max
      554 foo@site.com Service unavailable
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        These kind of file server bounce messages are handled in separate
        module which notifies the user that his account didn't accept the
        sent file.
 

<P class="column8">
        <SPAN class="word-ref">[case sensitivity]</SPAN>
 

<P class="column8">
        By default the request word (&quot;send&quot;) and ITEM (filename) are not
        case sensitive, unless you set these flags:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_F_CMD_CASE_SENSITIVE  = &quot;yes&quot;
      JA_SRV_F_FILE_CASE_SENSITIVE = &quot;yes&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If values are &quot;no&quot;, then these are identical commands:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: Send Help
      Subject  SEND HELP
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="254" id="254"></A>
  <H2>
      Multi part mime messages
      
  </H2>



 
        If you want to deliver big files, you better be sure not to send
        them as a big file. That blocks the connection between every host
        along the path that the big file is transferred. The
        solution is to use MIME multi parts that can be assembled back in
        the receiving MUA. (In case you don't have multi part assembler
        receive Perl script to do it).
 

<P class="column8">
        MIME multiparts are sent out if
 
<UL>
	<LI>Filename matches JA_SRV_BASE64_ALWAYS, typically tar.gz, zip
	<LI>Filesize is bigger than JA_SRV_MULTIPART_THRESHOLD, where
	            default chunk size is 100K.
</UL>


 

<P class="column8">
        When a file meets these criteria, it is read to the <SAMP class="word">BODY</SAMP> of message
        and base64 encoded. This all happens in memory, so watch
        procmail logs to see if any problems with very big files. (&gt;30Meg).
        Next, if the base64 conversion succeeded, the composed is handed
        to
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_MIME_MULTI_SEND
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Which does the actual delivery and splitting. The default program
        used is <SAMP class="word">splitmail</SAMP>. Make sure you have it or substitute the
        program with some equivalent one.
 

</P>
  <A name="255" id="255"></A>
  <H2>
      Stopping server
      
  </H2>



 
        Sometimes you're making rearrangements in you file directory or
        doing some other maintenance and you are unable to respond to <SAMP class="word">send</SAMP>
        requests. You can stop the server by setting
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_IN_USE = &quot;no&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        And when you want to enable the server again; just comment out the
        statement or assign <SAMP class="word">yes</SAMP>. <SPAN class="word-ref">[The default is <SAMP class="word">yes</SAMP>]</SPAN>. When this
        variable is set to <SAMP class="word">no</SAMP>, the server sends a message from following
        variable as a response to any &quot;send&quot; request.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_IN_USE_NO_MSG
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="256" id="256"></A>
  <H2>
      Using password to validate file requests
      
  </H2>



 
        You should be aware that this file server's implementation is public
        in nature. Anyone who asks for a file is allowed to get it. But it
        would be good if you could limit the access to documents with some
        simple way, like if you set up two file servers (see next chapter)
        where one is public and the other is interesting only to group of
        people. You can define a string that must be found in Subject field
        by setting the following variable
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_PASSWORD = &quot;.*&quot;    # default
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The default value will match anything in the subject, thus making the
        server public. But if you set it like this
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SRV_PASSWORD &quot;.*123&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Then string &quot;123&quot; must be there somewhere in the line, like here
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: send &lt;FILE&gt; 123
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Yes, &quot;123&quot; is actually a CMD definition, but it doesn't matter
        because there is no CMD 123. Subject now matches password and the
        server can be accessed. Of course the following is valid too.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: send &lt;FILE&gt; noconv 123
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If the password was wrong, server won't tell it. The message just
        lands to your mailbox in that case and you can investigate who
        tried to access the restricted server.
 

</P>
  <A name="257" id="257"></A>
  <H2>
      Changing server's command string (multiple servers)
      
  </H2>



 
        The default command string is &quot;send&quot;, but you can change it and thus
        create multiple services. Here is one example, where you have set up
        two file servers where each has its own directory.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #   The public server
 
      JA_SRV_CMD_STRING           = &quot;send&quot;
      JA_SRV_FILE_DIR             = $HOME/server/public
      INCLUDERC                   = $HOME/procmail/pm-jasrv.rc
 
      #   Company server, only interests fellow workers.
      #   Here &quot;xyz-send&quot; is just magic server request string.
      #   Notice case sensitivity settings.
 
      JA_SRV_F_CMD_CASE_SENSITIVE = &quot;yes&quot;
      JA_SRV_CMD_STRING           = &quot;xyz-send&quot;
      JA_SRV_PASSWORD             = &quot;.*12qw&quot;
      JA_SRV_FILE_DIR             = $HOME/server/public/xyz-dir
      INCLUDERC                   = $HOME/procmail/pm-jasrv.rc
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="258" id="258"></A>
  <H2>
      Notes from the author
      
  </H2>



 
        <SPAN class="word-ref">[basic Mime type note]</SPAN>
 

<P class="column8">
        All basic files that you send must be US-ASCII, 7bit. At least that
        is the default MIME type used. See <SAMP class="word">JA_SRV_CONTENT_TYPE</SAMP>. I once
        received following message back
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      ----- Transcript of session follows -----
      554 foo@bar... Cannot send 8-bit data to 7-bit destination
      501 foo@bar... Data format error
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        because in the previous releases, the MIME type headers were not
        in the message saying that the content really was plain 7bit ascii.
 

<P class="column8">
        <SPAN class="word-ref">[Sending the file as is]</SPAN>
 

<P class="column8">
        Note, that the file is included &quot;as is&quot; without any extra
        <EM class="word">start-of-file</EM> or <EM class="word">end-of-file</EM> tags. This is possible, because
        the file is sent in MIME format.
 

<P class="column8">
        <SPAN class="word-ref">[Using one line log entry]</SPAN>
 

<P class="column8">
        It may look very spartan to print a single line log entry. You see
        messages like above in the file server log. Using one line entry
        instead of multi line announcements makes it possible to write a small
        perl tool to parse information from a single line. If you get many
        file server messages per day, it quicker to look at the single line
        entries too.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      [ja-srv1; sh file;  Foo Bar foo@site.com;]
      [ja-srv1; send xxx-file.txt; Foo Bar foo@site.com;]
                |
                Server's request keywords (you may have multiple servers)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        <SPAN class="word-ref">[wish list]</SPAN>
 

<P class="column8">
        (*) MIME multipart message's mime headers may need some adjustments.
 

<P class="column8">
        (*) I rely on simple regexp to send out base64 or gzip files.
        The natural extension would be to use file size threshold: if file
        is bigger than N bytes, send it out with gzip. And further: if
        file is more than NN bytes, send it out as multi part MIME.
 

<P class="column8">
        (*) In fact there is a slight mime type errors: .zip files
        should be send as application/zip. If you have experience with the
        mime types, please contact me and help me to sort out proper
        mime headers.
 

</P>
  <A name="259" id="259"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to the source directory of procmail code. This
        subroutine will include many pm-jasrv-*.rc modules and other files
        from there.
 

<P class="column8">
        Please test the File Server in your environment before you start
        using it for every day. For example I had some weird local problem
        where PATH had /usr/contrib/bin/ where gzip was supposed to be, but
        in spite of my tries procmail didn't find it along the path. Don't
        ask why. I now use absolute binary name:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      GZIP = /usr/contrib/bin/gzip
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        In addition, if your messages are not sent to recipient, but you
        get daemon message:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      ... Recipient names must be specified
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        That's because you have setting SENDMAIL=&quot;sendmail&quot;; which is not
        enough. It must be
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      SENDMAIL = &quot;sendmail -oi -t&quot;
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="260" id="260"></A>
  <H2>
      Usage example
      
  </H2>



 
        This is my .procmailrc installation. Notice that the file server
        code is used only if you get &quot;send&quot; request. On the other hand, this
        double wrapping is not all necessary, you could as well rely on the
        File server's capability to detect SEND request.
 
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC   = $HOME/pm      # directory where the procmail rc files are
      RC_FSRV = $PMSRC/pm-jasrv.rc
 
      mySavedLOGFILE = $LOGFILE   # record file server actions elsewhere
      LOGFILE        = $PMSRC/pm-jasrv.log
 
      #   Listen &quot;send&quot; requests.
      :0
      *   ^Subject: +send\&gt;
      {
          JA_SRV_FILE_DIR = $HOME/fsrv      # Where to get the files
          JA_SRV_LOG      = $HOME/fsrv.log  # Write log here
          INCLUDERC       = $RC_FSRV        # Use file server now
      }
 
      LOGFILE = $mySavedLOGFILE
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="261"  id="261"></A>
    <H1>
    Pm-jasrv-req.rc &ndash; server request check, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="262" id="262"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto<BR>
        $Keywords:      procmail FileServer subroutine $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="263" id="263"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of the MPFS file server.
        Check if file server request is on the JA_SRV_SUBJECT and
        do case or incasensitive check.
 

<P class="column8">
        To Dry run this module use following skeleton. Substitute keywods
        as needed to reflect your system setup:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % procmail DEFAULT=/dev/null VERBOSE=on LOGABSTRACT=all     \
        PMSRC=$HOME/txt JA_SRV_CMD_STRING=send                    \
        JA_SRV_SUBJECT=&quot;send newbie_article.rtf noconv&quot;           \
        txt/pm-jasrv-req.rc &lt; ~/test.mail
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="264" id="264"></A>
  <H2>
      Input
      
  </H2>



 
<UL>
	<LI>JA_SRV_F_CMD_CASE_SENSITIVE; if &quot;yes&quot; then server request
            is case sensitive.
	<LI>JA_SRV_FORMAIL_FROM. the email From field
</UL>


 

</P>
  <A name="265" id="265"></A>
  <H2>
      Output
      
  </H2>



 
	<UL>
	<LI>stat, set to &quot;ok&quot; if request is accepted
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="266"  id="266"></A>
    <H1>
    Pm-jasrv-send.rc &ndash; server request check, subroutine for File Server
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="267" id="267"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1998-2004 Jari Aalto <BR>
        $Keywords:      procmail, file server $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="268" id="268"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine is part of the MPFS file server.
        Send the requested file. You can dry-run test this module with
        following command: a) make sure that $HOME/test conatins any simple
        email message b) define FORMAIL if it isnot found from path.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % procmail DEFAULT=/dev/null VERBOSE=on LOGABSTRACT=all     \
        PMSRC=$HOME/txt JA_SRV_LOG=/dev/null                      \
        FORMAIL=/opt/local/bin/formail                            \
        file=$HOME/test FILE=test WORD=WORD JA_SRV_FROM=foo@bar   \
        SENDMAIL=&quot;tee -a $HOME/test.send&quot; txt/pm-jasrv-send.rc &lt; ~/test
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="269" id="269"></A>
  <H2>
      Note:
      
  </H2>



 
        The MIME headers here selected previously were:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Content-type: application/octet-stream
      Content-transfer-encoding: x-gzip64
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        But Defining own CTE such as x-gzip64 is strongly discouraged by
        the MIME RFC's. Most e-mail clients would be at a loss on how to
        handle these. Many would just bomb out and not even give you the
        opportunity to save it to a file. A more correct MIME type is this,
        which is now used:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Content-type: application/x-gzip
      Content-transfer-encoding: base64
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="270" id="270"></A>
  <H2>
      Input
      
  </H2>



 

<P class="column7"><EM><STRONG>
       o    <SAMP class="word">FILE</SAMP> is the filename(chdir to directory is already done)
      `file' is _absolute_ filename
      `WORD' is next word from subject line after FILE word.
       o    JA_SRV_CMD_STRING is flag
       o    JA_SRV_F_SUBJ_NOTIFY is flag</STRONG></EM>

 

</P>
  <A name="271" id="271"></A>
  <H2>
      Output
      
  </H2>



 
	<UL>
	<LI>FILE_ERROR is set to &quot;yes&quot; if file is not found.
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="272"  id="272"></A>
    <H1>
    Pm-jastore.rc &ndash; Store messagee to inbox or gzip inbox
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="273" id="273"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto <BR>
        $Keywords:     procmail, subroutine, storing, saving message $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="274" id="274"></A>
  <H2>
      Description
      
  </H2>



 
        This subroutine stores the message to file pointed by <SAMP class="word">MBOX</SAMP>. This
        subroutine is meant to be used with the the other general purpose
        includerc files. This makes it possible to have a centralized file
        storage handling for all your rc files.
 

<P class="column8">
        Regular user doesn't get much out of this rc unless he mixes both
        gz and regular files in his .procmailrc<BR>
 

<P class="column8">
        R e p e a t: This module is basis for general purpose procmail
        rc plug-ins to strre message to mailbox pointed by some rc
        configuration variable. Normal user can simply say in his .procmailrc:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0:
      mail.private
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="275" id="275"></A>
  <H2>
      Required settings
      
  </H2>



 
        (none)
 

</P>
  <A name="276" id="276"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        <SAMP class="word">MBOX</SAMP>          must have been set to point to message storage.
        <SAMP class="word">MBOX_SUFFIX</SAMP>   is extension added to MBOX. Default is none.
        <SAMP class="word">MBOX_MH</SAMP>       if &quot;yes&quot; then deliver to MH mailbox with
                  `MBOX_MH_CMD' which is &quot;rcvstore&quot; by default.
 

<P class="column8">
	<UL>
	<LI>message is delivered to MH mailbox using <SAMP class="word">MBOX_MH_CMD</SAMP>
</UL>


 

<P class="column8">
        otherwise
 
<UL>
	<LI>If MBOX is <SAMP class="word">some.mbox</SAMP>     the message is stored as is.
	<LI>If MBOX is <SAMP class="word">some.mbox.gz</SAMP>  the message is gzipped to folder.
	<LI>If MBOX is <SAMP class="word">some-dir/.</SAMP>    then deliver as individual files
</UL>


 

</P>
  <A name="277" id="277"></A>
  <H2>
      Example usage
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $RC_MBOX   = $PMSRC/pm-jastore.rc
 
      :0
      * condition
      {
          MBOX = $HOME/Mail/spool/junk.mbox   INCLUDERC = $RC_MBOX
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="278"  id="278"></A>
    <H1>
    Pm-jasubject.rc &ndash; Subject field cleaner and canonicalizer (Re:)
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="279" id="279"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1998-2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, subject clean $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="280" id="280"></A>
  <H2>
      Description
      
  </H2>



 
        There are many different Email programs out there that add their
        own <SAMP class="word">reply</SAMP> characters to the subject field. The most sad programs
        come usually from PC platform. Eg. Microsoft has gained a lot of
        bad reputation due to it's own standards.
 
<UL>
	<LI>MS Explorer can use localized reply strings,
            Eg <SAMP class="word">Vs:</SAMP> or <SAMP class="word">vast:</SAMP>  seems to be Finnish <SAMP class="word">Vastaus</SAMP>.
	<LI>MS product Outlook (??) can be configured similarly.
            I have received swedish <SAMP class="word">Sv:</SAMP> <SAMP class="word">-Svar</SAMP> for <SAMP class="word">Svaring</SAMP> (eng: reply)
	<LI>MS mail uses <SAMP class="word">FW:</SAMP> in forwarded mails.
	<LI>Intelligent MUAs try to keep count of replies with
            <SAMP class="word">Re2:</SAMP> or <SAMP class="word">Re[2]</SAMP>
	<LI>Japanese MUA Denshin 8 Go V321.1b7 has sent Re^2:
	<LI>Some mua uses <SAMP class="word">Re&gt;</SAMP>
	<LI>Lotus notes (in French version) uses <SAMP class="word">Ref:</SAMP>
	<LI>Some MS product sends <SAMP class="word">UQ:</SAMP>
	<LI>XXX uses <SAMP class="word">-reply</SAMP>
	<LI>Forwarding schemes: (fwd) <SPAN class="word-ref">[fwd]</SPAN> &lt;fwd&gt; fw:  [FWD:  <SPAN class="word-ref">[FWD:]]</SPAN>
	<LI>Subject references: -subj subj- subj:
</UL>


 

<P class="column8">
        There already is a de facto standard where message should contain
        only single <SAMP class="word">Re:</SAMP> if message has been replied to (no matter how
        many times). This makes it possible to do efficient message
        threading by only using Subject and date fields. And grepping same
        subjects is lot easier than from this horrible mess. Note that
        all text is on one line, the subject has been broken only
        for visual reasons:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: re- Re^2: Re[32]: FW: Re: Re(15) Sv: Re[9]: -reply
               (fwd) [fwd] &lt;fwd&gt; fw: [FWD:  [FWD:]]
               -subj subj: subj: subj-
               test
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        This recipe standardizes any subject (like above) that has been
        replied to, to de facto format below. That is: &quot;Any number of 'Re:'
        will be converted to <EM class="word">single</EM> 'Re:' and any number of 'Fwd:' will be
        converted to <EM class="word">single</EM> 'Fwd:'&quot;
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>       Subject: Re: test (fwd)
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="281" id="281"></A>
  <H2>
      About In-Reply-To header
      
  </H2>



 
        If there is <SAMP class="word">In-Reply-to</SAMP> header in the message, but there is not <EM class="word">Re:</EM>
        in the subject line, one is added automatically. Some broken Mailers
        forget to add the <EM class="word">Re:</EM> to the Subject line.
 

</P>
  <A name="282" id="282"></A>
  <H2>
      Variable JA_SUBJECT_SAVE
      
  </H2>



 
        This is by default <SAMP class="word">yes</SAMP> which makes the original subject saved under
        header field <SAMP class="word">X-Old-Subject</SAMP>. If you don't want that extra header
        generated, set this variable to <SAMP class="word">no</SAMP>
 

</P>
  <A name="283" id="283"></A>
  <H2>
      Variable JA_SUBJECT_FWD_KILL
      
  </H2>



 
        This is by default <SAMP class="word">yes</SAMP>, which will kill extra forwarding indication
        words like (fwd) <SPAN class="word-ref">[fwd]</SPAN> &lt;fwd&gt; &lt;f&gt;. If you set this to <SAMP class="word">no</SAMP>, then all the
        forwarding words are preserved. The de facto forward format is:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: This subject (fwd)
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="284" id="284"></A>
  <H2>
      Code note
      
  </H2>



 
        This subroutine's intention is to make Subject more expressive by
        deleting redundant information. A simplistic approach has been
        taken where Subject consists of list of <EM class="word">words</EM> whose each attribute
        can be either <SAMP class="word">ok</SAMP> or <SAMP class="word">delete</SAMP>. No attempt has been made to
        determine the structure of the Subject. You can see the algorithm better
        from an example:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Re: New subject (was Re: Old subject)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        That should be treated syntactically like &quot;New subject&quot; and forgetting
        anything between parenthesis. This is however not respected and
        not even tried. The rule applied here is &quot;One Re: is tolerated&quot;,
        so the subject won't change. It doesn't matter where &quot;Re:&quot; is.
 

<P class="column8">
        But here the subject is changed. The rule applied is &quot;Delete
        all unwanted words and then add one Re: to the beginning if OLD
        content had any Reply indications&quot;
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>          Re: New subject (was Re: Old subject)
      --&gt; Re: New subject (was Old subject)
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Now you understand how the Subject changing works.
 

</P>
  <A name="285" id="285"></A>
  <H2>
      IMPORTANT notice
      
  </H2>



 
        Please check that your <SAMP class="word">SHELL</SAMP> variable setting in <SAMP class="word">~/procmailrc</SAMP> is <SAMP class="word">sh</SAMP>
        derivate, /bin/sh or /bin/bash. This module won't work with other
        shells.
 

</P>
  <A name="286" id="286"></A>
  <H2>
      Awk usage note
      
  </H2>



 
        <SAMP class="word">awk</SAMP> is a small, effective and much smaller than perl for little
        tasks. See the verbose log and make sure your awk understands
        VAR=&quot;value&quot; passing syntax. Change it to <SAMP class="word">nawk</SAMP> or <SAMP class="word">gawk</SAMP> if they
        work better than your standard awk.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      AWK = &quot;gawk&quot;        # you may need this, try also gawk
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="287" id="287"></A>
  <H2>
      Example usage
      
  </H2>



 
        You need nothing special, just include this recipe
        before you save message to folder.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-jasubject.rc
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Customizations: Let's say Polish M$Outlook uses <SAMP class="word">ODP:</SAMP> instead of
        standard <SAMP class="word">re:</SAMP> and you want to handle that too: Then set:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SUBJECT_KILL = &quot;odp:&quot;            # NOTE: all lowercase
      JA_SUBJECT_SAVE = &quot;no&quot;
      INCLUDERC       = $PMSRC/pm-jasubject.rc
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        You ca use <SAMP class="word">JA_SUBJECT_KILL</SAMP> to delete any additional words from the
        subject line. E.g. if you have good news-reader, you don't need the
        mailing list prefixes that some mailing lists add to the beginning
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      Subject: [LIST-xxx] the subject here
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        to remove that list prefix, you simply match it
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_SUBJECT_KILL = &quot;(list-xxx|list-yyy)&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Important: The regexp must be <STRONG class="word">all</STRONG> lowercase, because when match
        happens, the words have been converted to lowercase.
 

</P>
  <A name="288" id="288"></A>
  <H2>
      Debugging
      
  </H2>



 
        You can dry-run test this module with following command and watching
        output. Substitute variables as they are in your system. You feed
        the content of entire example mail where the Subject that needs
        correction is found.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      % procmail SHELL=/bin/sh AWK=gawk VERBOSE=on LOGABSTRACT=all \
        PMSRC=txt JA_SUBJECT_KILL=&quot;(ace-users)&quot; txt/pm-jasubject.rc  \
        &lt; ~/test.mail
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="289" id="289"></A>
  <H2>
      Thank you
      
  </H2>



 
        Thanks to <EM><A HREF="mailto:Tony.Lam@Eng.Sun.Com" >Tony.Lam@Eng.Sun.Com</A></EM> for his creative
        improvement suggestions and sending code that this
        recipe didn't catch at first.
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="290"  id="290"></A>
    <H1>
    Pm-jatime.rc &ndash; &quot;hh:mm:ss&quot; time parser from variable INPUT
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="291" id="291"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, time parsing $<BR>
 

<P class="column8">
        This program is free software; you can redistribute it and/or
        modify it under the terms of the GNU General Public License as
        published by the Free Software Foundation; either version 2 of
        the License, or (at your option) any later version.
 

<P class="column8">
        This program is distributed in the hope that it will be useful, but
        WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
        General Public License for more details.
 

<P class="column8">
        You should have received a copy of the GNU General Public License along
        with this program; if not, write to the Free Software Foundation,
        Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 

<P class="column8">
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="292" id="292"></A>
  <H2>
      Description
      
  </H2>



 
        This includerc parses date from variable INPUT which has string
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;hh:mm:ss&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Example input
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      &quot;Thu, 13 Nov 1997 11:43:23 +0200&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Returned values
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      hh      = 2 digits
      mm      = 2 digits
      ss      = 2 digits
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Variable ERROR is set to &quot;yes&quot; if it couldn't recognize the INPUT
        and couldn't parse all hh, mm, ss variables.
 

</P>
  <A name="293" id="293"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include pm-javar.rc from there.
 

</P>
  <A name="294" id="294"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INPUT = string-to-parse
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The INPUT can be anything as long as it contains NN:NN:NN
 

</P>
  <A name="295" id="295"></A>
  <H2>
      Usage example
      
  </H2>



 
        Get the time of received message. The From_ header will always
        have the standard time stamp.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC           = $HOME/pm
      RC_DATE_TIME    = $PMSRC/pm-jatime.rc
 
      :0 c
      *  ^From +\/.*
      {
          INPUT = $MATCH
          #  Turn off the logging while executing this part
 
          VERBOSE=off   INCLUDERC = $RC_DATE_TIME   VERBOSE=on
 
          :0
          * ERROR ?? yes
          {
             # Should not ever happen, you have broken From_
          }
      }
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="296"  id="296"></A>
    <H1>
    Pm-jaube1.rc &ndash; Jari's UBE filter. Subroutine 1
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="297" id="297"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        $Keywords:     procmail, UBE, UCE, spam filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="298" id="298"></A>
  <H2>
      Documentation
      
  </H2>



 
        This file is part of the &quot;pm-jaube.rc&quot;. This subroutine is called
        when likely UBE message has been triggered.
 

</P>
  <A name="299" id="299"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This recipe file
        will include
 

<P class="column8">
	<UL>
	<LI>pm-jastore.rc
</UL>


 
</P>
</BLOCKQUOTE>
<HR>
    <A name="300"  id="300"></A>
    <H1>
    Pm-jaube-keywords.rc &ndash; Jari's bare bones word list based UBE filter
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="301" id="301"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, UCE filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="302" id="302"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your UBE (aka spam) filters towards the <STRONG class="word">end</STRONG> of your
        ~/.procmailrc. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked.
 

<P class="column8">
        Now, if 50-70 % hit rate is good enough for your starting point,
        go ahead and read more. This file is supposed to be the last resort,
        if you really do not have any better tool to analyze messages.
 

</P>
  <A name="303" id="303"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Word and phrase based matching
	<LI>50-70 % success rate. 90 % never achieved. That's a guarantee.
	<LI>Extremely fast and a dream to CPU resources. Implemented in pure
            procmail and you can almost hear the humming sound of its
	            regular expression engine shredding UBE messages to pieces.
</UL>


 

</P>
  <A name="304" id="304"></A>
  <H2>
      Description
      
  </H2>



 
        Are you sure you want use this word list based checking?
 

<P class="column8">
        Think twice before you use this subroutine. It knows nothing about
        the content your mail. &quot;It's all UBE unless proven otherwise&quot; is the
        motto. The brutal search tracks words and phrases to find an indication
        of mass posting and traces of Unsolicited Bulk Email (UBE aka spam).
        <STRONG class="word">Repeat:</STRONG> Read the first paragraph again before you consider putting
        this file into action. This filter WILL PASS through unwanted mail
        and it WILL catch good mail. This is rule based matching, so I suppose
        you know where you're putting your head with this. Ahem. Alerted? Good.
 

<P class="column7"><EM><STRONG>
       The Story</STRONG></EM>

 

<P class="column8">
        There was a man and mail account. The account had limited space,
        couldn't install any other programs because disk quota would have
        exceeded. System administrators weren't' interested in installing
        anything. The Mail server ran behind firewall and had OS that was
        never heard of - it couldn't run other programs. Or if it could,
        the Bad system administrator was too scared to install extra
        programs to the host MTA ran. No joy &ndash; no means to stop incoming
        UBE &ndash; Right?
 

<P class="column8">
        Wrong. There was procmail. The Bad system adminitrator didn't mention
        that <SAMP class="word">~/.procmailrc</SAMP> was honored - just the the external programs
        we a no-no-no (Technical: the MDA host mounted user disks; the
        server ran on separate host and couldn't use any of the user
        compiled programs. Statically linked ones filled up the man's disk
        space).
 

<P class="column8">
        First line of defense, any defense would do. So, this rule based
        file was born. Nothing else was installed in that account and the
        happy word list based matching routine kept chewing mail, mail,
        mail. And the system administrator was happy - he nurtured the MTA
        host's CPU resources and noticed nothing alarming. All ticked like
        clockwork.
 

<P class="column8">
        Life began again. After 1000 mail bombards a day, the account was
        usable again.
 

<P class="column7"><EM><STRONG>
       Motivation</STRONG></EM>

 

<P class="column8">
        If you can, use the Bayesian filters and forget all rule based
        ones, word and phrase matching based ones; all static filters. On
        the other hand, if you want quick solution, even imperfect, until
        you have time to learn and setup other tools, this subroutine may
        be of interest.
 

<P class="column8">
        The best part. You can carry this single file anywhere where procmail
        lives. No other files are needed. Setup couldn't be simpler.
 

</P>
  <A name="305" id="305"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address is usually forged. Do not
        increase the network traffic. Instead save the messages to folders
        and periodically check their contents. It's not nice to be forced to
        apologize about bounces to a wrong destination.
 

</P>
  <A name="306" id="306"></A>
  <H2>
      Code Note
      
  </H2>



 
        Procmail is picky about the whitespace in continuing lines, make sure
        there is <STRONG class="word">not</STRONG> a single spaces left after the continuation backslash.
        Use good editors or external programs to get rid of the white spaces. In
        Emacs you would add this line to your <SAMP class="word">~/.emacs</SAMP> startup file:
        &quot;(add-hook 'write-file-hooks 'delete-trailing-whitespace)&quot;
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0
      * ^Subject:.*(regexp\
              |and-more\
              |and-more\
              )
      {
          # Process it
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Why are the regexps put into this file and not to a separate regexp
        file? Good question. It is possible to check message's content with
        external process, like <SAMP class="word">grep</SAMP>, to see if any matches are found.
        This kind of methodology is covered in Procmail Tips section
        &quot;Using grep with file lists to mach messages&quot; at
        &lt;<A HREF="http://pm-tips.sf.net" target="_top">http://pm-tips.sf.net</A>&gt;. The reason why all the regexp are maintained
        inside this file is:
 
<UL>
	<LI>Simplicity. One file - no extra configuration files or regexp
            databases.
	<LI>Self standing. Does not call external processes, so it's a little
	            faster than possible <SAMP class="word">grep</SAMP> and <SAMP class="word">fgrep</SAMP> solution.
</UL>


 

</P>
  <A name="307" id="307"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="308" id="308"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_UBE_KEYWORD_HEADER, if set, then the results are put to
            messages headers. By default this variable is not defined
            to save from external <SAMP class="word">formail</SAMP> process call.
	            Suggestion: &quot;X-Spam-JaubeKwd&quot;; without trailing colon.
</UL>


 

</P>
  <A name="309" id="309"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI><SAMP class="word">ERROR_STATUS</SAMP> is set to word &quot;Good&quot; or &quot;Bad&quot;.
	<LI><SAMP class="word">ERROR</SAMP> is set to short descriptive word that indicate which
            rule was matched. Values: <EM class="word">Header-From-Keywords</EM>,
            <EM class="word">Header-Subject-keywords</EM> and <EM class="word">Body-keywords</EM>
	<LI><SAMP class="word">ERROR_MATCH</SAMP> is set to some words that happened to trigger
	            UBE catch rule.
</UL>


 

</P>
  <A name="310" id="310"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #   Exclude these addresses from tests
      VALID_FROM = &quot;(my@address.example.com|word@here.example.com)&quot;
 
      :0
      *$ ! ^From:.*$VALID_FROM
      *  !  FROM_DAEMON
      {
          INCLUDERC             = $PMSRC/pm-jaube-keywords.rc
 
          #  Variable &quot;ERROR&quot; was set if message was UBE
 
          :0 :
          * ! ERROR ?? ^^^^
          junk.ube.spool
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="311" id="311"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmal.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="312"  id="312"></A>
    <H1>
    Pm-jaube-prg-spamprobe.rc &ndash; Interface to Annoyance Filter program
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="313" id="313"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="314" id="314"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your Unsolicited Bulk Emacil (aka spam) filters towards the
        end of your <SAMP class="word">~/.procmailrc</SAMP>. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked last.
 

<P class="column8">
        YOU CANNOT USE THIS PROCMAIL SUBROUTINE UNLESS YOU HAVE TRAINED THE
        BAYESIAN PROGRAM FIRST!
 

<P class="column8">
        To train:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ mkdir $HOME/.annoyance
      $ DB=$HOME/.annoyance/dict.bin; DB2=$HOME/.annoyance/fdict.bin
      $ annoyance-filter --mail single.msg --prune --write $DB
      $ annoyance-filter --phrasemax 2 \
        --read  $DB \
        --junk dir/to/bad/messages \
        --prune --write $DB
      $ annoyance-filter -v --read $DB --prune --fwrite $DB2
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        To check message:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ annoyance-filter --read $DB --test mail.msg
      $ annoyance-filter --fread $DB2 -v --class mail.msg
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="315" id="315"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Implements interface to 
            <A HREF="http://sourceforge.net/projects/annoyancefilter/" target="_top">http://sourceforge.net/projects/annoyancefilter/</A> project.
            See article &quot;Training Annoyance Filter to combat spam&quot; by
            Corrado Cau at
            <A HREF="http://www.newsforge.com/software/03/10/24/2046238.shtml?tid=74" target="_top">http://www.newsforge.com/software/03/10/24/2046238.shtml?tid=74</A>
	<LI>variable <SAMP class="word">ERROR</SAMP> is set if the message was UBE.
	<LI>Results are available by default in header 
	            <SAMP class="word">X-Spam-Annoyance-Status</SAMP>.
</UL>


 

</P>
  <A name="316" id="316"></A>
  <H2>
      Description
      
  </H2>



 
        There are several Bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. All the Bayesian programs
        are not the same, so if you want to achive magic 99.99% probability
        the only methodology to do that is to chain several programs in
        serially. There is no single program that can solve the UBE detection.
        This procmail subroutine implements call interface to program
        <SAMP class="word">annoyance-filter</SAMP>, which must already have been installed.
 

</P>
  <A name="317" id="317"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address forged. Do not increase
        the network traffic; you will not do any good to anybody by
        bouncing messgas &ndash; you just increase mail traffic even more.
        Instead save the messages to folders and periodically periodically
        check their contents.
 

</P>
  <A name="318" id="318"></A>
  <H2>
      Required settings
      
  </H2>



 
        If <SAMP class="word">annoyance-filter</SAMP> program is available, define this variable in your
        <SAMP class="word">~/.procmailrc</SAMP>. Use absolute path to make the external shell
        quick; it'll save server load considerably.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_UBE_ANNOYANCE_PRG = /usr/bin/spamprobe
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you <STRONG class="word">do</STRONG> <STRONG class="word">not</STRONG> have program installed, do not leave the
        variable lying aroung, because it will keep this subroutine active.
        Calling a non existing program is not a good idea, so it better to
        empty the variable if the program is not available.
 

</P>
  <A name="319" id="319"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="320" id="320"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI><SAMP class="word">JA_UBE_ANNOYANCE_PRG</SAMP>, path to the program <SPAN class="word-ref">[required]</SPAN>.
	<LI><SAMP class="word">JA_UBE_ANNOYANCE_SPAM_DB</SAMP>, path to the *dictionary database
            <SPAN class="word-ref">[required]</SPAN>. E.g. <SAMP class="word">$HOME/.annoyance/fdict.db</SAMP>.
	<LI><SAMP class="word">JA_UBE_ANNOYANCE_SPAM_DB_OPT</SAMP>, type of dictionary to read.
            Default is &quot;--fread&quot;.
	<LI><SAMP class="word">JA_UBE_ANNOYANCE_HEADER</SAMP>, the header name where the results
            are put. If not defined, no header is added.
            Defaults to <EM class="word">X-Spam-Annoyance-Status</EM>
	<LI><SAMP class="word">JA_UBE_ANNOYANCE_FORCE</SAMP>, if set to <STRONG class="word">yes</STRONG> then call program no matter
            what. Normally if there already is <EM class="word">X-Spam-Annoyance-Status</EM> header,
            it is assumed that the message has already been checked
	            and no new checking is needed.
</UL>


 

</P>
  <A name="321" id="321"></A>
  <H2>
      Return values
      
  </H2>



 
	<UL>
	<LI>ERROR, is set to the return value of the program.
</UL>


 

</P>
  <A name="322" id="322"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC                = $HOME/procmail # procmail recipe dir
 
      &lt;other checks, mailing lists, work mail etc.&gt;
 
      JA_UBE_ANNOYANCE_PRG     = &quot;/usr/bin/nice -n 5 /usr/bin/annoyance-filter&quot;
      JA_UBE_ANNOYANCE_SPAM_DB = $HOME/.annoyance/fdict.db
      INCLUDERC                = $PMSRC/pm-jaube-prg-spamprobe.rc
 
      #   The ERROR will contains word &quot;yes&quot; if message was spam
 
      :0 :
      * ERROR ?? yes
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="323" id="323"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="324"  id="324"></A>
    <H1>
    Pm-jaube-prg-bmf.rc &ndash; Interface to Bayesian Mail Filter program
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="325" id="325"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  2004 Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="326" id="326"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your Unsolicited Bulk Emacil (aka spam) filters towards the
        end of your <SAMP class="word">~/.procmailrc</SAMP>. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked last.
 

<P class="column8">
        YOU CANNOT USE THIS PROCMAIL SUBROUTINE UNLESS YOU HAVE TRAINED THE
        BAYESIAN PROGRAM FIRST!
 

<P class="column8">
        To train:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ ls spam/*.mail | xargs -n 1 bmf -s    # feed individual messages
      $ ls good/*.mail | xargs -n 1 bmf -n    # feed individual messages
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        To test
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $  bmf -p &lt; test.mail | less
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="327" id="327"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Implements interface to <A HREF="http://www.sf.net/projects/bmf" target="_top">http://www.sf.net/projects/bmf</A>
            &quot;Bayesian Mail Filter&quot; project. The called binary is &quot;bmf&quot; hence
            the name of this subroutine. Bmf program uses well know statistical
            analysis which is much more reliable than any hand made procmail
            scripts could ever achieve.
	<LI>Variable <SAMP class="word">ERROR</SAMP> is set if the message was UBE.
	<LI>Results are available in headers <SAMP class="word">X-Spam-bmf-Status</SAMP> and
	            <SAMP class="word">X-Spam-bmf-Flag</SAMP> for further analysis.
</UL>


 

</P>
  <A name="328" id="328"></A>
  <H2>
      Description
      
  </H2>



 
        There are several bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. All the Bayesian programs
        are not the same, so if you want to achive magic 99.99% probability
        the only methodology to do that is to chain several programs in
        serially. There is no single program that can solve the UBE detection.
 

<P class="column8">
        For serious discussion of strenghts of the different programs, refer to
        a very good article &quot;Spam Filters&quot; by Sam Holden at
        2004-08-16 &lt;<A HREF="http://freshmeat.net/articles/view/964" target="_top">http://freshmeat.net/articles/view/964</A>&gt;. The article
        evaluated throughly following programs:
 
<UL>
	<LI>Bayesian Mail Filter        (bayesian)
	<LI>Bogofilter                  (bayesian)
	<LI>dbacl                       (bayesian; multiple wordlists)
	<LI>Quick Spam Filter           (bayesian)
	<LI>SpamAssassin                (perl matching + bayesian)
	<LI>SpamProbe                   (bayesian)
	<LI>SPASTIC                     (procmail recipes)
</UL>


 

<P class="column8">
        This subroutine implements call interface to <SAMP class="word">bmf</SAMP> program. Why
        whould you need it? Because unfortunately <SAMP class="word">bmf</SAMP> by default
        use exactly the same headers as spamasassin and the two cannot
        co-operate together: bmf would overwrite existing
        spamassasin headers. This subroutine takes care of saving
        previous headers and move <SAMP class="word">bmf</SAMP> results to their own
        <SAMP class="word">X-Spam-bmf-*</SAMP> headers.
 

</P>
  <A name="329" id="329"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address forged. Do not increase
        the network traffic; you will not do any good to anybody by
        bouncing messgas &ndash; you just increase mail traffic even more.
        Instead save the messages to folders and periodically periodically
        check their contents.
 

</P>
  <A name="330" id="330"></A>
  <H2>
      Required settings
      
  </H2>



 
        If <SAMP class="word">bmf</SAMP> program is available, define this variable in your
        <SAMP class="word">~/.procmailrc</SAMP>. Use absolute path to make the external shell
        quick; it'll save server load considerably.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_UBE_BMF_PRG = /usr/bin/bmf
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you <STRONG class="word">do</STRONG> <STRONG class="word">not</STRONG> have program installed, do not leave the
        variable lying aroung, because it will keep this subroutine active.
        Calling a non existing program is not a good idea, so it better to
        empty the variable if the program is not available.
 

</P>
  <A name="331" id="331"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="332" id="332"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_UBE_BMF_PRG, path to program
	<LI>JA_UBE_BMF_HEADER_PREFIX, the header name where the results
            are put. If not defined, no headers are added. Default
            value is <SAMP class="word">X-Spam-bmf</SAMP>.
	<LI>JA_UBE_BMF_FORCE, if set to <STRONG class="word">yes</STRONG> then call program no matter
            what. Normally if there already are <SAMP class="word">X-Spam-bmf-*</SAMP> headers,
            it is assumed that the message has already been checked
	            and no new checking is needed.
</UL>


 

</P>
  <A name="333" id="333"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI>ERROR, is set to short ube trigger recipe reason. Contains
            content of <SAMP class="word">X-Spam-bmf-Status</SAMP> header which you can check
            for values
	<LI>ERROR_MATCH contains detailed content of 
	            <SAMP class="word">X-Spam-bmf-Status</SAMP> header.
</UL>


 

<P class="column8">
        If headers were enabled, they will contain:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      X-Spam-bmf-Status: Yes, hits=1.000000 required=0.900000, tests=bmf
      X-Spam-bmf-Flag: YES
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="334" id="334"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC            = $HOME/procmail # procmail recipe dir
 
      &lt;other checks, mailing lists, work mail etc.&gt;
 
      JA_UBE_BMF_PRG   = &quot;/usr/bin/nice -n 5 /usr/bin/bmf&quot;
      INCLUDERC        = $PMSRC/pm-jaube-prg-bmf.rc
 
      #   The ERROR will contains word &quot;yes&quot; if it program classified
      #   the message into &quot;bad&quot; category.
 
      :0 :
      * ERROR ?? yes
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="335" id="335"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="336"  id="336"></A>
    <H1>
    Pm-jaube-prg-bsfilter.rc &ndash; Interface to Bsfilter program
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="337" id="337"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="338" id="338"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your Unsolicited Bulk Emacil (aka spam) filters towards the
        end of your <SAMP class="word">~/.procmailrc</SAMP>. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked last.
 

<P class="column8">
        YOU CANNOT USE THIS PROCMAIL SUBROUTINE UNLESS YOU HAVE TRAINED THE
        BAYESIAN PROGRAM FIRST!
 

<P class="column8">
        To train:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ bsfilter --add-clean good.msg ...
      $ bsfilter --add-spam  spam.msg ...
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="339" id="339"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Implements interface to project
            <A HREF="http://packages.debian.org/testing/mail/bsfilter" target="_top">http://packages.debian.org/testing/mail/bsfilter</A>
	<LI>variable <SAMP class="word">ERROR</SAMP> is set if the message was UBE.
	<LI>Results are available by default in header 
	            <SAMP class="word">X-Spam-Bsfilter-Status</SAMP>.
</UL>


 

</P>
  <A name="340" id="340"></A>
  <H2>
      Description
      
  </H2>



 
        There are several Bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. All the Bayesian programs
        are not the same, so if you want to achive magic 99.99% probability
        the only methodology to do that is to chain several programs in
        serially. There is no single program that can solve the UBE detection.
        This procmail subroutine implements call interface to program
        <SAMP class="word">bsfilter</SAMP>, which must already have been installed.
 

</P>
  <A name="341" id="341"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address forged. Do not increase
        the network traffic; you will not do any good to anybody by
        bouncing messgas &ndash; you just increase mail traffic even more.
        Instead save the messages to folders and periodically periodically
        check their contents.
 

</P>
  <A name="342" id="342"></A>
  <H2>
      Required settings
      
  </H2>



 
        If <SAMP class="word">bsfilter</SAMP> program is available, define this variable in your
        <SAMP class="word">~/.procmailrc</SAMP>. Use absolute path to make the external shell
        quick; it'll save server load considerably.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_UBE_BSFILTER_PRG = /usr/bin/bsfilter
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you <STRONG class="word">do</STRONG> <STRONG class="word">not</STRONG> have program installed, do not leave the
        variable lying aroung, because it will keep this subroutine active.
        Calling a non existing program is not a good idea, so it better to
        empty the variable if the program is not available.
 

</P>
  <A name="343" id="343"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="344" id="344"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI><SAMP class="word">JA_UBE_BSFILTER_PRG</SAMP>, path to the program.
	<LI><SAMP class="word">JA_UBE_BSFILTER_HEADER</SAMP>, the header prefix name where the results
            are put. If not defined, no header is added.
            Defaults to <EM class="word">X-Spam-Bsfilter-</EM>
	<LI><SAMP class="word">JA_UBE_BSFILTER_FORCE</SAMP>, if set to <STRONG class="word">yes</STRONG> then call program no matter
            what. Normally if there already is <EM class="word">X-Spam-Bsfilter-</EM> header,
            it is assumed that the message has already been checked
	            and no new checking is needed.
</UL>


 

</P>
  <A name="345" id="345"></A>
  <H2>
      Return values
      
  </H2>



 
	<UL>
	<LI><SAMP class="word">ERROR</SAMP>, is set to the return value of <SAMP class="word">bsfilter</SAMP> program.
</UL>


 

</P>
  <A name="346" id="346"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC                  = $HOME/procmail # procmail recipe dir
 
      &lt;other checks, mailing lists, work mail etc.&gt;
 
      JA_UBE_BSFILTER_PRG    = &quot;/usr/bin/nice -n 5 /usr/bin/bsfilter&quot;
      INCLUDERC              = $PMSRC/pm-jaube-prg-bsfilter.rc
 
      #   The ERROR will contains word &quot;yes&quot; if message was spam
 
      :0 :
      * ERROR ?? yes
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="347" id="347"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="348"  id="348"></A>
    <H1>
    Pm-jaube-prg-spamprobe.rc &ndash; Interface to Spamprobe program
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="349" id="349"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="350" id="350"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your Unsolicited Bulk Emacil (aka spam) filters towards the
        end of your <SAMP class="word">~/.procmailrc</SAMP>. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked last.
 

<P class="column8">
        YOU CANNOT USE THIS PROCMAIL SUBROUTINE UNLESS YOU HAVE TRAINED THE
        BAYESIAN PROGRAM FIRST!
 

<P class="column8">
        To train:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ rm ~/.idata                       # delete database
      $ echo herbalife | ifile -i spam    # initialize database
      $ ifile -h -i good good.msg ...
      $ ifile -h -i spam spam.msg ...
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="351" id="351"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Implements interface to <A HREF="http://freshmeat.net/projects/ifile" target="_top">http://freshmeat.net/projects/ifile</A>
            project.
	<LI>variable <SAMP class="word">ERROR</SAMP> is set to the result of ifile check. This
            usually holds the &quot;folder&quot; name the ifile was trained at the
            time. E.g. if the folder used for training Unsolicited Bulk
            Email was &quot;ifile -i spam&quot;, then the return value is &quot;spam&quot;.
	<LI>Results are available by default in header <SAMP class="word">X-Spamifile</SAMP>.
</UL>


 

</P>
  <A name="352" id="352"></A>
  <H2>
      Description
      
  </H2>



 
        There are several Bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. All the Bayesian programs
        are not the same, so if you want to achive magic 99.99% probability
        the only methodology to do that is to chain several programs in
        serially. There is no single program that can solve the UBE detection.
        This procmail subroutine implements call interface to program
        <SAMP class="word">ifile</SAMP>, which must already have been installed.
 

</P>
  <A name="353" id="353"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address forged. Do not increase
        the network traffic; you will not do any good to anybody by
        bouncing messgas &ndash; you just increase mail traffic even more.
        Instead save the messages to folders and periodically periodically
        check their contents.
 

</P>
  <A name="354" id="354"></A>
  <H2>
      Required settings
      
  </H2>



 
        If <SAMP class="word">ifile</SAMP> program is available, define this variable in your
        <SAMP class="word">~/.procmailrc</SAMP>. Use absolute path to make the external shell
        quick; it'll save server load considerably.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_UBE_IFILE_PRG = /usr/bin/ifile
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you <STRONG class="word">do</STRONG> <STRONG class="word">not</STRONG> have program installed, do not leave the
        variable lying aroung, because it will keep this subroutine active.
        Calling a non existing program is not a good idea, so it better to
        empty the variable if the program is not available.
 

</P>
  <A name="355" id="355"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="356" id="356"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_UBE_IFILE_PRG, path to the program
	<LI>JA_UBE_IFILE_HEADER, the header name where the results
            are put. If not defined, no header is added.
            Defaults to <SAMP class="word">X-Spamifile</SAMP>
	<LI>JA_UBE_IFILE_FORCE, if set to <STRONG class="word">yes</STRONG> then call program no matter
            what. Normally if there already is <SAMP class="word">X-Spamifile</SAMP> header,
            it is assumed that the message has already been checked
	            and no new checking is needed.
</UL>


 

</P>
  <A name="357" id="357"></A>
  <H2>
      Return values
      
  </H2>



 
	<UL>
	<LI>ERROR, is set to the return value of <SAMP class="word">ifile</SAMP> program.
</UL>


 

<P class="column8">
        If header output is enabled, it will contain the folder name
        <SAMP class="word">ifile</SAMP> thinks the message belongs to. Assuming that trained
        folders used for messages were <EM class="word">spam</EM> and <EM class="word">good</EM>, then the headers
        read:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      X-Spam-ifile: spam
      X-Spam-ifile: good
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="358" id="358"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC                  = $HOME/procmail # procmail recipe dir
 
      &lt;other checks, mailing lists, work mail etc.&gt;
 
      JA_UBE_IFILE_PRG       = &quot;/usr/bin/nice -n 5 /usr/bin/ifile&quot;
      INCLUDERC              = $PMSRC/pm-jaube-prg-ifile.rc
 
      #   The ERROR will contains word &quot;yes&quot; spamprobe classified
      #   the message into &quot;bad&quot; category.
 
      :0 :
      * ERROR ?? spam
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="359" id="359"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="360"  id="360"></A>
    <H1>
    Pm-jaube-prg-runall.rc &ndash; Interface to all Bayesian filter programs
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="361" id="361"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="362" id="362"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>To detect spam reliably, run all Bayesian programs one by one
            to see if any of them classifies the message as spam.
	<LI>Programs supported: bogofilter, spamprobe, Bayesian Mail
	            Filter, Annoyance Filterm Bsfilter, Spamoracle and Spamassassin.
</UL>


 

</P>
  <A name="363" id="363"></A>
  <H2>
      Description
      
  </H2>



 
        There are several bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. This module is a
        <STRONG class="word">meta</STRONG> <STRONG class="word">package</STRONG> which will call all other individual modules
        that interface to these Bayesian programs. The use is simple: define
        programs that are available in your system and which you have
        trained (Bayesian programs need to be trained before use), and this
        this module will query how those programs would classify the message.
 

</P>
  <A name="364" id="364"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-jaube-prg-spamprobe.rc
	<LI>pm-jaube-prg-spamoracle.rc       
	<LI>pm-jaube-prg-annoyance-filter.rc       
	<LI>pm-jaube-prg-bsfilter.rc      
	<LI>pm-jaube-prg-bmf.rc
</UL>


 

</P>
  <A name="365" id="365"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        To activate Bayesian program(s), define path to them. Default
        value for all these variables is &quot;&quot; i.e. is is supposed that 
        no programs have been installed or trained.
 
<UL>
	<LI><SAMP class="word">JA_UBE_BOGOFILTER_PRG</SAMP>, path to <EM class="word">bogofilter</EM> program.
	<LI><SAMP class="word">JA_UBE_SPAMPROBE_PRG</SAMP>, Path to <EM class="word">spamprobe</EM> program
	<LI><SAMP class="word">JA_UBE_BMF_PRG</SAMP>, Path to Bayesian Mail Filter <EM class="word">bmf</EM> program.
	<LI><SAMP class="word">JA_UBE_SPAMASSASSIN_PRG</SAMP>, path to <EM class="word">spamassassin</EM> program.
            If daemon version is available, set this to <EM class="word">spamc</EM> program.
	<LI><SAMP class="word">JA_UBE_SPAMORACLE_PRG</SAMP>, path to <EM class="word">spamoracle</EM> program.
	<LI><SAMP class="word">JA_UBE_ANNOYANCE_PRG</SAMP>, path to <EM class="word">annoyance-filter</EM> program.
            You must also set <SAMP class="word">JA_UBE_ANNOYANCE_SPAM_DB</SAMP> to fast
            dictionary database location.
	<LI><SAMP class="word">JA_UBE_BSFILTER_PRG</SAMP>, path to <EM class="word">bsfilter</EM> program.
</UL>


        

<P class="column8">
        Optional variables to set:
 
<UL>
	<LI> <SAMP class="word">JA_UBE_BOGOFILTER_OPT</SAMP>. Default is &quot;-p&quot; passthrough. 
             Option &quot;-e&quot; will report exit code to procmail.
	<LI> <SAMP class="word">JA_UBE_SPAMASSASSIN_OPT</SAMP>. Default is &quot;&quot;.
	<LI> <SAMP class="word">JA_UBE_SPAMASSASSIN_MAX_SIZE</SAMP>. Default is 256000 (256k).
             Spamassassin is a Perl program, which is slow at startup,
             so checking e.g. long attachements consumes lot of resources.
	             Keep this value relatively small.
</UL>


 

</P>
  <A name="366" id="366"></A>
  <H2>
      Important notes
      
  </H2>



 
        All headers are canonicalized to <EM class="word">X-Spam-&lt;PROGRAM&gt;-</EM> so e.g.
        in bogofilter's case, the default <EM class="word">X-Bogocity</EM> header is
        changed to value <EM class="word">X-Spam-Bogofilter-Status</EM> and so on.
        Summaries like below can then be generated:
        
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ egrep -i '(Subject|From|^X-Spam.*Status)' *.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="367" id="367"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI><SAMP class="word">ERROR</SAMP> variable's first word is set to program that classified 
            the spam: <EM class="word">bogofilter</EM>, <EM class="word">bmf</EM> (Bayesian Mail Filter), 
            <EM class="word">spamassassin</EM> etc. It is followed by semicolon &quot;;&quot; and 
            detailed return status from the program.
	<LI><SAMP class="word">ERROR_INFO</SAMP> is set only in bogofilter's case if it thinks
	            the message is neither spam nor ham (&quot;Unsure&quot;).
</UL>


 

</P>
  <A name="368" id="368"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC            = $HOME/procmail # procmail recipe dir
 
      # ... other checks, mailing lists, work mail etc.
 
      #   bogofilter and spamprobe are available and trained. Use them.
 
      JA_UBE_BOGOFILTER_PRG = &quot;/usr/bin/nice -n 5 /usr/bin/bogofilter&quot;
      JA_UBE_BMF_PRG        = &quot;/usr/bin/nice -n 5 /usr/bin/bmf&quot;
 
      #   Now call the &quot;umbrella&quot; module, which will take care of
      #   the details.
 
      INCLUDERC             = $PMSRC/pm-jaube-prg-runall.rc
 
      #   ERROR is set if message was spam. The &quot;()\/&quot; logs reason.
 
      :0 :
      * ERROR ?? ^()\/.+
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="369" id="369"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="370"  id="370"></A>
    <H1>
    Pm-jaube-prg-spamoracle.rc &ndash; Interface to Spamoracle program
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="371" id="371"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="372" id="372"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your Unsolicited Bulk Emacil (aka spam) filters towards the
        end of your <SAMP class="word">~/.procmailrc</SAMP>. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked last.
 

<P class="column8">
        YOU CANNOT USE THIS PROCMAIL SUBROUTINE UNLESS YOU HAVE TRAINED THE
        BAYESIAN PROGRAM FIRST!
 

<P class="column8">
        To train:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ spamoracle add -v -spam good.msg ...  # feed individual messages
      $ spamoracle add -v -good good.msg ...  # feed individual messages
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        To test
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $  spamoracle test mail.msg | less
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="373" id="373"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Implements interface to <A HREF="http://freshmeat.net/projects/spamoracle" target="_top">http://freshmeat.net/projects/spamoracle</A>
            OCaml language based Bayesian Mail program.
	<LI>Variable <SAMP class="word">ERROR</SAMP> is set to &quot;yes&quot; if the message was UBE.
	<LI>Results are available in headers <SAMP class="word">X-Spam-Spamoracle-Status</SAMP>, 
            <SAMP class="word">X-Spam-Spamoracle-Score</SAMP>, <SAMP class="word">X-Spam-Spamoracle-Details</SAMP> and 
	            <SAMP class="word">X-Spam-Spamoracle-Attachment</SAMP>  for further analysis.
</UL>


 

</P>
  <A name="374" id="374"></A>
  <H2>
      Description
      
  </H2>



 
        There are several bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. All the Bayesian programs
        are not the same, so if you want to achive magic 99.99% probability
        the only methodology to do that is to chain several programs in
        serially. There is no single program that can solve the UBE detection.
 

<P class="column8">
        Using Spamoracle as sole spam protection is inefficient, because
        version version 1.4 (2004-09-29) does not accept messages from
        stdin. Becaus of this message has to be written to a temporary file
        before calling Spamoracle. Later the temporary file must be removed
        with <SAMP class="word">rm</SAMP>. All these three shell calls are needed for each message.
        If you have other detection programs, call them first to identify
        unsolicited Bulk Email.
 

</P>
  <A name="375" id="375"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address forged. Do not increase
        the network traffic; you will not do any good to anybody by
        bouncing messgas &ndash; you just increase mail traffic even more.
        Instead save the messages to folders and periodically periodically
        check their contents.
 

</P>
  <A name="376" id="376"></A>
  <H2>
      Required settings
      
  </H2>



 
        If <SAMP class="word">spamoracle</SAMP> program is available, define this variable in your
        <SAMP class="word">~/.procmailrc</SAMP>. Use absolute path to make the external shell
        quick; it'll save server load considerably.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_UBE_SPAMORACLE_PRG = /usr/bin/spamoracle
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you <STRONG class="word">do</STRONG> <STRONG class="word">not</STRONG> have program installed, do not leave the
        variable lying aroung, because it will keep this subroutine active.
        Calling a non existing program is not a good idea, so it better to
        empty the variable if the program is not available.
 

</P>
  <A name="377" id="377"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="378" id="378"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI><SAMP class="word">JA_UBE_SPAMORACLE_PRG</SAMP>, path to program
	<LI><SAMP class="word">JA_UBE_SPAMORACLE_HEADER_PREFIX</SAMP>, the header name where the results
            are put. If not defined, no headers are added. Default
            value is  <EM class="word">X-Spam-Spamoracle'</EM>.
	<LI><SAMP class="word">JA_UBE_SPAMORACLE_FORCE</SAMP>, if set to <STRONG class="word">yes</STRONG> then call program no matter
            what. Normally if there already are <EM class="word">X-Spam-Spamoracle-</EM> headers,
            it is assumed that the message has already been checked
            and no new checking is needed.
	<LI><SAMP class="word">JA_UBE_SPAMORACLE_REGEXP</SAMP>, regexp to match for spam probability.
            Defaul value will match probabbility of 0.8 with 5 interesting words.
	            The match is tried agains <EM class="word">X-Spam-Spamoracle-Score</EM> header.
</UL>


 

</P>
  <A name="379" id="379"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI><SAMP class="word">ERROR</SAMP>, value  &quot;yes&quot; if <SAMP class="word">JA_UBE_SPAMORACLE_REGEXP</SAMP> matched.
	<LI><SAMP class="word">ERROR_MATCH</SAMP> contains detailed content of 
	            <SAMP class="word">X-Spam-Spamoracle-Score</SAMP> header.
</UL>


 

<P class="column8">
        If headers were enabled, they will contain these values. The
        score's values are spam probability 0.0 - 1.0 and the degree of
        similarity 0-15 of the message with the spam messages in the
        corpus.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      X-Spam-Spamoracle-Status: yes
      X-Spam-Spamoracle-Score: 1.00 -- 15
      X-Spam-Spamoracle-Details: refid:98 $$$$:98 surfing:98 asp:95 click:93 
        cable:92 instantly:90 https:88 internet:87 www:86 U4:85 isn't:14 month:81
        com:75 surf:75 
      X-Spam-Spamoracle-Attachments: cset=&quot;GB2312&quot; type=&quot;application/octet-stream&quot;
        name=&quot;Guangwen4.zip&quot; 
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="380" id="380"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC            = $HOME/procmail # procmail recipe dir
 
      &lt;other checks, mailing lists, work mail etc.&gt;
 
      JA_UBE_SPAMORACLE_PRG   = &quot;/usr/bin/nice -n 5 /usr/bin/bmf&quot;
      INCLUDERC               = $PMSRC/pm-jaube-prg-spamoracle.rc
 
      #   The ERROR will contains word &quot;yes&quot; if it program classified
      #   the message into &quot;bad&quot; category.
 
      :0 :
      * ERROR ?? yes
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="381" id="381"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="382"  id="382"></A>
    <H1>
    Pm-jaube-prg-spamprobe.rc &ndash; Interface to Spamprobe program
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="383" id="383"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="384" id="384"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your Unsolicited Bulk Emacil (aka spam) filters towards the
        end of your <SAMP class="word">~/.procmailrc</SAMP>. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked last.
 

<P class="column8">
        YOU CANNOT USE THIS PROCMAIL SUBROUTINE UNLESS YOU HAVE TRAINED THE
        BAYESIAN PROGRAM FIRST!
 

<P class="column8">
        To train:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ spamprobe -8 good good.msg ...
      $ spamprobe -8 spam spam.msg ...
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Make sure there are no stale lock files, or the spamprobe and this
        subroutine will hang infinitely:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      $ rm -f ~/.spamprobe/lock 
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="385" id="385"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Implements interface to <A HREF="http://freshmeat.net/projects/spamprobe/" target="_top">http://freshmeat.net/projects/spamprobe/</A>
            project.
	<LI>variable <SAMP class="word">ERROR</SAMP> is set if the message was UBE.
	<LI>Results are available by default in header 
	            <SAMP class="word">X-Spam-Spamprobe-Status</SAMP>.
</UL>


 

</P>
  <A name="386" id="386"></A>
  <H2>
      Description
      
  </H2>



 
        There are several Bayesian based statistical analysis programs that
        study the message's tokens and then classify it into two categories:
        good or bad, or if you like, ham and spam. All the Bayesian programs
        are not the same, so if you want to achive magic 99.99% probability
        the only methodology to do that is to chain several programs in
        serially. There is no single program that can solve the UBE detection.
        This procmail subroutine implements call interface to program
        <SAMP class="word">spamprobe</SAMP>, which must already have been installed.
 

</P>
  <A name="387" id="387"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address forged. Do not increase
        the network traffic; you will not do any good to anybody by
        bouncing messgas &ndash; you just increase mail traffic even more.
        Instead save the messages to folders and periodically periodically
        check their contents.
 

</P>
  <A name="388" id="388"></A>
  <H2>
      Required settings
      
  </H2>



 
        If <SAMP class="word">spamprobe</SAMP> program is available, define this variable in your
        <SAMP class="word">~/.procmailrc</SAMP>. Use absolute path to make the external shell
        quick; it'll save server load considerably.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_UBE_SPAMPROBE_PRG = /usr/bin/spamprobe
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you <STRONG class="word">do</STRONG> <STRONG class="word">not</STRONG> have program installed, do not leave the
        variable lying aroung, because it will keep this subroutine active.
        Calling a non existing program is not a good idea, so it better to
        empty the variable if the program is not available.
 

</P>
  <A name="389" id="389"></A>
  <H2>
      Required settings
      
  </H2>



 
        None. No dependencies to other procmail modules.
 

</P>
  <A name="390" id="390"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI><SAMP class="word">JA_UBE_SPAMPROBE_PRG</SAMP>, path to the program.
	<LI><SAMP class="word">JA_UBE_SPAMPROBE_HEADER</SAMP>, the header name where the results
            are put. If not defined, no header is added.
            Defaults to <EM class="word">X-Spam-Spamprobe-Status</EM>
	<LI><SAMP class="word">JA_UBE_SPAMPROBE_FORCE</SAMP>, if set to <STRONG class="word">yes</STRONG> then call program no matter
            what. Normally if there already is <EM class="word">X-Spam-Spamprobe-Status</EM> header,
            it is assumed that the message has already been checked
	            and no new checking is needed.
</UL>


 

</P>
  <A name="391" id="391"></A>
  <H2>
      Return values
      
  </H2>



 
	<UL>
	<LI><SAMP class="word">ERROR</SAMP>, is set to the return value of <SAMP class="word">spamprobe</SAMP> program.
</UL>


 

</P>
  <A name="392" id="392"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PMSRC                  = $HOME/procmail # procmail recipe dir
 
      &lt;other checks, mailing lists, work mail etc.&gt;
 
      JA_UBE_SPAMPROBE_PRG   = &quot;/usr/bin/nice -n 5 /usr/bin/spamprobe&quot;
      INCLUDERC              = $PMSRC/pm-jaube-prg-spamprobe.rc
 
      #   The ERROR will contains word &quot;yes&quot; if message was spam
 
      :0 :
      * ERROR ?? yes
      junk.mbox
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="393" id="393"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmail.el
        and tinytab.el for the 4 tab text placement.
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="394"  id="394"></A>
    <H1>
    Pm-jaube.rc &ndash; Unsolicited Bulk Email (UBE) filter.
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="395" id="395"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  Jari Aalto<BR>
        $Keywords:     procmail, subroutine, UBE, spam, UCE filter $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="396" id="396"></A>
  <H2>
      Warning
      
  </H2>



 
        Put all your UBE (aka spam) filters towards the <STRONG class="word">end</STRONG> of your
        ~/.procmailrc. The idea is that valid messages are filed
        first (mailing lists, your work and private mail, bounces) and only
        the uncategorized messages are checked.
 

</P>
  <A name="397" id="397"></A>
  <H2>
      Are you sure you want to use procmail for UBE?
      
  </H2>



 
        If you think you can put this recipe as a first line of defence
        to your mail, you will disappoint. Checking UBE with procmail's
        rule based means does not work that way. The good messages must
        be sorted first (like your mailing lists and your important
        work or friend message) and only then what's left to process
        can be scanned by static rule based tools, like this procmail module.
        There are much more better tools that are based on statistical analysis of 
        messages. You really should consider using one or combination
        of Bayesian tools: <EM class="word">Spamassassin</EM>, <EM class="word">bogofilter</EM>, <EM class="word">spamprobe</EM>,
        <EM class="word">Bayesian</EM> <EM class="word">Mail</EM> <EM class="word">Filter</EM>, <EM class="word">ifile</EM> etc.
 

<P class="column8">
        <STRONG class="word">Repeat:</STRONG> procmail rules are not the tool to UBE control. The
        pattern matching rules can never keep up with the spammers. That
        said, if you:
 
<UL>
	<LI>Can bare a 70-80 % UBE detection rate.
	<LI>Can bare 10 % false hits; you need to check you UBE folder
            regularly for messaged that did not belong there.
	<LI>Have an account that does not get large number of UBE messages.
	<LI>Or if procmail is all you have in the system.
</UL>


 

<P class="column8">
        only then consider this module or any other procmail based spam filters
        in that respect. So, please don't set your expectations high. Spend
        good time with the configuration variables and check there returned
        result in variable <SAMP class="word">ERROR</SAMP> carefully. Good luck.
 

</P>
  <A name="398" id="398"></A>
  <H2>
      Overview of features
      
  </H2>



 
<UL>
	<LI>Requires procmail 3.11pre7+
	<LI>You don't need external files: site block lists, the
            heuristics nail most of the UBE messages. Just plug in this
            module and you have UBE shield active.
	<LI>Header based filtering: Minimum headers, Pegasus bulk mail,
            X-uidl validity check
	<LI>Address based filtering: Numeric address, Invalid address (eg.
            me@myMarketing.global), UBE-like(friend,remove request.)
	<LI>Text filtering: no html accepted, common advertising slogans.
	<LI>And many more check that just not were listed here.
</UL>


 

<P class="column8">
        Remember: this is not 100% and there will always be some mishits, so
        don't just junk messages to <SAMP class="word">/dev/null</SAMP>.
 

</P>
  <A name="399" id="399"></A>
  <H2>
      Description
      
  </H2>



 
        Originally Daniel Smith posted his spam.rc, where he had gathered
        many tips and heuristics to filter UBE email. This filter here
        expresses work of many procmail users.  Original filters were
        modified, some rules were left out that catched false email
        messages and made the package look a bit more general so that it
        could be included via <SAMP class="word">INCLUDERC</SAMP> in the standard way.
 

<P class="column8">
        Thanks to Daniel and others, the UBE bomb days can be reduced, when this
        filter is active. Some UBE messages may still lurk into the
        mailbox, but that's the problem with all static rule based tools.
 

</P>
  <A name="400" id="400"></A>
  <H2>
      Logging the events
      
  </H2>



 
        A good strategy to follow incoming mail is to log the vital parts
        like Date, From, Subect to some log file and then a reason what
        happened to a message. The <SAMP class="word">~/Mail/mail.log</SAMP> might look like:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      1997-12-08 work@example.com  Extra Holiday $$$$$
          [jaube; Marketing-Big-ExitCode; LEGAL, MONEY-MAKING PHENOMENON]
      1997-12-09 Denizen logger@example.com  [RePol] hiding
      1997-12-09 david X dx@example.com  Re: Send list to incoming folder
      1997-12-09 david X dx@example.com  Re: Send list to incoming folder
      1997-12-09 OMC manager &lt;EM&gt;<A HREF="mailto:omcman@example.fi" >omcman@example.fi</A>&lt;/EM&gt; &quot;Environments updated&quot;
          [my; work-localenv]
      1997-12-09 doodle@example.org  Re: Gnus (Emacs Newsreader) FAQ
          [my; emacs;   Re: Gnus (Emacs Newsreader) FAQ ]
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        First a UBE message that was identified and saved
        to folder. Next 3 messages were filed to mailing-list folders and
        there was no [] action displayed for them (left out due to high
        volume of these messages). Second Last was internal work
        message. Lastly someone asked somthign about Emacs.
 

<P class="column8">
        The basic incoming message log recipe could be like this.
        Variable <SAMP class="word">TODAY</SAMP> is <SAMP class="word">$YYYY-$MM-$DD</SAMP> whose values are set after
        calling <SAMP class="word">pm-jadate.rc</SAMP>. The <SAMP class="word">LISTS</SAMP> is user set variable to exclude
        mailing lists whose activity is not important. Variables <SAMP class="word">FROM</SAMP> and
        <SAMP class="word">SUBJECT</SAMP> are fields read the message's headers.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      BIFF      = $HOME/Mail/mail.log
      INCLUDERC = $PMSRC/pm-jadate.rc
      ... 
 
      :0 hwic:
      *$ ! $LISTS
      |echo &quot;$TODAY $FROM $FSUBJECT&quot; &gt;&gt; $BIFF
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Here is small perl script to parint summary of trapped UBE
        messages from a log like above. It gives nice overview which recipes
        catch most of the UBE messages.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      perl -ne '/jaube; (\S+)/; $s{$1}++;                         \
           END {  $s = (map{$x += $_; $_= $x} values %s)[-1];     \
                  $i = int $s{$_}/$s *100;                        \
                  for (keys %s) { printf &quot;$s{$_} $i $_\n&quot; }       \
               }'                                                 \
           mail.log |                                             \
           sort -nr
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Here is sample results during two month period There are total of
        3248 UBE messages catched.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      count  %  type
      ------------------------------------------
        554 17  Marketing-CountBigLetterWords
        457 14  Marketing
        422 12  Marketing-SelectedBigLetterWords
        349 10  AddrBogus-ToFrom
        263  8  FromReceived-Mismatch
        223  6  NoDirectAddress-ToCc
        216  6  HdrForgedPegasus
        164  5  AddrBogus-To
        151  4  MessageId
        102  3  BodyHtml
        73   2  Received-IPError
        63   1  Identical-FromTo
        53   1  AddrInvalid
        15   0  From-nslookup
        9    0  HdrReceivedTime
        7    0  HdrX-UIDL
        4    0  Marketing-headers
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="401" id="401"></A>
  <H2>
      About bouncing message back
      
  </H2>



 
        The general consensus is, that you should not send bounces. The UBE
        sender is not there, because the address is usually forged. Do not
        increase the network traffic. Instead save the messages to folders
        and periodically check their contents. It's not nice to be forced to
        apologize if you bounced message to a wrong destination. DON'T
        BOUNCE. Forget all recipe examples that use HOST and EXITCODE and
        be a good Net citizen.
 

</P>
  <A name="402" id="402"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This recipe file
        will include
 
<UL>
	<LI>pm-javar.rc
	<LI>pm-janslookup.rc
	<LI>pm-jaaddr.rc
</UL>


 

</P>
  <A name="403" id="403"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
        Only handful of the most important variables are described here.
        You really should read all the comments placed in the &quot;user configured
        section&quot; in this procmail module's code. Most of the defaults
        should work out of the box.
 
<UL>
	<LI><SAMP class="word">JA_UBE_VALID_ADDR</SAMP>, your email addresses or other
            valid from addresses that will say &quot;this is mail addressed
            directly to you&quot;.
	<LI><SAMP class="word">JA_UBE_HDR</SAMP>, If non-empty, a new header is added which tells which
            recipe was triggered. The header is not added to message, if
            there is nothing to report; i.e. message passed all tests.
	<LI>Various flags: Some of the ube detecting recipes give more
            false hits than nail real ube. Experiment with yourself and turn
            on or off the recipes that work for the kind of ube messages
            you receive.
	<LI><SAMP class="word">JA_UBE_MAX_BIG_WORDS</SAMP>, the maximum count of big letter words in the
            message that is tolerated. The current count 5 is rather
            conservative and it is suggested you to increase it to prevent
            trapping too many false hits. Alternatively update JA_UBE_CAPS_OK
            to include accepted words.
	<LI><SAMP class="word">JA_UBE_APPARENTLY_TO_MAX</SAMP>, how many Apparently-To headers are
            tolerated. Default is 3.
	<LI><SAMP class="word">JA_UBE_MAX_HTML_TAGS</SAMP>, maximum count of html tags allowed in the
            body.
	<LI><SAMP class="word">JA_UBE_ATTACHMENT_ILLEGAL_KILL</SAMP>, if set to &quot;yes&quot; (default), then
            illegal attachment from body is ripped off. This is brute way
            to truncate the message abruptly to save mailbox space. You still
            see the headers for tracking, but the body is gone. The regexp
            to test is set in <SAMP class="word">JA_UBE_ATTACHMENT_ILLEGAL_REGEXP</SAMP>.
	<LI><SAMP class="word">JA_UBE_ATTACHMENT_SUSPECT_KILL</SAMP>, if set to &quot;yes&quot; (default &quot;no&quot;),
            kill suspectible characters in attachement filename. The regexp
            to test is set in <SAMP class="word">JA_UBE_ATTACHMENT_SUSPECT_NAME_REGEXP</SAMP>.
	<LI>JA_UBE_CHARSET_LEGAL, if set, accept only these character. The
            default value detect messages with 7bit only (english speaking.
            For foreign language you may want to set this something like
            <SAMP class="word">$CHAR_7BIT_SET$CHAR_LIST_FINLAD</SAMP>
	            for Finnish. See <SAMP class="word">pm-javar.rc</SAMP> for available character sets.
</UL>


 

</P>
  <A name="404" id="404"></A>
  <H2>
      Return values
      
  </H2>



 
<UL>
	<LI><SAMP class="word">ERROR_STATUS</SAMP>, status word of checks. Value &quot;Good&quot; or &quot;Bad&quot;
	<LI><SAMP class="word">ERROR,</SAMP> is set to short ube trigger recipe reason
	<LI><SAMP class="word">ERROR_MATCH</SAMP>, is set to some MATCH that happened while triggering
	            UBE message.
</UL>


 

<P class="column8">
        Alternatively you check content of header <SAMP class="word">JA_UBE_HDR</SAMP> which contains
        results of the above variables. Possible values for <SAMP class="word">ERROR</SAMP> are:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      AddrAOLinvalid
      AddrBogus-From
      AddrInvalid-From
      AddrInvalid-To
      AddrNumeric
      AddrNumericDomain
      AddrUbeLike
      BodyAttachment-FileIllegalAdditional
      BodyAttachment-FileIllegalMatch
      BodyAttachment-FileIllegalOther
      BodyAttachment-FileSuspect
      BodyCharacters-Illegal
      BodyHtml-NonMime
      BodyHtml-script
      BodyHtmlBase64
      BodyHtmlImage
      BodyHtmlTags
      BodyMimeCharset-Illegal
      EnvelopeFrom-Invalid
      From-nslookup
      FromReceived-Mismatch
      HdrForgedPegasus
      HdrReceived
      HdrReceivedTime
      HdrX-Distribution
      HdrX-UIDL
      Header-ApparentlyTo
      HeaderCharacters-Illegal
      HeaderMimeCharset-Illegal
      Html-base64
      Identical-FromTo
      Marketing-Body
      Marketing-CountBigLetterWords
      Marketing-SelectedBigLetterWords
      Marketing-Subject
      Marketing-SubjectGreeting
      MegaSpammer
      MessageId-Invalid
      MessageIdEmpty
      NoDirectAddress-ToCc
      NotEnoughHeaders
      Received-IPError
      VirusBody
      VirusHeader
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="405" id="405"></A>
  <H2>
      Usage example
      
  </H2>



 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      # - All legimate messages should already been handled and
          saved before this recipe.
      # - Activate the filter only for messages that are not from
      #   daemon and not from valid senders: like from &quot;my&quot; domain
      #   and mailing lists and from somewhere else.
 
      VALID_FROM = &quot;(my@address.example.com|word@here.example.com)&quot;
 
      :0
      *$ ! ^From:.*$VALID_FROM
      *$ ! FROM_DAEMON
      {
 
          #   Do not add extra headers. This saves external shell call
          #   (formail). Also do not try to kill the message content,
          #   again saving one external call (awk). With these, the
          #   recipe is faster and more CPU friendly.
 
          PM_JA_UBE_HDR                  = &quot;&quot;
          JA_UBE_ATTACHMENT_ILLEGAL_KILL = &quot;no&quot;
 
          INCLUDERC = $PMSRC/pm-jaube.rc
 
          #   Variable &quot;ERROR&quot; is set if message was UBE, record error
          #   to log file with &quot;()\/&quot;
 
          :0 :
          * ERROR ?? ()\/[a-z].*
          {
              #  Don't save those *.exe, *.zip UBE attachements 
              :0
              *  ERROR ?? attacment.*file
              /dev/null
 
              :0 :
              spam.mbox
          }
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        There may be UBE messages that fool <SAMP class="word">FROM_DAEMON</SAMP> test, so
        you could also use something more finer check. The standard daemon
        error message almost always has sentence &quot;Transcript of session
        follows&quot; in the body. This recipe says: &quot;Unless proven otherwise,
        I don't believe this is daemon message even if it looked like that&quot;.
        Add More &quot;2^1&quot; checks to raise score for other valid daemon cases.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      *   -1^0       ^FROM_DAEMON
      * !  2^1  B ?? Transcript of session follows
      {
          # ... Now call UBE checker
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="406" id="406"></A>
  <H2>
      File layout
      
  </H2>



 
        The layout of this file is managed by Emacs packages tinyprocmal.el
        See project <A HREF="http://tiny-tools.sourceforge.net/" target="_top">http://tiny-tools.sourceforge.net/</A>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="407"  id="407"></A>
    <H1>
    Pm-javac.rc &ndash; Procmail: Vacation framework recipe (id-cache)
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="408" id="408"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;   1997-2004 Jari Aalto<BR>
        $Keywords:      procmail, vacation framework $<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="409" id="409"></A>
  <H2>
      Description
      
  </H2>



 
        Framework for all programs that need to reply to messages only once.
        Usually known as &quot;vacation&quot; feature. If you cahnge th cache file,
        you can attach this recipe to any messages that you want to deal with
        only once.
 

</P>
  <A name="410" id="410"></A>
  <H2>
      Required settings
      
  </H2>



 
        PMSRC must point to source directory of procmail code. This subroutine
        will include
 

<P class="column8">
	<UL>
	<LI>pm-javar.rc
</UL>


 

</P>
  <A name="411" id="411"></A>
  <H2>
      Call arguments (variables to set before calling)
      
  </H2>



 
<UL>
	<LI>JA_VAC, To activate vacation, set value to &quot;yes&quot;
	<LI>JA_VAC_RC, When new message-id is found, run this includerc
	<LI>JA_VAC_ID_CACHE, Remember to clear this file when you start
	            the vacation.
</UL>


 

</P>
  <A name="412" id="412"></A>
  <H2>
      Usage example
      
  </H2>



 
        To turn on the vacation feature, create ~/.vac file and recipe below
        activates vacation. If the vacation is not active, then cache file
        is removed. (automatic cleanup). The VERBOSE is also turned off
        when you're on vacation; so that your procmail log will not get
        filled.
 

<P class="column8">
        So when you go to vacation, you 'touch ~/.vac' and update
        ~/vacation.msg. When you come back, you 'rm ~/.vac'. That's it.
 

<P class="column8">
        IMPORTANT: If you are subscribed to mailing lists, be sure to file
        messages from those services first and put the vacation recipe
        only after the list or bot messages. Also add sufficent &quot;!&quot; conditions
        in order not to reply to other &quot;bot&quot; service messages.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      JA_VAC_ID_CACHE = $HOME/.pm-vac.cache
 
      :0
      *$ ? $IS_EXIST $HOME/.vac
      {
          VERBOSE     = off
          JA_VAC      = &quot;yes&quot;
          JA_VAC_RC   = $PMSRC/pm-myvac.rc        # my vacation recipe
          INCLUDERC   = $PMSRC/pm-javac.rc        # framework
      }
      :0 E                                        # else
      * ? $IS_EXIST $JA_VAC_ID_CACHE
      {
          dummy = `$RM -f $JA_VAC_ID_CACHE`
      }
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Here is example of pm-myvac.rc recipe
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      #  Change subject
 
      :0 fhw
      * ^Subject: *\/[^ ].*
      | $FORMAIL -I &quot;Subject: vacation (was: $MATCH)&quot;
 
      :0 fb           # put message to body
      | $CAT $HOME/.vacation.msg
 
      :0              # Send it
      | $SENDMAIL
    </TD>
    </TR>
</TABLE>
 
</P>
</BLOCKQUOTE>
<HR>
    <A name="413"  id="413"></A>
    <H1>
    Pm-javar.rc &ndash; Global variable definitions
    
    </H1>
<BLOCKQUOTE>


</P>
  <A name="414" id="414"></A>
  <H2>
      File id
      
  </H2>



 
        Copyright &copy;  1997-2004 Jari Aalto<BR>
        Keywords:      procmail, variable definitions<BR>
 

<P class="column8">
        This code is free software in terms of GNU Gen. pub. Lic. v2 or later
        Refer to <A HREF="http://www.gnu.org/copyleft/gpl.html" target="_top">http://www.gnu.org/copyleft/gpl.html</A>
 

</P>
  <A name="415" id="415"></A>
  <H2>
      Description
      
  </H2>



 
        This file defines common variables that you can use in the recipe's
        condition line. Procmail does not know about escape sequences
        like <SAMP class="word">\t</SAMP> or <SAMP class="word">\n</SAMP> and it is therefore much more readable to use
        variables as substitute for common regular expression
        atoms. Pay attention that the line starts with &quot;*$ &quot;, where
        &quot;$&quot; expands the variables: In this file, the variable names
        represent the well known Perl regular expression names, so
        that $s is alost like Perl expression \s (whitespace) and $S
        is almost equivalent to <SAMP class="word">\S</SAMP> (non-whitespace). Similarly, $d is
        <SAMP class="word">\d</SAMP> (digit) and $D resembled <SAMP class="word">\D</SAMP> (non-digit).
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0
      *$ $s+something+$s+$d+$a+
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        The equivalent without variables (you don't see the tabs and
        spaces here):
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0
      #  Space + tab
      * [         ]something[     ][0-9]+[a-z]+
    </TD>
    </TR>
</TABLE>
 
 

<P class="column8">
        In addition all system dependent variables are defined in this module.
        For example if you have Gnu awk, it is strongly suggest that you set:
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      AWK = &quot;/path/to/gawk&quot;  # in Linux, this would be /usr/bin/awk
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Also if plain <SAMP class="word">perl</SAMP> binary still runs the perl 4, then please set
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      PERL = &quot;path/to/perl5&quot;
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        You can define these variables before or after the module, just make
        sure the binaries reflect your operating system's paths. In general,
        if you &quot;port&quot; your setup to several system, dont' include absolute
        paths. In the other hand, if your setup is in the same place using
        absolute paths speed up executions by a factor of 3 or more.
        (depending on how long your PATH is)
 

</P>
  <A name="416" id="416"></A>
  <H2>
      Standard variables defined
      
  </H2>



 
        See pm-tips.txt file for full explanation or look at the source code.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      SPC WSPC NSPC SPCL       # Whitespace, Non Whitespace, W+linefeed
      \s \d \D \w \W and \a \A # perl equivalents
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="417" id="417"></A>
  <H2>
      Special variable JA_FROM_DAEMON
      
  </H2>



 
        In order to boost procmail and to save extra CPU cycles, this module
        defines variable <SAMP class="word">JA_FROM_DAEMON</SAMP> that caches the information of
        ^FROM_DAEMON.  You can refer to <SAMP class="word">JA_FROM_DAEMON</SAMP> as you would to
        big brother FROM_DAEMON. This has the advantage that procmail
        has already computed the result and the variable <SAMP class="word">JA_FROM_DAEMON</SAMP>
        is used as a cache, thus avoiding repeated FROM_DAEMON regexp
        tests, which are expensive.  Variable <SAMP class="word">JA_FROM_DAEMON_match</SAMP>
        contains &quot;&quot; or the result of matched daemon text.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      *$ $JA_FROM_DAEMON
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        or the familiar
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      *$ ! $JA_FROM_DAEMON
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        Instead of using the regexp parsing with
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      * ^FROM_DAEMON
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        and
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      * ! ^FROM_DAEMON
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="418" id="418"></A>
  <H2>
      Special variable JA_FROM_MAILER
      
  </H2>



 
        Works like <SAMP class="word">JA_FROM_DAEMON</SAMP> variable but in respect to FROM_MAILER.
        The matches text is in <SAMP class="word">JA_FROM_MAILER_MATCH</SAMP>
 

</P>
  <A name="419" id="419"></A>
  <H2>
      Usage example
      
  </H2>



 
        For your .procmailrc, you can simply put this, because you
        want to load the variables at startup
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $PMSRC/pm-javar.rc
    </TD>
    </TR>
</TABLE>
 

<P class="column8">
        If you're developing your own modules that use these variables put these lines
        at the beginning. <SAMP class="word">~/.procmailrc</SAMP>. It checks if WSPC variable does
        not include a space --&gt; load the variable definitions. If the
        variable is already defined, the file is not loaded. The test
        line is something alike #ifdef &ndash; #endif in C/C++ language or
        a conditional &quot;import&quot; command in other languages.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      :0
      * ! WSPC ?? [ ]
      {
          INCLUDERC = $PMSRC/pm-javar.rc
      }
    </TD>
    </TR>
</TABLE>
 

</P>
  <A name="420" id="420"></A>
  <H2>
      Defined modules
      
  </H2>



 
        After this file loads, you can refer to any module with $RC_JA_MODULE.
        E.g. to call email spit module in your code you would use following.
        See at the end of this file for all defined module names.
 
<P>
<TABLE  class="shade-normal"
        width="94%"
        border="0"
        cellpadding="10"
        cellspacing="0"
        >
    <TR>
    <TD class="shade-normal-attrib" valign="top">
    <PRE>      INCLUDERC = $RC_JA_UBE
    </TD>
    </TR>
</TABLE>
 


<!--    ......................................................................
    DOCUMENT END BLOCK
    ......................................................................
-->

<!--


-->
</BLOCKQUOTE>

<HR>

<EM    class="footer">Html date: 2004-10-17 13:29<BR>

</EM>

</BODY>
</HTML>
